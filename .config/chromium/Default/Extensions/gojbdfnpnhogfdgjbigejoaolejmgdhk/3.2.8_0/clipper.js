!function e(t,n,o){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);var p=new Error("Cannot find module '"+a+"'");throw p.code="MODULE_NOT_FOUND",p}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return i(n?n:e)},c,c.exports,e,t,n,o)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<o.length;a++)i(o[a]);return i}({1:[function(e,t,n){"use strict";!function(e){e[e.Bookmarklet=0]="Bookmarklet",e[e.ChromeExtension=1]="ChromeExtension",e[e.EdgeExtension=2]="EdgeExtension",e[e.FirefoxExtension=3]="FirefoxExtension",e[e.SafariExtension=4]="SafariExtension"}(n.ClientType||(n.ClientType={}));n.ClientType},{}],2:[function(e,t,n){"use strict";var o=function(){function e(){}return e.stopAnimationsThen=function(e,t){Velocity.animate(e,"stop",!0),setTimeout(t,1)},e}();n.AnimationHelper=o},{}],3:[function(e,t,n){"use strict";!function(e){e[e.GoingIn=0]="GoingIn",e[e.GoingOut=1]="GoingOut",e[e.In=2]="In",e[e.Out=3]="Out",e[e.Transitioning=4]="Transitioning",e[e.Stopped=5]="Stopped"}(n.AnimationState||(n.AnimationState={}));n.AnimationState},{}],4:[function(e,t,n){"use strict";var o=e("./animationHelper"),i=e("./animationState"),r=function(){function e(e){this.animationDuration=e,this.animationState=i.AnimationState.Stopped}return e.prototype.getAnimationState=function(){return this.animationState},e.prototype.setAnimationState=function(e){this.animationState=e},e.prototype.animate=function(e){var t=this;o.AnimationHelper.stopAnimationsThen(e,function(){t.animationState=i.AnimationState.Transitioning,t.doAnimate(e).then(function(){t.animationState=i.AnimationState.Stopped})})},e}();n.AnimationStrategy=r},{"./animationHelper":2,"./animationState":3}],5:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("./animationState"),a=e("./transitioningAnimationStrategy"),s=function(e){function t(t){e.call(this,500,t),this.animationTimeout=100,this.reverseChildAnimations=!0}return o(t,e),t.prototype.doAnimateIn=function(e){var t=this;return new Promise(function(n){t.reverseChildAnimations=!0,clearTimeout(t.animationTimeoutId),t.options.onAnimateInExpand&&(t.animationTimeoutId=setTimeout(function(){t.options.onAnimateInExpand(e)},t.animationTimeout)),Velocity.animate(e,{opacity:1,right:20,width:i.Constants.Styles.clipperUiWidth},{complete:function(){t.reverseChildAnimations=!1,n()},duration:t.animationDuration,easing:"easeOutExpo"})})},t.prototype.doAnimateOut=function(e){var t=this;return new Promise(function(n){clearTimeout(t.animationTimeoutId),t.animationTimeoutId=setTimeout(function(){Velocity.animate(e,{opacity:0,right:0,width:0},{complete:function(){n()},duration:t.animationDuration,easing:"easeOutExpo"})},t.animationTimeout)})},t.prototype.intShouldAnimateIn=function(e){return this.animationState===r.AnimationState.GoingOut||this.animationState===r.AnimationState.Out},t.prototype.intShouldAnimateOut=function(e){return this.animationState===r.AnimationState.GoingIn||this.animationState===r.AnimationState.In},t}(a.TransitioningAnimationStrategy);n.ExpandFromRightAnimationStrategy=s},{"../../constants":59,"./animationState":3,"./transitioningAnimationStrategy":8}],6:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./animationState"),r=e("./transitioningAnimationStrategy"),a=function(e){function t(t){e.call(this,200,t),this.reverseChildAnimations=!0}return o(t,e),t.prototype.doAnimateIn=function(e){var t=this;return new Promise(function(n){var o=t.reverseChildAnimations?20:-20;e.style.left=o+"px",e.style.opacity="0",Velocity.animate(e,{left:0,opacity:1},{complete:function(){n()},duration:t.animationDuration,easing:"easeInOutQuad"})})},t.prototype.doAnimateOut=function(e){var t=this;return new Promise(function(n){var o=t.reverseChildAnimations?-20:20;Velocity.animate(e,{left:o,opacity:0},{complete:function(){n()},duration:t.animationDuration,easing:"easeInOutQuad"})})},t.prototype.intShouldAnimateIn=function(e){return this.animationState===i.AnimationState.Out},t.prototype.intShouldAnimateOut=function(e){return this.animationState===i.AnimationState.In},t}(r.TransitioningAnimationStrategy);n.SlideFromRightAnimationStrategy=a},{"./animationState":3,"./transitioningAnimationStrategy":8}],7:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./animationStrategy"),r=function(e){function t(t,n){e.call(this,200),this.containerId=t,this.options=n}return o(t,e),t.prototype.doAnimate=function(e){var t=this;return new Promise(function(n){var o=document.getElementById(t.containerId),i=t.getContainerTrueHeight(o,e);if(t.options.onBeforeHeightAnimatorDraw&&t.options.onBeforeHeightAnimatorDraw(i),i.actualPanelHeight===i.newPanelHeight)return void n();var r=i.actualPanelHeight>i.newPanelHeight;!r&&t.options.onAfterHeightAnimatorDraw&&t.options.onAfterHeightAnimatorDraw(i),Velocity.animate(e,{maxHeight:i.newPanelHeight,minHeight:i.newPanelHeight},{complete:function(){r&&t.options.onAfterHeightAnimatorDraw&&t.options.onAfterHeightAnimatorDraw(i),n()},duration:t.animationDuration,easing:"easeOutQuad"})})},t.prototype.getContainerTrueHeight=function(e,t){var n=parseFloat(t.style.maxHeight.replace("px",""));isNaN(n)&&(n=0),t.style.maxHeight="",t.style.minHeight="";var o=e?e.offsetHeight:0,i=t.offsetHeight;return t.style.maxHeight=n+"px",t.style.minHeight=n+"px",{actualPanelHeight:n,newContainerHeight:o,newPanelHeight:i}},t}(i.AnimationStrategy);n.SlidingHeightAnimationStrategy=r},{"./animationStrategy":4}],8:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./animationHelper"),r=e("./animationState"),a=e("./animationStrategy"),s=function(e){function t(t,n){e.call(this,t),this.animationState=r.AnimationState.Out,this.options=n}return o(t,e),t.prototype.animate=function(e){this.doAnimate(e)},t.prototype.doAnimate=function(e){var t=this;return new Promise(function(n){t.options.extShouldAnimateIn()&&t.intShouldAnimateIn(e)?t.animateIn(e).then(function(){n()}):t.options.extShouldAnimateOut()&&t.intShouldAnimateOut(e)&&t.animateOut(e).then(function(){n()})})},t.prototype.animateIn=function(e){var t=this;return new Promise(function(n){i.AnimationHelper.stopAnimationsThen(e,function(){t.options.onBeforeAnimateIn&&t.options.onBeforeAnimateIn(e),t.animationState=r.AnimationState.GoingIn,t.doAnimateIn(e).then(function(){t.animationState=r.AnimationState.In,t.options.onAfterAnimateIn&&t.options.onAfterAnimateIn(e),n()})})})},t.prototype.animateOut=function(e){var t=this;return new Promise(function(n){i.AnimationHelper.stopAnimationsThen(e,function(){t.options.onBeforeAnimateOut&&t.options.onBeforeAnimateOut(e),t.animationState=r.AnimationState.GoingOut,t.doAnimateOut(e).then(function(){t.animationState=r.AnimationState.Out,t.options.onAfterAnimateOut&&t.options.onAfterAnimateOut(e),n()})})})},t}(a.AnimationStrategy);n.TransitioningAnimationStrategy=s},{"./animationHelper":2,"./animationState":3,"./animationStrategy":4}],9:[function(e,t,n){"use strict";!function(e){e[e.FullPage=0]="FullPage",e[e.Region=1]="Region",e[e.Augmentation=2]="Augmentation",e[e.Bookmark=3]="Bookmark",e[e.Selection=4]="Selection"}(n.ClipMode||(n.ClipMode={}));n.ClipMode},{}],10:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../userInfo"),r=e("../constants"),a=e("../polyfills"),s=e("../utils"),l=e("./tooltipType"),p=e("../communicator/communicator"),c=e("../communicator/iframeMessageHandler"),u=e("../communicator/inlineMessageHandler"),g=e("../communicator/smartValue"),d=e("../contentCapture/augmentationHelper"),h=e("../contentCapture/bookmarkHelper"),f=e("../contentCapture/fullPageScreenshotHelper"),S=e("../contentCapture/pdfScreenshotHelper"),C=e("../domParsers/domUtils"),y=e("../domParsers/videoUtils"),v=e("../extensions/invokeOptions"),b=e("../extensions/bookmarklet/inlineExtension"),w=e("../http/cachedHttp"),I=e("../localization/localization"),P=e("../logging/log"),T=e("../logging/communicatorLoggerPure"),E=e("../storage/clipperStorageKeys"),U=e("./clipMode"),F=e("./frontEndGlobals"),N=e("./clipperState"),A=e("./componentBase"),L=e("./mainController"),k=e("./oneNoteApiUtils"),R=e("./previewViewer"),O=e("./ratingsHelper"),x=e("./regionSelector"),B=e("./saveToOneNote"),z=e("./status"),H=function(e){function t(t){e.call(this,t),this.isFullScreen=new g.SmartValue((!1)),this.initializeCommunicators(),this.initializeSmartValues()}return o(t,e),t.prototype.getInitialState=function(){var e=this;return{uiExpanded:!0,currentMode:new g.SmartValue(this.getDefaultClipMode()),userResult:{status:z.Status.NotStarted},fullPageResult:{status:z.Status.NotStarted},pdfResult:{status:z.Status.NotStarted},regionResult:{status:z.Status.NotStarted,data:[]},augmentationResult:{status:z.Status.NotStarted},oneNoteApiResult:{status:z.Status.NotStarted},bookmarkResult:{status:z.Status.NotStarted},setState:function(n){e.setState(n),e.isFullScreen.set(t.shouldShowPreviewViewer(e.state)||t.shouldShowRegionSelector(e.state))},previewGlobalInfo:{annotation:"",fontSize:parseInt(I.Localization.getLocalizedString("WebClipper.FontSize.Preview.SansSerifDefault"),10),highlighterEnabled:!1,serif:!1},augmentationPreviewInfo:{},selectionPreviewInfo:{},showRatingsPrompt:new g.SmartValue,reset:function(){e.state.setState(e.getResetState())}}},t.prototype.getResetState=function(){return{currentMode:this.state.currentMode.set(this.getDefaultClipMode()),oneNoteApiResult:{status:z.Status.NotStarted},showRatingsPrompt:new g.SmartValue}},t.prototype.initializeInjectCommunicator=function(e,t){var n=this;F.Clipper.getInjectCommunicator().registerFunction(r.Constants.FunctionKeys.noOpTracker,function(e){var t=new P.Event.BaseEvent(P.Event.Label.ClearNoOpTracker);return t.setCustomProperty(P.PropertyName.Custom.TimeToClearNoOpTracker,(new Date).getTime()-e),t.setCustomProperty(P.PropertyName.Custom.Channel,r.Constants.CommunicationChannels.injectedAndUi),F.Clipper.logger.logEvent(t),Promise.resolve()}),F.Clipper.getInjectCommunicator().registerFunction(r.Constants.FunctionKeys.showRefreshClipperMessage,function(e){n.state.badState||(F.Clipper.logger.logFailure(P.Failure.Label.OrphanedWebClippersDueToExtensionRefresh,P.Failure.Type.Expected,{error:e}),n.state.setState({badState:!0}))}),F.Clipper.getInjectCommunicator().registerFunction(r.Constants.FunctionKeys.toggleClipper,function(){n.state.setState({uiExpanded:!n.state.uiExpanded})}),F.Clipper.getInjectCommunicator().registerFunction(r.Constants.FunctionKeys.onSpaNavigate,function(){if(n.state.uiExpanded){var e=new P.Event.BaseEvent(P.Event.Label.HideClipperDueToSpaNavigate);F.Clipper.logger.logEvent(e),n.state.setState({uiExpanded:!1})}}),F.Clipper.getInjectCommunicator().registerFunction(r.Constants.FunctionKeys.setInvokeOptions,function(e){n.setInvokeOptions(e)}),F.Clipper.getInjectCommunicator().broadcastAcrossCommunicator(this.isFullScreen,r.Constants.SmartValueKeys.isFullScreen),F.Clipper.getInjectCommunicator().subscribeAcrossCommunicator(e,r.Constants.SmartValueKeys.pageInfo,function(e){if(e){var t=s.Utils.createUpdatedObject(n.state.previewGlobalInfo,{previewTitleText:e.contentTitle});n.state.setState({pageInfo:e,previewGlobalInfo:t}),n.captureFullScreenshotContent(),n.captureAugmentedContent(),n.captureBookmarkContent(),F.Clipper.logger.setContextProperty(P.Context.Custom.ContentType,OneNoteApi.ContentType[e.contentType]),F.Clipper.logger.setContextProperty(P.Context.Custom.InvokeHostname,s.Utils.getHostname(e.rawUrl)),F.Clipper.logger.setContextProperty(P.Context.Custom.PageLanguage,e.contentLocale)}}),F.Clipper.getInjectCommunicator().setErrorHandler(function(e){P.ErrorUtils.handleCommunicatorError(r.Constants.CommunicationChannels.injectedAndUi,e,t)})},t.prototype.captureFullScreenshotContent=function(){this.state.pageInfo.contentType===OneNoteApi.ContentType.EnhancedUrl?this.capturePdfScreenshotContent():this.captureFullPageScreenshotContent()},t.prototype.capturePdfScreenshotContent=function(){var e=this;0===this.state.pageInfo.rawUrl.indexOf("file:///")?this.state.setState({pdfResult:{data:new g.SmartValue({failureMessage:I.Localization.getLocalizedString("WebClipper.Preview.UnableToClipLocalFile")}),status:z.Status.Failed}}):(this.state.setState({pdfResult:{data:new g.SmartValue((void 0)),status:z.Status.InProgress}}),S.PdfScreenshotHelper.getPdfData(this.state.pageInfo.rawUrl).then(function(t){e.state.pdfResult.data.set(t),e.state.setState({pdfResult:{data:e.state.pdfResult.data,status:z.Status.Succeeded}})},function(){e.state.pdfResult.data.set({failureMessage:I.Localization.getLocalizedString("WebClipper.Preview.FullPageModeGenericError")}),e.state.setState({pdfResult:{data:e.state.pdfResult.data,status:z.Status.Failed}}),e.state.pdfResult.data.forceUpdate()}))},t.prototype.captureFullPageScreenshotContent=function(){var e=this;this.state.setState({fullPageResult:{status:z.Status.InProgress}}),f.FullPageScreenshotHelper.getFullPageScreenshot(this.state.pageInfo.contentData).then(function(t){e.state.setState({fullPageResult:{data:t,status:z.Status.Succeeded}})},function(){e.state.setState({fullPageResult:{data:{failureMessage:I.Localization.getLocalizedString("WebClipper.Preview.FullPageModeGenericError")},status:z.Status.Failed}})})},t.prototype.captureAugmentedContent=function(){var e=this;if(this.state.pageInfo.contentType===OneNoteApi.ContentType.EnhancedUrl)this.state.setState({augmentationResult:{data:{failureMessage:I.Localization.getLocalizedString("WebClipper.Preview.NoContentFound")},status:z.Status.Failed}});else{this.state.setState({augmentationResult:{status:z.Status.InProgress}});var t=this.state.pageInfo,n=t.canonicalUrl;(t.rawUrl.indexOf("youtube.com")>-1||t.rawUrl.indexOf("vimeo.com")>-1)&&(n=t.rawUrl),d.AugmentationHelper.augmentPage(n,t.contentLocale,t.contentData).then(function(t){t.ContentInHtml=C.DomUtils.cleanHtml(t.ContentInHtml),e.state.setState({augmentationResult:{data:t,status:z.Status.Succeeded},augmentationPreviewInfo:{previewBodyHtml:t.ContentInHtml}})},function(){e.state.setState({augmentationResult:{data:{failureMessage:I.Localization.getLocalizedString("WebClipper.Preview.AugmentationModeGenericError")},status:z.Status.Failed}})})}},t.prototype.captureBookmarkContent=function(){var e=this;this.state.setState({bookmarkResult:{status:z.Status.InProgress}});var t=this.state.pageInfo,n=t.rawUrl,o=t.contentTitle,i=C.DomUtils.getDocumentFromDomString(t.contentData),r=h.BookmarkHelper.getElementsByTagName(i,h.BookmarkHelper.metadataTagNames),a=h.BookmarkHelper.getElementsByTagName(i.body,[C.DomUtils.Tags.img]),s=[];try{s=h.BookmarkHelper.getNonWhiteSpaceTextElements(i,!0)}catch(e){}h.BookmarkHelper.bookmarkPage(n,o,r,!0,a,s).then(function(t){e.state.setState({bookmarkResult:{data:t,status:z.Status.Succeeded}})},function(t){e.state.setState({bookmarkResult:{data:{url:t.url,title:o,description:t.description,thumbnailSrc:t.thumbnailSrc,failureMessage:I.Localization.getLocalizedString("WebClipper.Preview.BookmarkModeGenericError")},status:z.Status.Failed}})})},t.prototype.setInvokeOptions=function(e){switch(this.setState({invokeOptions:e}),this.setState({currentMode:this.state.currentMode.set(this.getDefaultClipMode())}),e.invokeMode){case v.InvokeMode.ContextImage:this.setState({regionResult:{data:[e.invokeDataForMode],status:z.Status.Succeeded}});break;case v.InvokeMode.ContextTextSelection:this.state.setState({selectionPreviewInfo:{previewBodyHtml:e.invokeDataForMode}})}},t.prototype.initializeExtensionCommunicator=function(e){var t=this;F.Clipper.getExtensionCommunicator().registerFunction(r.Constants.FunctionKeys.noOpTracker,function(e){var t=new P.Event.BaseEvent(P.Event.Label.ClearNoOpTracker);return t.setCustomProperty(P.PropertyName.Custom.TimeToClearNoOpTracker,(new Date).getTime()-e),t.setCustomProperty(P.PropertyName.Custom.Channel,r.Constants.CommunicationChannels.extensionAndUi),F.Clipper.logger.logEvent(t),Promise.resolve()}),F.Clipper.getExtensionCommunicator().registerFunction(r.Constants.FunctionKeys.createHiddenIFrame,function(e){s.Utils.appendHiddenIframeToDocument(e)});var n=function(e){if(e){var n=new P.Event.BaseEvent(P.Event.Label.UserInfoUpdated);n.setCustomProperty(P.PropertyName.Custom.UserUpdateReason,i.UpdateReason[e.updateReason]),n.setCustomProperty(P.PropertyName.Custom.LastUpdated,new Date(e.lastUpdated).toUTCString()),F.Clipper.logger.logEvent(n)}if(e&&e.user){var o={data:e.user,lastUpdated:e.lastUpdated},r=w.CachedHttp.valueHasExpired(o,1e3*e.user.accessTokenExpiration-18e4);r&&F.Clipper.logger.logFailure(P.Failure.Label.UserSetWithInvalidExpiredData,P.Failure.Type.Unexpected),t.state.setState({userResult:{status:z.Status.Succeeded,data:e}}),F.Clipper.logger.setContextProperty(P.Context.Custom.AuthType,e.user.authType),F.Clipper.logger.setContextProperty(P.Context.Custom.UserInfoId,e.user.cid)}else t.state.setState({userResult:{status:z.Status.Failed,data:e}})};this.state.setState({userResult:{status:z.Status.InProgress}}),F.Clipper.getExtensionCommunicator().callRemoteFunction(r.Constants.FunctionKeys.getInitialUser,{callback:function(e){e&&e.user?F.Clipper.logger.logUserFunnel(P.Funnel.Label.AuthAlreadySignedIn):e||n(e),F.Clipper.getExtensionCommunicator().subscribeAcrossCommunicator(new g.SmartValue,r.Constants.SmartValueKeys.user,function(e){n(e)})}}),this.state.setState({fetchLocStringStatus:z.Status.InProgress}),F.Clipper.getExtensionCommunicator().callRemoteFunction(r.Constants.FunctionKeys.clipperStrings,{callback:function(e){e&&I.Localization.setLocalizedStrings(e),t.state.setState({fetchLocStringStatus:z.Status.Succeeded})}}),F.Clipper.getExtensionCommunicator().subscribeAcrossCommunicator(e,r.Constants.SmartValueKeys.clientInfo,function(e){e&&t.state.setState({clientInfo:e})}),F.Clipper.getExtensionCommunicator().setErrorHandler(function(t){P.ErrorUtils.handleCommunicatorError(r.Constants.CommunicationChannels.extensionAndUi,t,e)})},t.prototype.initializeCommunicators=function(){var e=this,t=new g.SmartValue,n=new g.SmartValue;F.Clipper.setInjectCommunicator(new p.Communicator(new c.IFrameMessageHandler(function(){return parent}),r.Constants.CommunicationChannels.injectedAndUi)),F.Clipper.getInjectCommunicator().registerFunction(r.Constants.FunctionKeys.setInjectOptions,function(t){if(e.setState({injectOptions:t}),e.state.injectOptions.useInlineBackgroundWorker){var o=new b.InlineExtension,i=o.getInlineMessageHandler(),a=new u.InlineMessageHandler(i);i.setOtherSide(a),F.Clipper.setExtensionCommunicator(new p.Communicator(a,r.Constants.CommunicationChannels.extensionAndUi))}else F.Clipper.setExtensionCommunicator(new p.Communicator(new c.IFrameMessageHandler(function(){return parent}),r.Constants.CommunicationChannels.extensionAndUi));e.initializeExtensionCommunicator(n),F.Clipper.getExtensionCommunicator().subscribeAcrossCommunicator(F.Clipper.sessionId,r.Constants.SmartValueKeys.sessionId),F.Clipper.logger=new T.CommunicatorLoggerPure(F.Clipper.getExtensionCommunicator()),e.initializeNumSuccessfulClips(),O.RatingsHelper.preCacheNeededValues()}),this.initializeInjectCommunicator(t,n),F.Clipper.getInjectCommunicator().registerFunction(r.Constants.FunctionKeys.tabToLowestIndexedElement,function(){var e,t=document.querySelectorAll("[tabindex]");if(t.length>0){for(var n=0;n<t.length;n++){var o=t[n];(!e||o.tabIndex<e.tabIndex)&&(e=o)}e.focus()}}),n.subscribe(function(t){t&&e.state.setState({currentMode:e.state.currentMode.set(e.getDefaultClipMode())})})},t.prototype.initializeSmartValues=function(){this.state.currentMode.subscribe(function(e){switch(e){case U.ClipMode.FullPage:case U.ClipMode.Augmentation:F.Clipper.getInjectCommunicator().callRemoteFunction(r.Constants.FunctionKeys.updatePageInfoIfUrlChanged)}},{callOnSubscribe:!1})},t.prototype.initializeNumSuccessfulClips=function(){var e=this;new Promise(function(e,t){F.Clipper.getStoredValue(E.ClipperStorageKeys.numSuccessfulClips,function(t){e(t)})}).then(function(t){var n=parseInt(t,10);(s.Utils.isNullOrUndefined(n)||isNaN(n))&&(n=0),e.state.numSuccessfulClips=new g.SmartValue(n),e.state.numSuccessfulClips.subscribe(function(){e.state.showRatingsPrompt.set(O.RatingsHelper.shouldShowRatingsPrompt(e.state))},{callOnSubscribe:!1})})},t.prototype.getDefaultClipMode=function(){if(this.state&&this.state.invokeOptions)switch(this.state.invokeOptions.invokeMode){case v.InvokeMode.ContextImage:if(this.state.regionResult.data.length>0)return U.ClipMode.Region;break;case v.InvokeMode.ContextTextSelection:return U.ClipMode.Selection}return this.state&&this.state.pageInfo&&s.Utils.onWhitelistedDomain(this.state.pageInfo.rawUrl)?U.ClipMode.Augmentation:U.ClipMode.FullPage},t.prototype.updateFrameHeight=function(e){F.Clipper.getInjectCommunicator().callRemoteFunction(r.Constants.FunctionKeys.updateFrameHeight,{param:e})},t.prototype.handleSignIn=function(e){F.Clipper.logger.logUserFunnel(P.Funnel.Label.AuthAttempted);var t=new P.Event.PromiseEvent(P.Event.Label.HandleSignInEvent);this.setState({userResult:{status:z.Status.InProgress}}),F.Clipper.getExtensionCommunicator().callRemoteFunction(r.Constants.FunctionKeys.signInUser,{param:e,callback:function(n){var o,a=n,s=n,l=i.AuthType[e]+"; ";a?(s.error||s.errorDescription)&&(o=l+s.error+": "+s.errorDescription,t.setCustomProperty(P.PropertyName.Custom.CorrelationId,s.correlationId)):o=l+"The "+r.Constants.FunctionKeys.signInUser+" remote function incorrectly returned an undefined object",o&&(t.setStatus(P.Status.Failed),t.setFailureInfo({error:o}));var p=a&&!!a.user;p&&F.Clipper.logger.logUserFunnel(P.Funnel.Label.AuthSignInCompleted),t.setCustomProperty(P.PropertyName.Custom.UserInformationReturned,p),t.setCustomProperty(P.PropertyName.Custom.SignInCancelled,!o&&!p),F.Clipper.logger.logEvent(t)}})},t.prototype.handleSignOut=function(e){this.state.setState(this.getSignOutState()),F.Clipper.getExtensionCommunicator().callRemoteFunction(r.Constants.FunctionKeys.signOutUser,{param:i.AuthType[e]}),F.Clipper.logger.logUserFunnel(P.Funnel.Label.SignOut),F.Clipper.logger.logSessionEnd(P.Session.EndTrigger.SignOut),F.Clipper.logger.logSessionStart()},t.prototype.getSignOutState=function(){var e=this.getResetState();return e.saveLocation=void 0,e},t.prototype.handleStartClip=function(){var e=this;F.Clipper.logger.logUserFunnel(P.Funnel.Label.ClipAttempted),this.state.setState({userResult:{status:z.Status.InProgress,data:this.state.userResult.data}}),F.Clipper.getExtensionCommunicator().callRemoteFunction(r.Constants.FunctionKeys.ensureFreshUserBeforeClip,{callback:function(t){if(t&&t.user)if(e.state.currentMode.get()===U.ClipMode.FullPage)F.Clipper.getInjectCommunicator().callRemoteFunction(r.Constants.FunctionKeys.updatePageInfoIfUrlChanged,{callback:function(){e.startClip()}});else if(e.state.currentMode.get()===U.ClipMode.Bookmark){var n=document.getElementById("previewBody").innerHTML;e.state.setState({bookmarkPreviewInfo:{previewBodyHtml:n}}),e.startClip()}else e.startClip()}})},t.prototype.startClip=function(){var e=this;F.Clipper.storeValue(E.ClipperStorageKeys.lastClippedDate,Date.now().toString());var t=new P.Event.PromiseEvent(P.Event.Label.ClipToOneNoteAction),n=U.ClipMode[this.state.currentMode.get()];if(this.state.currentMode.get()===U.ClipMode.FullPage&&this.state.pageInfo.contentType===OneNoteApi.ContentType.EnhancedUrl&&(n+=": "+OneNoteApi.ContentType[this.state.pageInfo.contentType],F.Clipper.storeValue(E.ClipperStorageKeys.lastClippedTooltipTimeBase+l.TooltipType[l.TooltipType.Pdf],Date.now().toString())),this.state.currentMode.get()===U.ClipMode.Augmentation){var o={fontSize:this.state.previewGlobalInfo.fontSize,serif:this.state.previewGlobalInfo.serif},i=d.AugmentationHelper.getAugmentationType(this.state);F.Clipper.storeValue(E.ClipperStorageKeys.lastClippedTooltipTimeBase+i,Date.now().toString()),t.setCustomProperty(P.PropertyName.Custom.AugmentationModel,i),t.setCustomProperty(P.PropertyName.Custom.Styles,JSON.stringify(o))}y.VideoUtils.videoDomainIfSupported(this.state.pageInfo.rawUrl)&&F.Clipper.storeValue(E.ClipperStorageKeys.lastClippedTooltipTimeBase+l.TooltipType[l.TooltipType.Video],Date.now().toString()),t.setCustomProperty(P.PropertyName.Custom.ClipMode,n),this.state.setState({oneNoteApiResult:{status:z.Status.InProgress}}),this.state.showRatingsPrompt.subscribe(function(t){var n=B.SaveToOneNote.getClipSuccessStatus(e.state);e.state.setState({oneNoteApiResult:{status:n}})},{callOnSubscribe:!1}),B.SaveToOneNote.startClip(this.state).then(function(n){t.setCustomProperty(P.PropertyName.Custom.CorrelationId,n.responsePackage.request.getResponseHeader(r.Constants.HeaderValues.correlationId)),t.setCustomProperty(P.PropertyName.Custom.AnnotationAdded,n.annotationAdded),e.state.setState({oneNoteApiResult:{data:n.responsePackage.parsedResponse,status:z.Status.InProgress}});var o=B.SaveToOneNote.getClipSuccessStatus(e.state);e.state.setState({oneNoteApiResult:{data:n.responsePackage.parsedResponse,status:o}})},function(n){k.OneNoteApiUtils.logOneNoteApiRequestError(t,n),e.state.setState({oneNoteApiResult:{data:n,status:z.Status.Failed}})}).then(function(){F.Clipper.logger.logEvent(t)})},t.shouldShowOptions=function(e){return e.uiExpanded&&N.ClipperStateHelperFunctions.isUserLoggedIn(e)&&e.oneNoteApiResult.status===z.Status.NotStarted&&!e.badState},t.shouldShowPreviewViewer=function(e){return this.shouldShowOptions(e)&&(e.currentMode.get()!==U.ClipMode.Region||e.regionResult.status===z.Status.Succeeded)},t.shouldShowRegionSelector=function(e){return this.shouldShowOptions(e)&&e.currentMode.get()===U.ClipMode.Region&&e.regionResult.status!==z.Status.Succeeded},t.shouldShowMainController=function(e){return e.regionResult.status!==z.Status.InProgress||e.badState},t.prototype.render=function(){var e=t.shouldShowPreviewViewer(this.state)?m.component(R.PreviewViewer,{clipperState:this.state}):void 0,n=t.shouldShowRegionSelector(this.state)?m.component(x.RegionSelector,{clipperState:this.state}):void 0,o=t.shouldShowMainController(this.state)?{}:{display:"none"};return{tag:"div",attrs:{},children:[e,n,{tag:"div",attrs:{style:o},children:[m.component(L.MainController,{clipperState:this.state,onSignInInvoked:this.handleSignIn.bind(this),onSignOutInvoked:this.handleSignOut.bind(this),updateFrameHeight:this.updateFrameHeight.bind(this),onStartClip:this.handleStartClip.bind(this)})]}]}},t}(A.ComponentBase);a.Polyfills.init();var D=window.onerror;window.onerror=function(e,t,n,o,i){var r=i?P.Failure.getStackTrace(i):"[unknown stacktrace]";F.Clipper.logger.logFailure(P.Failure.Label.UnhandledExceptionThrown,P.Failure.Type.Unexpected,{error:e+" ("+t+":"+n+":"+o+") at "+r},"ClipperUI"),D&&D(e,t,n,o,i)};var M=H.componentize();n.Clipper=M,m.mount(document.getElementById("clipperUIPlaceholder"),M)},{"../communicator/communicator":54,"../communicator/iframeMessageHandler":55,"../communicator/inlineMessageHandler":56,"../communicator/smartValue":58,"../constants":59,"../contentCapture/augmentationHelper":60,"../contentCapture/bookmarkHelper":61,"../contentCapture/fullPageScreenshotHelper":62,"../contentCapture/pdfScreenshotHelper":63,"../domParsers/domUtils":66,"../domParsers/videoUtils":68,"../extensions/bookmarklet/inlineExtension":73,"../extensions/invokeOptions":77,"../http/cachedHttp":82,"../localization/localization":85,"../logging/communicatorLoggerPure":87,"../logging/log":88,"../polyfills":103,"../storage/clipperStorageKeys":107,"../userInfo":110,"../utils":111,"./clipMode":9,"./clipperState":11,"./componentBase":12,"./frontEndGlobals":36,"./mainController":37,"./oneNoteApiUtils":38,"./previewViewer":48,"./ratingsHelper":49,"./regionSelector":50,"./saveToOneNote":51,"./status":52,"./tooltipType":53}],11:[function(e,t,n){"use strict";var o,i=e("./clipMode"),r=e("./status");!function(e){function t(e){return e.userResult&&e.userResult.status&&e.userResult.data&&!!e.userResult.data.user}function n(e){switch(e.currentMode.get()){case i.ClipMode.FullPage:return!0;case i.ClipMode.Region:var t=e.regionResult;return t.status===r.Status.Succeeded&&t.data&&t.data.length>0;case i.ClipMode.Augmentation:var n=e.augmentationResult;return n.status===r.Status.Succeeded&&n.data&&!!n.data.ContentInHtml;case i.ClipMode.Bookmark:var o=e.bookmarkResult;return o.status===r.Status.Succeeded;case i.ClipMode.Selection:return!0;default:return}}e.isUserLoggedIn=t,e.clipButtonEnabled=n}(o=n.ClipperStateHelperFunctions||(n.ClipperStateHelperFunctions={}))},{"./clipMode":9,"./status":52}],12:[function(e,t,n){"use strict";var o=e("../constants"),i=e("./frontEndGlobals"),r=function(){function e(e){this.props=e,this.state=this.getInitialState(),this.refs={}}return e.prototype.getInitialState=function(){return{}},e.prototype.setState=function(e){m.startComputation();for(var t in e)e.hasOwnProperty(t)&&(this.state[t]=e[t]);m.endComputation()},e.prototype.ref=function(e){var t=this;return{config:function(n){t.refs[e]=n}}},e.prototype.onElementDraw=function(e){return e=e.bind(this),{config:function(t,n){e(t,!n)}}},e.prototype.onElementFirstDraw=function(e){return e=e.bind(this),{config:function(t,n){n||e(t)}}},e.prototype.enableInvoke=function(e,t,n,r){return void 0===t&&(t=0),void 0===r&&(r=void 0),e&&(e=e.bind(this,n)),{onclick:function(t){var n=t.currentTarget,o=r?r:n.id;i.Clipper.logger.logClickEvent(o),e&&e(t)},onkeyup:function(t){var n=t.currentTarget;if(t.which===o.Constants.KeyCodes.enter){if("A"!==n.tagName||!n.hasAttribute("href")){var r=n.id;i.Clipper.logger.logClickEvent(r),e&&e(t)}}else t.which===o.Constants.KeyCodes.tab&&(n.style.outlineStyle="")},onmousedown:function(e){var t=e.currentTarget;t.style.outlineStyle="none"},tabIndex:t}},e.componentize=function(){var e=this,t=function(){};return t.controller=function(t){return new e(t)},t.view=function(e,t){return e.props=t,e.render()},t},e}();n.ComponentBase=r},{"../constants":59,"./frontEndGlobals":36}],13:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../localization/localization"),a=e("../../utils"),s=e("../componentBase"),l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getInitialState=function(){return{opened:!!this.props.clipperState.previewGlobalInfo.annotation}},t.prototype.handleAnnotateButton=function(){this.setState({opened:!this.state.opened})},t.prototype.setFocus=function(e){e.focus()},t.prototype.addTextAreaListener=function(){var e=this;document.addEventListener("input",function(t){var n=t.target,o=document.getElementById(i.Constants.Ids.annotationField);n&&n===o&&e.handleAnnotationFieldChanged(o.value)})},t.prototype.handleAnnotationFieldChanged=function(e){this.props.clipperState.setState({previewGlobalInfo:{previewTitleText:this.props.clipperState.previewGlobalInfo.previewTitleText,annotation:e,fontSize:this.props.clipperState.previewGlobalInfo.fontSize,serif:this.props.clipperState.previewGlobalInfo.serif}})},t.prototype.onDoneEditing=function(e){var t=this,n=e.target.value.trim(),o=a.Utils.createUpdatedObject(this.props.clipperState.previewGlobalInfo,{annotation:n});if(this.props.clipperState.setState({
previewGlobalInfo:o}),""===n){var i=function(){t.setState({opened:!1}),window.removeEventListener("mouseup",i)};window.addEventListener("mouseup",i)}},t.prototype.render=function(){return t.textAreaListenerAttached||(this.addTextAreaListener(),t.textAreaListenerAttached=!0),this.state.opened?{tag:"div",attrs:{id:i.Constants.Ids.annotationContainer},children:[{tag:"pre",attrs:{id:i.Constants.Ids.annotationFieldMirror,className:i.Constants.Classes.textAreaInputMirror},children:[{tag:"span",attrs:{style:r.Localization.getFontFamilyAsStyle(r.Localization.FontFamily.Regular)},children:[this.props.clipperState.previewGlobalInfo.annotation?this.props.clipperState.previewGlobalInfo.annotation:""]},{tag:"br",attrs:{}}]},{tag:"textarea",attrs:Object.assign({id:i.Constants.Ids.annotationField,className:i.Constants.Classes.textAreaInput,rows:1,tabIndex:211,style:r.Localization.getFontFamilyAsStyle(r.Localization.FontFamily.Regular),value:this.props.clipperState.previewGlobalInfo.annotation?this.props.clipperState.previewGlobalInfo.annotation:"",onblur:this.onDoneEditing.bind(this)},this.onElementFirstDraw(this.setFocus))}]}:{tag:"div",attrs:{id:i.Constants.Ids.annotationContainer},children:[{tag:"a",attrs:Object.assign({id:i.Constants.Ids.annotationPlaceholder,style:r.Localization.getFontFamilyAsStyle(r.Localization.FontFamily.Regular)},this.enableInvoke(this.handleAnnotateButton,210)),children:[{tag:"img",attrs:{src:a.Utils.getImageResourceUrl("editorOptions/add_icon_purple.png")}},{tag:"span",attrs:{},children:[r.Localization.getLocalizedString("WebClipper.Label.AnnotationPlaceholder")]}]}]}},t.textAreaListenerAttached=!1,t}(s.ComponentBase),p=l.componentize();n.AnnotationInput=p},{"../../constants":59,"../../localization/localization":85,"../../utils":111,"../componentBase":12}],14:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../utils"),a=e("../componentBase"),s=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getInitialState=function(){return{}},t.prototype.render=function(){return{tag:"div",attrs:{id:i.Constants.Ids.closeButtonContainer},children:[{tag:"a",attrs:Object.assign({id:i.Constants.Ids.closeButton},this.enableInvoke(this.props.onClickHandler,300,this.props.onClickHandlerParams)),children:[{tag:"img",attrs:{className:"closeButtonIcon",src:r.Utils.getImageResourceUrl("close.png")}}]}]}},t}(a.ComponentBase),l=s.componentize();n.CloseButton=l},{"../../constants":59,"../../utils":111,"../componentBase":12}],15:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../clientType"),r=e("../../constants"),a=e("../../utils"),s=e("../../localization/localization"),l=e("../../logging/log"),p=e("../frontEndGlobals"),c=e("../clipperState"),u=e("../componentBase"),g=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getFeedbackWindowRef=function(){return this.feedbackWindowRef},t.prototype.getInitialState=function(){return{userSettingsOpened:!1}},t.prototype.userControlHandler=function(){this.setState({userSettingsOpened:!this.state.userSettingsOpened})},t.prototype.handleSignOutButton=function(){this.setState({userSettingsOpened:!1}),this.props.onSignOutInvoked&&this.props.onSignOutInvoked(this.props.clipperState.userResult.data.user.authType),this.props.clipperState.setState({userResult:void 0})},t.prototype.handleFeedbackButton=function(e,t){if(t.altKey&&t.shiftKey){var n=i.ClientType[this.props.clipperState.clientInfo.clipperType]+": "+this.props.clipperState.clientInfo.clipperVersion;return n+="\nID: "+this.props.clipperState.clientInfo.clipperId,n+="\nUsid: "+p.Clipper.getUserSessionId(),p.Clipper.logger.logEvent(new l.Event.BaseEvent(l.Event.Label.DebugFeedback)),void window.alert(n)}this.feedbackWindowRef&&!this.feedbackWindowRef.closed||(this.feedbackUrl||(this.feedbackUrl=a.Utils.generateFeedbackUrl(this.props.clipperState,p.Clipper.getUserSessionId(),r.Constants.LogCategories.oneNoteClipperUsage)),this.feedbackWindowRef=a.Utils.openPopupWindow(this.feedbackUrl))},t.prototype.render=function(){var e=c.ClipperStateHelperFunctions.isUserLoggedIn(this.props.clipperState);return{tag:"div",attrs:{id:r.Constants.Ids.clipperFooterContainer,className:"footerFont",style:s.Localization.getFontFamilyAsStyle(s.Localization.FontFamily.Regular)},children:[{tag:"div",attrs:{},children:[{tag:"div",attrs:{className:"footerButtonsLeft confineText"},children:[{tag:"a",attrs:Object.assign({id:r.Constants.Ids.feedbackButton},this.enableInvoke(this.handleFeedbackButton,80)),children:[{tag:"img",attrs:{id:r.Constants.Ids.feedbackImage,src:a.Utils.getImageResourceUrl("feedback_smiley.png"),alt:s.Localization.getLocalizedString("WebClipper.Action.Feedback")}},{tag:"span",attrs:{},children:[s.Localization.getLocalizedString("WebClipper.Action.Feedback")]}]}]},e?{tag:"div",attrs:{className:"footerButtonsRight"},children:[{tag:"a",attrs:Object.assign({id:r.Constants.Ids.currentUserControl},this.enableInvoke(this.userControlHandler,81)),children:[{tag:"img",attrs:{id:r.Constants.Ids.userDropdownArrow,src:a.Utils.getImageResourceUrl("dropdown_arrow.png")}},{tag:"div",attrs:{id:r.Constants.Ids.currentUserDetails},children:[this.props.clipperState.userResult.data.user.fullName?{tag:"div",attrs:{id:r.Constants.Ids.currentUserName,className:"confineText"},children:[this.props.clipperState.userResult.data.user.fullName]}:{tag:"div",attrs:{id:r.Constants.Ids.currentUserName,className:"confineText"}},{tag:"div",attrs:{id:r.Constants.Ids.currentUserId,className:"confineText currentUserIdFont",style:s.Localization.getFontFamilyAsStyle(s.Localization.FontFamily.Regular)},children:[this.props.clipperState.userResult.data.user.emailAddress]}]}]}]}:void 0]},this.state.userSettingsOpened?{tag:"div",attrs:{id:r.Constants.Ids.userSettingsContainer,className:"userSettingsFont",style:s.Localization.getFontFamilyAsStyle(s.Localization.FontFamily.Regular)},children:[{tag:"hr",attrs:{className:"userDivider"}},{tag:"div",attrs:{className:"userDetails confineText"},children:[{tag:"label",attrs:{id:r.Constants.Ids.currentUserEmail},children:[this.props.clipperState.userResult.data.user.emailAddress]},{tag:"a",attrs:Object.assign({id:r.Constants.Ids.signOutButton,className:"userActionButton"},this.enableInvoke(this.handleSignOutButton,82)),children:[s.Localization.getLocalizedString("WebClipper.Action.SignOut")]}]}]}:void 0]}},t}(u.ComponentBase),d=g.componentize();n.Footer=d},{"../../clientType":1,"../../constants":59,"../../localization/localization":85,"../../logging/log":88,"../../utils":111,"../clipperState":11,"../componentBase":12,"../frontEndGlobals":36}],16:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../localization/localization"),r=e("../componentBase"),a=e("../clipMode"),s=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.buttonHandler=function(){this.props.onModeSelected(this.props.myMode)},t.prototype.render=function(){var e="modeButton";this.props.selected&&(e+=" selected");var t=a.ClipMode[this.props.myMode];t=t[0].toLowerCase()+t.slice(1);var n=t+"Button";return{tag:"a",attrs:Object.assign({className:e,id:n,title:this.props.tooltipText?this.props.tooltipText:""},this.enableInvoke(this.buttonHandler,this.props.tabIndex)),children:[{tag:"img",attrs:{className:"icon",src:this.props.imgSrc}},{tag:"span",attrs:{className:"label buttonLabelFont",style:i.Localization.getFontFamilyAsStyle(i.Localization.FontFamily.Regular)},children:[this.props.label]}]}},t}(r.ComponentBase),l=s.componentize();n.ModeButton=l},{"../../localization/localization":85,"../clipMode":9,"../componentBase":12}],17:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../clientType"),r=e("../../utils"),a=e("../../contentCapture/augmentationHelper"),s=e("../../extensions/invokeOptions"),l=e("../../localization/localization"),p=e("../clipMode"),c=e("../componentBase"),u=e("./modeButton"),g=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.onModeSelected=function(e){this.props.clipperState.setState({currentMode:this.props.clipperState.currentMode.set(e)})},t.prototype.getAugmentationModeButton=function(e){var t=a.AugmentationHelper.getAugmentationType(this.props.clipperState),n=l.Localization.getLocalizedString("WebClipper.ClipType."+t+".Button"),o=l.Localization.getLocalizedString("WebClipper.ClipType.Button.Tooltip").replace("{0}",n);return m.component(u.ModeButton,{imgSrc:r.Utils.getImageResourceUrl(t+".png"),label:n,myMode:p.ClipMode.Augmentation,tabIndex:42,selected:e===p.ClipMode.Augmentation,onModeSelected:this.onModeSelected.bind(this),tooltipText:o})},t.prototype.getFullPageModeButton=function(e){return m.component(u.ModeButton,{imgSrc:r.Utils.getImageResourceUrl("fullpage.png"),label:l.Localization.getLocalizedString("WebClipper.ClipType.ScreenShot.Button"),myMode:p.ClipMode.FullPage,tabIndex:40,selected:!e||e===p.ClipMode.FullPage,onModeSelected:this.onModeSelected.bind(this),tooltipText:l.Localization.getLocalizedString("WebClipper.ClipType.ScreenShot.Button.Tooltip")})},t.prototype.getRegionModeButton=function(e){var t=this.props.clipperState.injectOptions&&this.props.clipperState.injectOptions.enableRegionClipping,n=this.props.clipperState.invokeOptions&&this.props.clipperState.invokeOptions.invokeMode===s.InvokeMode.ContextImage;if(t||n)return m.component(u.ModeButton,{imgSrc:r.Utils.getImageResourceUrl("region.png"),label:l.Localization.getLocalizedString(this.getRegionModeButtonLabel()),myMode:p.ClipMode.Region,tabIndex:41,selected:e===p.ClipMode.Region,onModeSelected:this.onModeSelected.bind(this),tooltipText:l.Localization.getLocalizedString("WebClipper.ClipType.MultipleRegions.Button.Tooltip")})},t.prototype.getRegionModeButtonLabel=function(){return this.props.clipperState.clientInfo.clipperType===i.ClientType.EdgeExtension?"WebClipper.ClipType.Image.Button":"WebClipper.ClipType.Region.Button"},t.prototype.getSelectionModeButton=function(e){if(this.props.clipperState.invokeOptions.invokeMode===s.InvokeMode.ContextTextSelection)return m.component(u.ModeButton,{imgSrc:r.Utils.getImageResourceUrl("select.png"),label:l.Localization.getLocalizedString("WebClipper.ClipType.Selection.Button"),myMode:p.ClipMode.Selection,tabIndex:43,selected:e===p.ClipMode.Selection,onModeSelected:this.onModeSelected.bind(this),tooltipText:l.Localization.getLocalizedString("WebClipper.ClipType.Selection.Button.Tooltip")})},t.prototype.getBookmarkModeButton=function(e){return m.component(u.ModeButton,{imgSrc:r.Utils.getImageResourceUrl("bookmark.png"),label:l.Localization.getLocalizedString("WebClipper.ClipType.Bookmark.Button"),myMode:p.ClipMode.Bookmark,tabIndex:44,selected:e===p.ClipMode.Bookmark,onModeSelected:this.onModeSelected.bind(this),tooltipText:l.Localization.getLocalizedString("WebClipper.ClipType.Bookmark.Button.Tooltip")})},t.prototype.render=function(){var e=this.props.clipperState.currentMode.get();return{tag:"div",attrs:{style:l.Localization.getFontFamilyAsStyle(l.Localization.FontFamily.Semilight)},children:[this.getFullPageModeButton(e),this.getRegionModeButton(e),this.getAugmentationModeButton(e),this.getSelectionModeButton(e),this.getBookmarkModeButton(e)]}},t}(c.ComponentBase),d=g.componentize();n.ModeButtonSelector=d},{"../../clientType":1,"../../contentCapture/augmentationHelper":60,"../../extensions/invokeOptions":77,"../../localization/localization":85,"../../utils":111,"../clipMode":9,"../componentBase":12,"./modeButton":16}],18:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../constants"),r=e("../../../utils"),a=e("../../../contentCapture/augmentationHelper"),s=e("../../../localization/localization"),l=e("../../status"),p=e("../../components/spriteAnimation"),c=e("./editorPreviewComponentBase"),u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getHighlightableContentBodyForCurrentStatus=function(){var e=this.props.clipperState;return this.convertAugmentationResultToContentData(e.augmentationResult)},t.prototype.getStatus=function(){return this.props.clipperState.augmentationResult.status},t.prototype.getTitleTextForCurrentStatus=function(){var e,t=s.Localization.getLocalizedString("WebClipper.Preview.NoContentFound"),n=this.getStatus();switch(n){case l.Status.Succeeded:return this.props.clipperState.augmentationResult.data&&this.props.clipperState.augmentationResult.data.ContentModel!==a.AugmentationModel.None?this.props.clipperState.previewGlobalInfo.previewTitleText:s.Localization.getLocalizedString("WebClipper.Preview.NoContentFound");case l.Status.NotStarted:case l.Status.InProgress:return s.Localization.getLocalizedString("WebClipper.Preview.LoadingMessage");default:case l.Status.Failed:return e=this.props.clipperState.augmentationResult.data.failureMessage,e?e:t}},t.prototype.handleBodyChange=function(e){this.props.clipperState.setState({augmentationPreviewInfo:{previewBodyHtml:e}})},t.prototype.convertAugmentationResultToContentData=function(e){switch(e.status){case l.Status.Succeeded:if(this.props.clipperState.augmentationResult.data&&this.props.clipperState.augmentationResult.data.ContentModel!==a.AugmentationModel.None)return m.trust(this.props.clipperState.augmentationPreviewInfo.previewBodyHtml);break;case l.Status.NotStarted:case l.Status.InProgress:return this.getSpinner();default:case l.Status.Failed:}},t.prototype.getSpinner=function(){var e=m.component(p.SpriteAnimation,{spriteUrl:r.Utils.getImageResourceUrl("spinner_loop_colored.png"),imageHeight:65,imageWidth:45,totalFrameCount:21,loop:!0});return{tag:"div",attrs:{className:i.Constants.Classes.centeredInPreview},children:[e]}},t}(c.EditorPreviewComponentBase),g=u.componentize();n.AugmentationPreview=g},{"../../../constants":59,"../../../contentCapture/augmentationHelper":60,"../../../localization/localization":85,"../../../utils":111,"../../components/spriteAnimation":35,"../../status":52,"./editorPreviewComponentBase":20}],19:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../constants"),r=e("../../../utils"),a=e("../../../localization/localization"),s=e("../../status"),l=e("../../components/spriteAnimation"),p=e("./previewComponentBase"),c=e("./previewViewerBookmarkHeader"),u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getStatus=function(){return this.props.clipperState.bookmarkResult.status},t.prototype.getTitleTextForCurrentStatus=function(){var e,t=a.Localization.getLocalizedString("WebClipper.Preview.BookmarkModeGenericError"),n=this.getStatus();switch(n){case s.Status.Succeeded:return this.props.clipperState.previewGlobalInfo.previewTitleText;case s.Status.NotStarted:case s.Status.InProgress:return a.Localization.getLocalizedString("WebClipper.Preview.LoadingMessage");default:case s.Status.Failed:return e=this.props.clipperState.bookmarkResult.data.failureMessage,e?e:t}},t.prototype.getContentBodyForCurrentStatus=function(){var e=this.getStatus();switch(e){case s.Status.Succeeded:return this.convertBookmarkResultToContentData(this.props.clipperState.bookmarkResult.data);case s.Status.NotStarted:case s.Status.InProgress:return[this.getSpinner()];default:case s.Status.Failed:return[]}},t.prototype.getSpinner=function(){var e=m.component(l.SpriteAnimation,{spriteUrl:r.Utils.getImageResourceUrl("spinner_loop_colored.png"),imageHeight:65,imageWidth:45,totalFrameCount:21,loop:!0});return{tag:"div",attrs:{className:i.Constants.Classes.centeredInPreview},children:[e]}},t.prototype.getHeader=function(){return m.component(c.PreviewViewerBookmarkHeader,{clipperState:this.props.clipperState})},t.prototype.getPreviewContentContainerClass=function(){return i.Constants.Ids.bookmarkPreviewContentContainer},t.prototype.getPreviewInnerContainerClass=function(){return i.Constants.Ids.bookmarkPreviewInnerContainer},t.prototype.convertBookmarkResultToContentData=function(e){var t=e.url,n="";r.Utils.isNullOrUndefined(e.thumbnailSrc)||(n+="padding-left:16px;");var o="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;";return r.Utils.isNullOrUndefined(e.description)||(o+="padding-bottom:13px;"),{tag:"table",attrs:{style:"table-layout:auto;border-collapse:collapse;margin-bottom:24px;"},children:[{tag:"tr",attrs:{style:"vertical-align:top;"},children:[this.renderThumbnailIfExists(e.thumbnailSrc),{tag:"td",attrs:{style:n},children:[{tag:"table",attrs:{},children:[this.renderTitleIfExists(e.title),{tag:"tr",attrs:{},children:[{tag:"td",attrs:{style:o},children:[{tag:"a",attrs:{href:t,target:"_blank",title:t},children:[t]}]}]},this.renderDescriptionIfExists(e.description)]}]}]}]}},t.prototype.renderTitleIfExists=function(e){if(!r.Utils.isNullOrUndefined(e)&&e.length>0)return{tag:"tr",attrs:{},children:[{tag:"td",attrs:{},children:[{tag:"h2",attrs:{style:"margin:0;margin-bottom:13px;"},children:[e]}]}]}},t.prototype.renderDescriptionIfExists=function(e){if(!r.Utils.isNullOrUndefined(e)&&e.length>0)return{tag:"tr",attrs:{},children:[{tag:"td",attrs:{style:"word-wrap:break-word;"},children:[e]}]}},t.prototype.renderThumbnailIfExists=function(e){if(!r.Utils.isNullOrUndefined(e)&&e.length>0){var t="112";return{tag:"td",attrs:{width:t,style:"padding-top:9px;"},children:[{tag:"img",attrs:{id:i.Constants.Ids.bookmarkThumbnail,src:e,alt:"thumbnail",width:t}}]}}},t}(p.PreviewComponentBase),g=u.componentize();n.BookmarkPreview=g},{"../../../constants":59,"../../../localization/localization":85,"../../../utils":111,"../../components/spriteAnimation":35,"../../status":52,"./previewComponentBase":22,"./previewViewerBookmarkHeader":24}],20:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../constants"),r=e("../../../utils"),a=e("../../../highlighting/highlighter"),s=e("./previewComponentBase"),l=e("./previewViewerAugmentationHeader"),p=function(e){function t(n){e.call(this,n),this.clickHandler=this.handleClick.bind(this),t.currentClickHandler&&window.removeEventListener("click",t.currentClickHandler),window.addEventListener("click",this.clickHandler),t.currentClickHandler=this.clickHandler}return o(t,e),t.prototype.getContentBodyForCurrentStatus=function(){return[{tag:"div",attrs:{id:i.Constants.Ids.highlightablePreviewBody},children:[this.getHighlightableContentBodyForCurrentStatus()]}]},t.prototype.getPreviewBodyConfig=function(){this.state.textHighlighter||this.setHighlighter(),this.props.clipperState.previewGlobalInfo.highlighterEnabled?this.state.textHighlighter.enable():this.state.textHighlighter.disable()},t.prototype.getHeader=function(){return m.component(l.PreviewViewerAugmentationHeader,{toggleHighlight:this.toggleHighlight.bind(this),changeFontFamily:this.changeFontFamily.bind(this),changeFontSize:this.changeFontSize.bind(this),serif:this.props.clipperState.previewGlobalInfo.serif,textHighlighterEnabled:this.props.clipperState.previewGlobalInfo.highlighterEnabled})},t.prototype.getPreviewBodyClass=function(){return this.state.textHighlighter&&this.state.textHighlighter.isEnabled()?i.Constants.Classes.highlightable:""},t.prototype.changeFontFamily=function(e){var t=r.Utils.createUpdatedObject(this.props.clipperState.previewGlobalInfo,{serif:e});this.props.clipperState.setState({previewGlobalInfo:t})},t.prototype.changeFontSize=function(e){var t=this.props.clipperState.previewGlobalInfo.fontSize+(e?2:-2);t<i.Constants.Settings.minimumFontSize?t=i.Constants.Settings.minimumFontSize:t>i.Constants.Settings.maximumFontSize&&(t=i.Constants.Settings.maximumFontSize);var n=r.Utils.createUpdatedObject(this.props.clipperState.previewGlobalInfo,{fontSize:t});this.props.clipperState.setState({previewGlobalInfo:n})},t.prototype.deleteHighlight=function(e){for(var t=document.getElementById(i.Constants.Ids.highlightablePreviewBody),n=t.querySelectorAll("span.highlighted[data-timestamp='"+e+"']"),o=0;o<n.length;o++){var r=n[o],a=r.parentNode;a.insertBefore(document.createTextNode(r.innerText),r),a.removeChild(r)}this.handleBodyChange(t.innerHTML)},t.prototype.handleClick=function(e){if(e&&e.target){var t=e.target;t.className&&t.className.indexOf(i.Constants.Classes.deleteHighlightButton)!==-1&&(this.deleteHighlight(parseInt(t.getAttribute("data-timestamp"),10)),e.preventDefault())}},t.prototype.setHighlighter=function(){var e=this,t=function(t,n){if(n&&n.length>0){for(var o=document.getElementById(i.Constants.Ids.highlightablePreviewBody),a=n.map(function(e){return parseInt(e.getAttribute("data-timestamp"),10)}),s=Math.max.apply(void 0,a),l=0;l<n.length;l++)for(var p=n[l].getAttribute("data-timestamp"),c=o.querySelectorAll("span."+i.Constants.Classes.highlighted+"[data-timestamp='"+p+"']"),u=0;u<c.length;u++){for(var g=c[u].querySelectorAll("img."+i.Constants.Classes.deleteHighlightButton),d=0;d<g.length;d++)g[d].parentNode.removeChild(g[d]);c[u].setAttribute("data-timestamp",""+s)}var m=o.querySelector("span.highlighted[data-timestamp='"+s+"']");if(m){var h=document.createElement("img");h.src=r.Utils.getImageResourceUrl("editoroptions/delete_button.png"),h.className=i.Constants.Classes.deleteHighlightButton,h.setAttribute("data-timestamp",""+s),m.insertBefore(h,m.childNodes[0])}e.handleBodyChange(o.innerHTML)}},n=a.Highlighter.reconstructInstance(document.getElementById(i.Constants.Ids.highlightablePreviewBody),{color:i.Constants.Styles.Colors.oneNoteHighlightColor,contextClass:i.Constants.Classes.highlightable,onAfterHighlight:t});this.setState({textHighlighter:n})},t.prototype.toggleHighlight=function(){if(this.props.clipperState.previewGlobalInfo.highlighterEnabled||window.getSelection().isCollapsed||!this.selectionIsInPreviewBody()){var e=r.Utils.createUpdatedObject(this.props.clipperState.previewGlobalInfo,{highlighterEnabled:!this.props.clipperState.previewGlobalInfo.highlighterEnabled});this.props.clipperState.setState({previewGlobalInfo:e})}else this.state.textHighlighter.doHighlight()},t.prototype.selectionIsInPreviewBody=function(){var e=document.getElementById(i.Constants.Ids.highlightablePreviewBody);if(!e)return!1;var t=window.getSelection();if(t.rangeCount>0){for(var n=0;n<t.rangeCount;n++){var o=t.getRangeAt(n).commonAncestorContainer;if(o!==e&&!e.contains(o))return!1}return!0}return!1},t}(s.PreviewComponentBase);n.EditorPreviewComponentBase=p},{"../../../constants":59,"../../../highlighting/highlighter":81,"../../../utils":111,"./previewComponentBase":22,"./previewViewerAugmentationHeader":23}],21:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../constants"),r=e("../../../utils"),a=e("../../../localization/localization"),s=e("../../status"),l=e("../../components/rotatingMessageSpriteAnimation"),p=e("./previewComponentBase"),c=e("./previewViewerFullPageHeader"),u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getContentBodyForCurrentStatus=function(){var e=this.props.clipperState;return e.pageInfo?e.pageInfo.contentType===OneNoteApi.ContentType.EnhancedUrl?this.convertPdfResultToContentData(e.pdfResult):this.convertFullPageResultToContentData(e.fullPageResult):[this.getSpinner()]},t.prototype.getHeader=function(){return m.component(c.PreviewViewerFullPageHeader,{clipperState:this.props.clipperState})},t.prototype.getStatus=function(){return this.props.clipperState.pageInfo?this.props.clipperState.pageInfo.contentType===OneNoteApi.ContentType.EnhancedUrl?this.props.clipperState.pdfResult.status:this.props.clipperState.fullPageResult.status:s.Status.NotStarted},t.prototype.getTitleTextForCurrentStatus=function(){var e,t=a.Localization.getLocalizedString("WebClipper.Preview.NoContentFound"),n=this.getStatus(),o=this.props.clipperState.pageInfo;switch(n){case s.Status.Succeeded:return o&&o.contentType!==OneNoteApi.ContentType.EnhancedUrl&&!this.props.clipperState.fullPageResult.data?a.Localization.getLocalizedString("WebClipper.Preview.NoContentFound"):this.props.clipperState.previewGlobalInfo.previewTitleText;case s.Status.NotStarted:case s.Status.InProgress:return a.Localization.getLocalizedString("WebClipper.Preview.LoadingMessage");default:case s.Status.Failed:return e=o&&o.contentType===OneNoteApi.ContentType.EnhancedUrl?this.props.clipperState.pdfResult.data.get().failureMessage:this.props.clipperState.fullPageResult.data.failureMessage,e?e:t}},t.prototype.convertFullPageResultToContentData=function(e){var t=[];switch(e.status){case s.Status.Succeeded:if(this.props.clipperState.fullPageResult.data)for(var n=this.props.clipperState.fullPageResult.data,o=0,i=n.Images;o<i.length;o++){var r=i[o],a="data:image/"+n.ImageFormat+";"+n.ImageEncoding+","+r;t.push({tag:"img",attrs:{src:a}})}break;case s.Status.NotStarted:case s.Status.InProgress:t.push(this.getSpinner());break;default:case s.Status.Failed:}return t},t.prototype.convertPdfResultToContentData=function(e){var t=[];switch(e.status){case s.Status.Succeeded:var n="Original.pdf",o=this.props.clipperState.pageInfo?r.Utils.getFileNameFromUrl(this.props.clipperState.pageInfo.rawUrl,n):n;t.push({tag:"span",attrs:{className:"attachment-overlay"},children:[{tag:"img",attrs:{src:r.Utils.getImageResourceUrl("editorOptions/pdf_attachment_icon.png")}},{tag:"div",attrs:{className:"file-name"},children:[o.split(".")[0]]}]});for(var i=0,a=this.props.clipperState.pdfResult.data.get().dataUrls;i<a.length;i++){var l=a[i];t.push({tag:"img",attrs:{src:l}})}break;case s.Status.NotStarted:case s.Status.InProgress:t.push(this.getSpinner());break;default:case s.Status.Failed:}return t},t.prototype.getSpinner=function(){var e=m.component(l.RotatingMessageSpriteAnimation,{spriteUrl:r.Utils.getImageResourceUrl("spinner_loop_colored.png"),imageHeight:65,imageWidth:45,totalFrameCount:21,loop:!0});return{tag:"div",attrs:{className:i.Constants.Classes.centeredInPreview},children:[e]}},t}(p.PreviewComponentBase),g=u.componentize();n.FullPagePreview=g},{"../../../constants":59,"../../../localization/localization":85,"../../../utils":111,"../../components/rotatingMessageSpriteAnimation":33,"../../status":52,"./previewComponentBase":22,"./previewViewerFullPageHeader":25}],22:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../clientType"),r=e("../../../constants"),a=e("../../../utils"),s=e("../../../localization/localization"),l=e("../../clipMode"),p=e("../../clipperState"),c=e("../../componentBase"),u=e("../../status"),g=e("../annotationInput"),d=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getPreviewBodyConfig=function(){},t.prototype.addTextAreaListener=function(){var e=this;document.addEventListener("input",function(t){var n=t.target,o=document.getElementById(r.Constants.Ids.previewHeaderInput);n&&n===o&&e.handleTitleChange(o.value)})},t.prototype.handleTitleChange=function(e){var t=a.Utils.createUpdatedObject(this.props.clipperState.previewGlobalInfo,{previewTitleText:e});this.props.clipperState.setState({previewGlobalInfo:t})},t.prototype.getPreviewTitle=function(e,t,n){if(this.props.clipperState.currentMode.get()!==l.ClipMode.Bookmark)return{tag:"div",attrs:{id:r.Constants.Ids.previewTitleContainer},children:[{tag:"pre",attrs:{className:r.Constants.Classes.textAreaInputMirror},children:[{tag:"span",attrs:{},children:[e]},{tag:"br",attrs:{}}]},{tag:"textarea",attrs:Object.assign({},this.enableInvoke(void 0,200),{rows:"1",id:r.Constants.Ids.previewHeaderInput,className:t?r.Constants.Classes.textAreaInput:r.Constants.Classes.textAreaInput+n,value:e,readOnly:!t})}]}},t.prototype.getPreviewSubtitle=function(){var e=s.Localization.getLocalizedString("WebClipper.FromCitation").replace("{0}",""),t=this.props.clipperState.pageInfo?this.props.clipperState.pageInfo.rawUrl:"";return{tag:"div",attrs:{id:r.Constants.Ids.previewSubtitleContainer},children:[this.props.clipperState.injectOptions&&this.props.clipperState.injectOptions.enableAddANote?m.component(g.AnnotationInput,{clipperState:this.props.clipperState}):void 0,this.props.clipperState.currentMode.get()!==l.ClipMode.Bookmark?{tag:"div",attrs:{id:r.Constants.Ids.previewUrlContainer},children:[e,{tag:"a",attrs:{href:t,target:"_blank",title:t},children:[t]}]}:void 0]}},t.prototype.getPreviewBodyClass=function(){return""},t.prototype.getPreviewContentContainerClass=function(){return""},t.prototype.getPreviewInnerContainerClass=function(){return""},t.prototype.render=function(){t.textAreaListenerAttached||(this.addTextAreaListener(),t.textAreaListenerAttached=!0);var e=this.getTitleTextForCurrentStatus(),n=this.getContentBodyForCurrentStatus(),o=this.props.clipperState.injectOptions&&this.props.clipperState.injectOptions.enableEditableTitle,a=o&&this.getStatus()===u.Status.Succeeded&&e===this.props.clipperState.previewGlobalInfo.previewTitleText,l=p.ClipperStateHelperFunctions.clipButtonEnabled(this.props.clipperState),c=this.props.clipperState.previewGlobalInfo.serif?"WebClipper.FontFamily.Preview.SerifDefault":"WebClipper.FontFamily.Preview.SansSerifDefault",g={fontFamily:s.Localization.getLocalizedString(c),fontSize:this.props.clipperState.previewGlobalInfo.fontSize.toString()+"px"},d=this.getStatus(),m=d===u.Status.InProgress?" in-progress":"",h=this.props.clipperState.clientInfo.clipperType===i.ClientType.Bookmarklet?"":this.getPreviewInnerContainerClass();return{tag:"div",attrs:{id:r.Constants.Ids.previewOuterContainer,style:s.Localization.getFontFamilyAsStyle(s.Localization.FontFamily.Regular)},children:[{tag:"div",attrs:{id:r.Constants.Ids.previewInnerWrapper},children:[{tag:"div",attrs:{id:r.Constants.Ids.previewInnerContainer,className:h},children:[{tag:"div",attrs:{id:r.Constants.Ids.previewOptionsContainer},children:[this.getHeader()]},{tag:"div",attrs:{id:r.Constants.Ids.previewContentContainer,className:m+" "+this.getPreviewContentContainerClass()},children:[{tag:"div",attrs:{id:r.Constants.Ids.previewHeaderContainer},children:[this.getPreviewTitle(e,a,m),l?this.getPreviewSubtitle():void 0]},{tag:"div",attrs:{style:g,id:r.Constants.Ids.previewBody,className:m+" "+this.getPreviewBodyClass(),config:this.getPreviewBodyConfig.bind(this)},children:[n]}]}]}]}]}},t.textAreaListenerAttached=!1,t}(c.ComponentBase);n.PreviewComponentBase=d},{"../../../clientType":1,"../../../constants":59,"../../../localization/localization":85,"../../../utils":111,"../../clipMode":9,"../../clipperState":11,"../../componentBase":12,"../../status":52,"../annotationInput":13}],23:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../constants"),r=e("../../../utils"),a=e("../../../localization/localization"),s=e("./previewViewerHeaderComponentBase"),l=function(e){
function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getControlGroups=function(){return[this.getHighlightGroup(),this.getSerifGroup(),this.getFontSizeGroup()]},t.prototype.getHighlightGroup=function(){var e=this.props.textHighlighterEnabled,t=e?s.HeaderClasses.Button.active:"",n=e?"editorOptions/highlight_tool_on.png":"editorOptions/highlight_tool_off.png";return{id:i.Constants.Ids.highlightControl,innerElements:[{tag:"img",attrs:Object.assign({id:i.Constants.Ids.highlightButton},this.enableInvoke(this.props.toggleHighlight,100),{className:t,src:r.Utils.getImageResourceUrl(n)})}]}},t.prototype.getSerifGroup=function(){return{id:i.Constants.Ids.serifControl,innerElements:[{tag:"button",attrs:Object.assign({id:i.Constants.Ids.sansSerif},this.enableInvoke(this.props.changeFontFamily,101,!1),{className:this.props.serif?s.HeaderClasses.Button.controlButton:s.HeaderClasses.Button.activeControlButton,type:"button"}),children:[a.Localization.getLocalizedString("WebClipper.Preview.Header.SansSerifButtonLabel")]},{tag:"button",attrs:Object.assign({id:i.Constants.Ids.serif},this.enableInvoke(this.props.changeFontFamily,102,!0),{className:this.props.serif?s.HeaderClasses.Button.activeControlButton:s.HeaderClasses.Button.controlButton,type:"button"}),children:[a.Localization.getLocalizedString("WebClipper.Preview.Header.SerifButtonLabel")]}]}},t.prototype.getFontSizeGroup=function(){return{className:s.HeaderClasses.Button.relatedButtons,innerElements:[{tag:"button",attrs:Object.assign({className:s.HeaderClasses.Button.controlButton,type:"button"},this.enableInvoke(this.props.changeFontSize,103,!1),{id:i.Constants.Ids.decrementFontSize}),children:[{tag:"img",attrs:{src:r.Utils.getImageResourceUrl("editorOptions/font_down.png")}}]},{tag:"button",attrs:Object.assign({className:s.HeaderClasses.Button.controlButton,type:"button"},this.enableInvoke(this.props.changeFontSize,104,!0),{id:i.Constants.Ids.incrementFontSize}),children:[{tag:"img",attrs:{src:r.Utils.getImageResourceUrl("editorOptions/font_up.png")}}]}]}},t}(s.PreviewViewerHeaderComponentBase),p=l.componentize();n.PreviewViewerAugmentationHeader=p},{"../../../constants":59,"../../../localization/localization":85,"../../../utils":111,"./previewViewerHeaderComponentBase":26}],24:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../constants"),r=e("../../../localization/localization"),a=e("./previewViewerTitleOnlyHeaderComponentBase"),s=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getControlGroupId=function(){return i.Constants.Ids.bookmarkControl},t.prototype.getHeader=function(){return r.Localization.getLocalizedString("WebClipper.ClipType.Bookmark.Button")},t.prototype.getHeaderId=function(){return i.Constants.Ids.bookmarkHeaderTitle},t}(a.PreviewViewerTitleOnlyHeaderComponentBase),l=s.componentize();n.PreviewViewerBookmarkHeader=l},{"../../../constants":59,"../../../localization/localization":85,"./previewViewerTitleOnlyHeaderComponentBase":29}],25:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../constants"),r=e("../../../localization/localization"),a=e("./previewViewerTitleOnlyHeaderComponentBase"),s=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getControlGroupId=function(){return i.Constants.Ids.fullPageControl},t.prototype.getHeader=function(){return r.Localization.getLocalizedString("WebClipper.ClipType.ScreenShot.Button")},t.prototype.getHeaderId=function(){return i.Constants.Ids.fullPageHeaderTitle},t}(a.PreviewViewerTitleOnlyHeaderComponentBase),l=s.componentize();n.PreviewViewerFullPageHeader=l},{"../../../constants":59,"../../../localization/localization":85,"./previewViewerTitleOnlyHeaderComponentBase":29}],26:[function(e,t,n){"use strict";var o,i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=e("../../componentBase");!function(e){var t;!function(e){e.active=" active",e.controlButton=" control-button",e.relatedButtons=" related-buttons",e.activeControlButton=e.active+e.controlButton}(t=e.Button||(e.Button={}))}(o=n.HeaderClasses||(n.HeaderClasses={}));var a=function(e){function t(){e.apply(this,arguments)}return i(t,e),t.prototype.render=function(){for(var e="control-button-group",t=[],n=this.getControlGroups(),o=0;o<n.length;o++){var i=n[o].id,r=n[o].className;t.push({tag:"div",attrs:{id:i?i:"",className:r?r:e},children:[n[o].innerElements]})}return{tag:"div",attrs:{},children:[t]}},t}(r.ComponentBase);n.PreviewViewerHeaderComponentBase=a},{"../../componentBase":12}],27:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../constants"),r=e("../../../utils"),a=e("../../../localization/localization"),s=e("../../status"),l=e("./previewViewerHeaderComponentBase"),p=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.addAnotherRegion=function(){this.props.clipperState.setState({regionResult:{status:s.Status.InProgress,data:this.props.clipperState.regionResult.data}})},t.prototype.getControlGroups=function(){return[this.getAddRegionGroup()]},t.prototype.getAddRegionGroup=function(){return{id:i.Constants.Ids.addRegionControl,innerElements:[{tag:"button",attrs:Object.assign({id:i.Constants.Ids.addAnotherRegionButton},this.enableInvoke(this.addAnotherRegion.bind(this),100),{className:l.HeaderClasses.Button.controlButton,style:a.Localization.getFontFamilyAsStyle(a.Localization.FontFamily.Regular),type:"button"}),children:[{tag:"img",attrs:{src:r.Utils.getImageResourceUrl("editorOptions/add_icon.png")}},{tag:"span",attrs:{},children:[a.Localization.getLocalizedString("WebClipper.Preview.Header.AddAnotherRegionButtonLabel")]}]}]}},t}(l.PreviewViewerHeaderComponentBase),c=p.componentize();n.PreviewViewerRegionHeader=c},{"../../../constants":59,"../../../localization/localization":85,"../../../utils":111,"../../status":52,"./previewViewerHeaderComponentBase":26}],28:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../constants"),r=e("../../../localization/localization"),a=e("./previewViewerTitleOnlyHeaderComponentBase"),s=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getControlGroupId=function(){return i.Constants.Ids.regionControl},t.prototype.getHeader=function(){return r.Localization.getLocalizedString("WebClipper.ClipType.Region.Button")},t.prototype.getHeaderId=function(){return i.Constants.Ids.regionHeaderTitle},t}(a.PreviewViewerTitleOnlyHeaderComponentBase),l=s.componentize();n.PreviewViewerRegionTitleOnlyHeader=l},{"../../../constants":59,"../../../localization/localization":85,"./previewViewerTitleOnlyHeaderComponentBase":29}],29:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../localization/localization"),r=e("./previewViewerHeaderComponentBase"),a=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getControlGroups=function(){return[this.getTitleGroup(this.getControlGroupId(),this.getHeader(),this.getHeaderId())]},t.prototype.getTitleGroup=function(e,t,n){return{id:e,innerElements:[{tag:"div",attrs:{id:n,style:i.Localization.getFontFamilyAsStyle(i.Localization.FontFamily.Regular),className:"buttonLabelFont"},children:[{tag:"span",attrs:{},children:[t]}]}]}},t}(r.PreviewViewerHeaderComponentBase);n.PreviewViewerTitleOnlyHeaderComponentBase=a},{"../../../localization/localization":85,"./previewViewerHeaderComponentBase":26}],30:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../../localization/localization"),r=e("../../status"),a=e("../../components/regionSelection"),s=e("./previewComponentBase"),l=e("./previewViewerRegionHeader"),p=e("./previewViewerRegionTitleOnlyHeader"),c=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getContentBodyForCurrentStatus=function(){var e=this.props.clipperState;return this.convertRegionResultToContentData(e.regionResult)},t.prototype.getHeader=function(){return this.props.clipperState.injectOptions.enableRegionClipping?m.component(l.PreviewViewerRegionHeader,{clipperState:this.props.clipperState}):m.component(p.PreviewViewerRegionTitleOnlyHeader,{clipperState:this.props.clipperState})},t.prototype.getStatus=function(){return this.props.clipperState.regionResult.status},t.prototype.getTitleTextForCurrentStatus=function(){var e=i.Localization.getLocalizedString("WebClipper.Preview.NoContentFound"),t=this.getStatus();switch(t){case r.Status.Succeeded:return this.props.clipperState.previewGlobalInfo.previewTitleText;case r.Status.NotStarted:case r.Status.InProgress:return i.Localization.getLocalizedString("WebClipper.Preview.LoadingMessage");default:case r.Status.Failed:return e}},t.prototype.convertRegionResultToContentData=function(e){var t=this,n=[];switch(e.status){case r.Status.Succeeded:for(var o=this.props.clipperState.regionResult.data,i=this.props.clipperState.injectOptions&&this.props.clipperState.injectOptions.enableRegionClipping?function(e){var n=t.props.clipperState.regionResult.data;n.splice(e,1),0===n.length?t.props.clipperState.setState({regionResult:{status:r.Status.NotStarted,data:n}}):t.props.clipperState.setState({regionResult:{status:r.Status.Succeeded,data:n}})}:void 0,s=0;s<o.length;s++)n.push(m.component(a.RegionSelection,{index:s,imageSrc:o[s],onRemove:i}));break;default:case r.Status.NotStarted:case r.Status.InProgress:case r.Status.Failed:}return n},t}(s.PreviewComponentBase),u=c.componentize();n.RegionPreview=u},{"../../../localization/localization":85,"../../components/regionSelection":32,"../../status":52,"./previewComponentBase":22,"./previewViewerRegionHeader":27,"./previewViewerRegionTitleOnlyHeader":28}],31:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../status"),r=e("./editorPreviewComponentBase"),a=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getHighlightableContentBodyForCurrentStatus=function(){return m.trust(this.props.clipperState.selectionPreviewInfo.previewBodyHtml)},t.prototype.getStatus=function(){return i.Status.Succeeded},t.prototype.getTitleTextForCurrentStatus=function(){return this.props.clipperState.previewGlobalInfo.previewTitleText},t.prototype.handleBodyChange=function(e){this.props.clipperState.setState({selectionPreviewInfo:{previewBodyHtml:e}})},t}(r.EditorPreviewComponentBase),s=a.componentize();n.SelectionPreview=s},{"../../status":52,"./editorPreviewComponentBase":20}],32:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../utils"),r=e("../../logging/log"),a=e("../componentBase"),s=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.buttonHandler=function(){this.props.onRemove&&this.props.onRemove(this.props.index)},t.prototype.getRemoveButton=function(){return this.props.onRemove?{tag:"a",attrs:Object.assign({className:"region-selection-remove-button"},this.enableInvoke(this.buttonHandler,300,void 0,r.Click.Label.regionSelectionRemoveButton)),children:[{tag:"img",attrs:{src:i.Utils.getImageResourceUrl("editorOptions/delete_button.png")}}]}:void 0},t.prototype.render=function(){return{tag:"div",attrs:{},children:[{tag:"p",attrs:{className:"region-selection"},children:[this.getRemoveButton(),{tag:"img",attrs:{className:"region-selection-image",src:this.props.imageSrc}}]}]}},t}(a.ComponentBase),l=s.componentize();n.RegionSelection=l},{"../../logging/log":88,"../../utils":111,"../componentBase":12}],33:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../localization/localization"),a=e("../componentBase"),s=e("./spriteAnimation"),l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.render=function(){return{tag:"div",attrs:{},children:[m.component(s.SpriteAnimation,{spriteUrl:this.props.spriteUrl,imageHeight:this.props.imageHeight,imageWidth:this.props.imageWidth,totalFrameCount:this.props.totalFrameCount,loop:this.props.loop}),{tag:"div",attrs:{id:i.Constants.Ids.spinnerText,className:"spinnerText",style:r.Localization.getFontFamilyAsStyle(r.Localization.FontFamily.Semilight)},children:[r.Localization.getLocalizedString("WebClipper.Preview.Spinner.ClipAnyTimeInFullPage")]}]}},t}(a.ComponentBase),p=l.componentize();n.RotatingMessageSpriteAnimation=p},{"../../constants":59,"../../localization/localization":85,"../componentBase":12,"./spriteAnimation":35}],34:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../settings"),a=e("../../localization/localization"),s=e("../../logging/log"),l=e("../../storage/clipperStorageKeys"),p=e("../frontEndGlobals"),c=e("../clipperState"),u=e("../componentBase"),g=e("../oneNoteApiUtils"),d=e("../status"),h=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getInitialState=function(){return{notebooks:void 0,status:d.Status.NotStarted,curSection:void 0}},t.prototype.onSectionClicked=function(e){this.props.clipperState.setState({saveLocation:e.section.id}),this.setState({curSection:e}),p.Clipper.storeValue(l.ClipperStorageKeys.currentSelectedSection,JSON.stringify(e)),p.Clipper.logger.logClickEvent(s.Click.Label.sectionComponent)},t.prototype.onPopupToggle=function(e){e&&p.Clipper.logger.logClickEvent(s.Click.Label.sectionPickerLocationContainer),this.props.onPopupToggle(e)},t.prototype.setDataSource=function(){if(!c.ClipperStateHelperFunctions.isUserLoggedIn(this.props.clipperState))return!1;var e=this.props.clipperState.userResult.data.user.accessToken;return t.dataSource=new OneNotePicker.OneNotePickerDataSource(e),!0},t.prototype.retrieveAndUpdateNotebookAndSectionSelection=function(){var e=this;return new Promise(function(n,o){e.dataSourceUninitialized()&&e.setDataSource(),e.setState({status:d.Status.InProgress}),e.fetchCachedNotebookAndSectionInfoAsState(function(r){r&&(e.setState(r),e.props.clipperState.setState({saveLocation:r.curSection&&r.curSection.section?r.curSection.section.id:""}));var a=new s.Event.PromiseEvent(s.Event.Label.GetNotebooks);e.fetchFreshNotebooks(p.Clipper.getUserSessionId()).then(function(r){var c=r.request.getResponseHeader(i.Constants.HeaderValues.correlationId);a.setCustomProperty(s.PropertyName.Custom.CorrelationId,c);var u=r.parsedResponse;if(!u){a.setStatus(s.Status.Failed);var g={error:"GetNotebooks Promise was resolved but returned null or undefined value for notebooks."};return a.setFailureInfo(g),e.setState({status:d.Status.Failed}),void o(g)}a.setCustomProperty(s.PropertyName.Custom.MaxDepth,OneNoteApi.NotebookUtils.getDepthOfNotebooks(u)),p.Clipper.storeValue(l.ClipperStorageKeys.cachedNotebooks,JSON.stringify(u));var m=t.convertNotebookListToState(u),h=!0;if(e.state.curSection&&e.state.curSection.section){var f=OneNoteApi.NotebookUtils.sectionExistsInNotebooks(u,e.state.curSection.section.id);f&&(m.curSection=e.state.curSection,h=!1),a.setCustomProperty(s.PropertyName.Custom.CurrentSectionStillExists,f)}h&&(p.Clipper.storeValue(l.ClipperStorageKeys.currentSelectedSection,JSON.stringify(m.curSection)),e.props.clipperState.setState({saveLocation:m.curSection?m.curSection.section.id:void 0})),e.setState(m),n(m)},function(t){e.setState({apiResponseCode:g.OneNoteApiUtils.getApiResponseCode(t)}),e.state.notebooks?t.error+=". Falling back to storage.":e.setState({status:d.Status.Failed}),g.OneNoteApiUtils.logOneNoteApiRequestError(a,t),o(t)}).then(function(){p.Clipper.logger.logEvent(a)})})})},t.prototype.dataSourceUninitialized=function(){return!t.dataSource||!t.dataSource.authToken||!c.ClipperStateHelperFunctions.isUserLoggedIn(this.props.clipperState)||t.dataSource.authToken!==this.props.clipperState.userResult.data.user.accessToken},t.prototype.fetchCachedNotebookAndSectionInfoAsState=function(e){p.Clipper.getStoredValue(l.ClipperStorageKeys.cachedNotebooks,function(t){p.Clipper.getStoredValue(l.ClipperStorageKeys.currentSelectedSection,function(n){if(t){var o=void 0;try{o=JSON.parse(t)}catch(e){p.Clipper.logger.logJsonParseUnexpected(t)}var i=void 0;if(o&&n)try{i=JSON.parse(n)}catch(e){p.Clipper.logger.logJsonParseUnexpected(n)}e({notebooks:o,status:d.Status.Succeeded,curSection:i})}else e(void 0)})})},t.prototype.fetchFreshNotebooks=function(e){return this.dataSourceUninitialized()&&this.setDataSource(),new Promise(function(n,o){var a={};a[i.Constants.HeaderValues.appIdKey]=r.Settings.getSetting("App_Id"),a[i.Constants.HeaderValues.userSessionIdKey]=e,t.dataSource.getNotebooks(a).then(function(e){n(e)},function(e){o(e)})})},t.convertNotebookListToState=function(e){var n=OneNoteApi.NotebookUtils.getPathFromNotebooksToSection(e,function(e){return e.isDefault}),o=t.formatSectionInfoForStorage(n);return{notebooks:e,status:d.Status.Succeeded,curSection:o}},t.formatSectionInfoForStorage=function(e){if(e&&0!==e.length)return{path:e.map(function(e){return e.name}).join(" > "),section:e[e.length-1]}},t.prototype.render=function(){var e=this;if(this.dataSourceUninitialized()){var t=this.setDataSource();t&&this.retrieveAndUpdateNotebookAndSectionSelection()}else this.state.notebooks||this.state.status!==d.Status.NotStarted||this.fetchCachedNotebookAndSectionInfoAsState(function(t){t&&(e.setState(t),e.props.clipperState.setState({saveLocation:t.curSection&&t.curSection.section?t.curSection.section.id:""}))});var n,o={defaultLocation:a.Localization.getLocalizedString("WebClipper.SectionPicker.DefaultLocation"),loadingNotebooks:a.Localization.getLocalizedString("WebClipper.SectionPicker.LoadingNotebooks"),noNotebooksFound:a.Localization.getLocalizedString("WebClipper.SectionPicker.NoNotebooksFound"),notebookLoadFailureMessage:a.Localization.getLocalizedString("WebClipper.SectionPicker.NotebookLoadFailureMessage")},r=o.defaultLocation;return this.state.status===d.Status.Succeeded&&this.state.curSection&&(n=this.state.curSection.section.id,r=this.state.curSection.path),this.state.apiResponseCode&&!g.OneNoteApiUtils.isRetryable(this.state.apiResponseCode)&&(o.notebookLoadFailureMessage=a.Localization.getLocalizedString("WebClipper.SectionPicker.NotebookLoadUnretryableFailureMessage")),{tag:"div",attrs:{id:i.Constants.Ids.locationPickerContainer},children:[{tag:"div",attrs:{className:"optionLabel"},children:[{tag:"label",attrs:{className:"buttonLabelFont",style:a.Localization.getFontFamilyAsStyle(a.Localization.FontFamily.Regular)},children:[a.Localization.getLocalizedString("WebClipper.Label.ClipLocation")]}]},m.component(OneNotePicker.OneNotePickerComponent,{notebooks:this.state.notebooks,status:d.Status[this.state.status],onPopupToggle:this.onPopupToggle.bind(this),onSectionClicked:this.onSectionClicked.bind(this),textToDisplay:r,curSectionId:n,localizedStrings:o})]}},t}(u.ComponentBase);n.SectionPickerClass=h;var f=h.componentize();n.SectionPicker=f},{"../../constants":59,"../../localization/localization":85,"../../logging/log":88,"../../settings":104,"../../storage/clipperStorageKeys":107,"../clipperState":11,"../componentBase":12,"../frontEndGlobals":36,"../oneNoteApiUtils":38,"../status":52}],35:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../componentBase"),r=e("../../constants"),a=function(e){function t(){e.apply(this,arguments),this.currentFrame=0,this.currentTime=this.rightNow()}return o(t,e),t.prototype.getInitialState=function(){var e=this;return requestAnimationFrame(function(){e.updateFrame()}),{inProgress:!0}},t.prototype.updateFrame=function(){var e=this;if(!this.spinnerElement)return void this.stop();if(this.state.inProgress){var t=this.rightNow(),n=24,o=(t-this.currentTime)/1e3;this.currentTime=t,this.currentFrame+=o*n;var i=Math.floor(this.currentFrame);i>=this.props.totalFrameCount&&(this.onFinishLoop(),this.props.loop?i=this.currentFrame=0:(this.stop(),i=this.currentFrame=this.props.totalFrameCount-1));var r=i*this.props.imageHeight;this.spinnerElement.style.backgroundPosition="0 -"+r+"px",requestAnimationFrame(function(){e.updateFrame()})}},t.prototype.stop=function(){this.setState({inProgress:!1})},t.prototype.onFinishLoop=function(){},t.prototype.rightNow=function(){return window.performance&&window.performance.now?window.performance.now():Date.now()},t.prototype.configForSpinner=function(e,t,n){var o=this;this.spinnerElement=e,n.onunload=function(){o.stop()}},t.prototype.render=function(){var e=this.props.imageWidth?this.props.imageWidth:32,t={backgroundImage:"url("+this.props.spriteUrl+")",backgroundRepeat:"no-repeat",height:this.props.imageHeight+"px",width:e+"px"};return{tag:"div",attrs:{className:r.Constants.Classes.spinner,config:this.configForSpinner.bind(this),style:t}}},t}(i.ComponentBase),s=a.componentize();n.SpriteAnimation=s},{"../../constants":59,"../componentBase":12}],36:[function(e,t,n){"use strict";var o=e("../communicator/smartValue"),i=e("../storage/remoteStorage"),r=function(){function e(){}return e.getUserSessionId=function(){return e.sessionId.get()},e.getInjectCommunicator=function(){return e.injectCommunicator},e.setInjectCommunicator=function(t){e.injectCommunicator=t},e.getExtensionCommunicator=function(){return e.extensionCommunicator},e.setExtensionCommunicator=function(t){e.extensionCommunicator=t,e.setUpRemoteStorage(t)},e.getCachedValue=function(t){if(!e.storage)throw new Error("The remote storage needs to be set up with the extension communicator first");return e.storage.getCachedValue(t)},e.getStoredValue=function(t,n,o){if(!e.storage)throw new Error("The remote storage needs to be set up with the extension communicator first");e.storage.getValue(t,n,o)},e.preCacheStoredValues=function(t){if(!e.storage)throw new Error("The remote storage needs to be set up with the extension communicator first");e.storage.getValues(t,function(){},!0)},e.storeValue=function(t,n){if(!e.storage)throw new Error("The remote storage needs to be set up with the extension communicator first");e.storage.setValue(t,n,void 0)},e.setUpRemoteStorage=function(t){e.storage=new i.RemoteStorage(e.getExtensionCommunicator())},e.sessionId=new o.SmartValue,e}();n.Clipper=r},{"../communicator/smartValue":58,"../storage/remoteStorage":109}],37:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../constants"),r=e("../localization/localization"),a=e("../logging/log"),s=e("./clipMode"),l=e("./frontEndGlobals"),p=e("./clipperState"),c=e("./componentBase"),u=e("./oneNoteApiUtils"),g=e("./status"),d=e("./animations/animationHelper"),h=e("./animations/animationState"),f=e("./animations/expandFromRightAnimationStrategy"),S=e("./animations/slideFromRightAnimationStrategy"),C=e("./animations/slidingHeightAnimationStrategy"),y=e("./components/closeButton"),v=e("./components/footer"),b=e("./panels/clippingPanel"),w=e("./panels/errorDialogPanel"),I=e("./panels/loadingPanel"),P=e("./panels/optionsPanel"),T=e("./panels/ratingsPanel"),E=e("./panels/regionSelectingPanel"),U=e("./panels/signInPanel"),F=e("./panels/successPanel");!function(e){e[e.CloseButton=0]="CloseButton",e[e.EscPress=1]="EscPress"}(n.CloseReason||(n.CloseReason={}));var N=n.CloseReason;!function(e){e[e.None=0]="None",e[e.BadState=1]="BadState",e[e.Loading=2]="Loading",e[e.SignInNeeded=3]="SignInNeeded",e[e.ClipOptions=4]="ClipOptions",e[e.RegionInstructions=5]="RegionInstructions",e[e.ClippingToApi=6]="ClippingToApi",e[e.ClippingFailure=7]="ClippingFailure",e[e.ClippingSuccess=8]="ClippingSuccess"}(n.PanelType||(n.PanelType={}));var A=n.PanelType,L=function(e){function t(t){var n=this;e.call(this,t),this.initAnimationStrategy(),l.Clipper.getInjectCommunicator().registerFunction(i.Constants.FunctionKeys.escHandler,function(){n.handleEscPress()}),document.onkeydown=function(e){e.keyCode===i.Constants.KeyCodes.esc&&n.handleEscPress()}}return o(t,e),t.prototype.getInitialState=function(){return{currentPanel:A.None}},t.prototype.handleEscPress=function(){this.isCloseable()&&this.closeClipper(N.EscPress)},t.prototype.initAnimationStrategy=function(){var e=this;this.controllerAnimationStrategy=new f.ExpandFromRightAnimationStrategy({extShouldAnimateIn:function(){return e.props.clipperState.uiExpanded},extShouldAnimateOut:function(){return!e.props.clipperState.uiExpanded},onBeforeAnimateOut:function(){e.setState({currentPanel:A.None})},onBeforeAnimateIn:function(){e.props.clipperState.reset()},onAnimateInExpand:function(){e.setState({currentPanel:e.getPanelTypeToShow()})},onAfterAnimateOut:function(){l.Clipper.getInjectCommunicator().callRemoteFunction(i.Constants.FunctionKeys.hideUi)}}),this.panelAnimationStrategy=new S.SlideFromRightAnimationStrategy({extShouldAnimateIn:function(){return e.state.currentPanel!==A.None},extShouldAnimateOut:function(){return e.getPanelTypeToShow()!==e.state.currentPanel},onAfterAnimateOut:function(){e.setState({currentPanel:e.getPanelTypeToShow()})},onAfterAnimateIn:function(){e.setState({currentPanel:e.getPanelTypeToShow()})}}),this.heightAnimationStrategy=new C.SlidingHeightAnimationStrategy(i.Constants.Ids.mainController,{onAfterHeightAnimatorDraw:function(t){e.popupIsOpen?e.updateFrameHeightAfterPopupToggle(e.popupIsOpen):e.props.updateFrameHeight(t.newContainerHeight)}})},t.prototype.isCloseable=function(){var e=this.state.currentPanel;return e!==A.None&&e!==A.ClippingToApi},t.prototype.onPopupToggle=function(e){this.popupIsOpen=e,this.updateFrameHeightAfterPopupToggle(e)},t.prototype.updateFrameHeightAfterPopupToggle=function(e){var t=document.getElementById(i.Constants.Ids.saveToLocationContainer);if(t){var n=t.getBoundingClientRect(),o=i.Constants.Styles.sectionPickerContainerHeight+n.top+n.height,r=document.getElementById(i.Constants.Ids.mainController).offsetHeight,a=e?o:r;this.props.updateFrameHeight(a)}},t.prototype.getPanelTypeToShow=function(){if(this.props.clipperState.badState)return A.BadState;if(!this.props.clipperState.uiExpanded)return A.None;if(this.props.clipperState.userResult&&this.props.clipperState.userResult.status===g.Status.InProgress||this.props.clipperState.fetchLocStringStatus===g.Status.InProgress||!this.props.clipperState.invokeOptions)return A.Loading;if(!p.ClipperStateHelperFunctions.isUserLoggedIn(this.props.clipperState))return A.SignInNeeded;if(this.props.clipperState.currentMode.get()===s.ClipMode.Region&&this.props.clipperState.regionResult.status!==g.Status.Succeeded)switch(this.props.clipperState.regionResult.status){case g.Status.InProgress:return A.Loading;default:return A.RegionInstructions}switch(this.props.clipperState.oneNoteApiResult.status){default:case g.Status.NotStarted:return A.ClipOptions;case g.Status.InProgress:return A.ClippingToApi;case g.Status.Failed:return A.ClippingFailure;case g.Status.Succeeded:return A.ClippingSuccess}},t.prototype.closeClipper=function(e){var t=new a.Event.BaseEvent(a.Event.Label.CloseClipper);t.setCustomProperty(a.PropertyName.Custom.CurrentPanel,A[this.state.currentPanel]),t.setCustomProperty(a.PropertyName.Custom.CloseReason,N[e]),l.Clipper.logger.logEvent(t),this.props.clipperState.setState({uiExpanded:!1,regionResult:{status:g.Status.NotStarted,data:[]}})},t.prototype.onMainControllerDraw=function(e){this.controllerAnimationStrategy.animate(e)},t.prototype.onPanelAnimatorDraw=function(e){var t=this,n=this.getPanelTypeToShow(),o=n===this.state.currentPanel;n===A.ClipOptions&&this.state.currentPanel!==A.ClipOptions&&(this.popupIsOpen=!1),this.panelAnimationStrategy.animate(e),o||this.panelAnimationStrategy.getAnimationState()!==h.AnimationState.GoingIn||d.AnimationHelper.stopAnimationsThen(e,function(){t.panelAnimationStrategy.setAnimationState(h.AnimationState.In),t.setState({})})},t.prototype.onHeightAnimatorDraw=function(e){this.heightAnimationStrategy.animate(e)},t.prototype.getCurrentPanel=function(){var e=this,t=this.state.currentPanel,n=[];switch(t){case A.BadState:return n.push({id:i.Constants.Ids.refreshPageButton,label:r.Localization.getLocalizedString("WebClipper.Action.RefreshPage"),handler:function(){l.Clipper.getInjectCommunicator().callRemoteFunction(i.Constants.FunctionKeys.refreshPage)}}),m.component(w.ErrorDialogPanel,{message:r.Localization.getLocalizedString("WebClipper.Error.OrphanedWebClipperDetected"),buttons:n});case A.Loading:return m.component(I.LoadingPanel,{clipperState:this.props.clipperState});case A.SignInNeeded:return m.component(U.SignInPanel,{clipperState:this.props.clipperState,onSignInInvoked:this.props.onSignInInvoked});case A.ClipOptions:return m.component(P.OptionsPanel,{onPopupToggle:this.onPopupToggle.bind(this),clipperState:this.props.clipperState,onStartClip:this.props.onStartClip});case A.RegionInstructions:return m.component(E.RegionSelectingPanel,{clipperState:this.props.clipperState});case A.ClippingToApi:return m.component(b.ClippingPanel,{clipperState:this.props.clipperState});case A.ClippingFailure:var o=this.props.clipperState.oneNoteApiResult.data,a=u.OneNoteApiUtils.getApiResponseCode(o);return u.OneNoteApiUtils.isRetryable(a)&&n.push({id:i.Constants.Ids.dialogTryAgainButton,label:r.Localization.getLocalizedString("WebClipper.Action.TryAgain"),handler:this.props.onStartClip}),n.push({id:i.Constants.Ids.dialogBackButton,label:r.Localization.getLocalizedString("WebClipper.Action.BackToHome"),handler:function(){e.props.clipperState.setState({oneNoteApiResult:{data:e.props.clipperState.oneNoteApiResult.data,status:g.Status.NotStarted}})}}),m.component(w.ErrorDialogPanel,{message:u.OneNoteApiUtils.getLocalizedErrorMessage(a),buttons:n});case A.ClippingSuccess:var s=[m.component(F.SuccessPanel,{clipperState:this.props.clipperState})];return this.props.clipperState.showRatingsPrompt&&this.props.clipperState.showRatingsPrompt.get()&&s.push(m.component(T.RatingsPanel,{clipperState:this.props.clipperState})),s;default:return}},t.prototype.getCloseButtonForType=function(){return this.isCloseable()?m.component(y.CloseButton,{onClickHandler:this.closeClipper.bind(this),onClickHandlerParams:[N.CloseButton]}):void 0},t.prototype.getCurrentFooter=function(){var e=this.state.currentPanel;switch(e){case A.ClipOptions:case A.ClippingFailure:case A.SignInNeeded:return m.component(v.Footer,{clipperState:this.props.clipperState,onSignOutInvoked:this.props.onSignOutInvoked});case A.ClippingSuccess:
default:return}},t.prototype.render=function(){var e=this.getCurrentPanel(),t=this.getCloseButtonForType(),n=this.getCurrentFooter();return{tag:"div",attrs:Object.assign({id:i.Constants.Ids.mainController},this.onElementDraw(this.onMainControllerDraw)),children:[t,{tag:"div",attrs:{className:"panelContent"},children:[{tag:"div",attrs:Object.assign({className:i.Constants.Classes.heightAnimator},this.onElementDraw(this.onHeightAnimatorDraw)),children:[{tag:"div",attrs:Object.assign({className:i.Constants.Classes.panelAnimator},this.onElementDraw(this.onPanelAnimatorDraw)),children:[e,n]}]}]}]}},t}(c.ComponentBase);n.MainControllerClass=L;var k=L.componentize();n.MainController=k},{"../constants":59,"../localization/localization":85,"../logging/log":88,"./animations/animationHelper":2,"./animations/animationState":3,"./animations/expandFromRightAnimationStrategy":5,"./animations/slideFromRightAnimationStrategy":6,"./animations/slidingHeightAnimationStrategy":7,"./clipMode":9,"./clipperState":11,"./componentBase":12,"./components/closeButton":14,"./components/footer":15,"./frontEndGlobals":36,"./oneNoteApiUtils":38,"./panels/clippingPanel":39,"./panels/errorDialogPanel":41,"./panels/loadingPanel":42,"./panels/optionsPanel":43,"./panels/ratingsPanel":44,"./panels/regionSelectingPanel":45,"./panels/signInPanel":46,"./panels/successPanel":47,"./status":52}],38:[function(e,t,n){"use strict";var o,i=e("../constants"),r=e("../localization/localization"),a=e("../logging/log"),s=e("./frontEndGlobals");!function(e){function t(t,o){if(t&&o){t.setCustomProperty(a.PropertyName.Custom.CorrelationId,o.responseHeaders[i.Constants.HeaderValues.correlationId]),t.setStatus(a.Status.Failed),t.setFailureInfo(o);var r=n(o);if(r){var l=c(r);l||s.Clipper.logger.logFailure(a.Failure.Label.UnhandledApiCode,a.Failure.Type.Unexpected,void 0,r),e.isExpected(r)&&t.setFailureType(a.Failure.Type.Expected),t.setCustomProperty(a.PropertyName.Custom.IsRetryable,e.isRetryable(r))}}}function n(e){if(e&&e.response){var t;try{t=JSON.parse(e.response)}catch(t){s.Clipper.logger.logJsonParseUnexpected(e.response)}var n;return t&&t.error&&t.error.code&&(n=t.error.code),n?n:void 0}}function o(e){var t=c(e);return t?t.message:r.Localization.getLocalizedString("WebClipper.Error.GenericError")}function l(e){var t=c(e);return!!t&&t.isExpected}function p(e){var t=c(e);return!!t&&t.isRetryable}function c(e){var t={10001:{message:r.Localization.getLocalizedString("WebClipper.Error.GenericError"),isRetryable:!0,isExpected:!0},10002:{message:r.Localization.getLocalizedString("WebClipper.Error.GenericError"),isRetryable:!0,isExpected:!0},10004:{message:r.Localization.getLocalizedString("WebClipper.Error.PasswordProtected"),isRetryable:!1,isExpected:!0},10006:{message:r.Localization.getLocalizedString("WebClipper.Error.CorruptedSection"),isRetryable:!1,isExpected:!0},10007:{message:r.Localization.getLocalizedString("WebClipper.Error.GenericError"),isRetryable:!0,isExpected:!0},10008:{message:r.Localization.getLocalizedString("WebClipper.SectionPicker.NotebookLoadUnretryableFailureMessage"),isRetryable:!1,isExpected:!0},19999:{message:r.Localization.getLocalizedString("WebClipper.Error.GenericError"),isRetryable:!0,isExpected:!1},20102:{message:r.Localization.getLocalizedString("WebClipper.Error.ResourceDoesNotExist"),isRetryable:!1,isExpected:!0},30101:{message:r.Localization.getLocalizedString("WebClipper.Error.QuotaExceeded"),isRetryable:!1,isExpected:!0},30102:{message:r.Localization.getLocalizedString("WebClipper.Error.SectionTooLarge"),isRetryable:!1,isExpected:!0},30103:{message:r.Localization.getLocalizedString("WebClipper.Error.GenericError"),isRetryable:!0,isExpected:!0},30104:{message:r.Localization.getLocalizedString("WebClipper.Error.UserAccountSuspended"),isRetryable:!1,isExpected:!0},30105:{message:r.Localization.getLocalizedString("WebClipper.Error.NotProvisioned"),isRetryable:!1,isExpected:!0}};if(e)return t[e]}e.logOneNoteApiRequestError=t,e.getApiResponseCode=n,e.getLocalizedErrorMessage=o,e.isExpected=l,e.isRetryable=p}(o=n.OneNoteApiUtils||(n.OneNoteApiUtils={}))},{"../constants":59,"../localization/localization":85,"../logging/log":88,"./frontEndGlobals":36}],39:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../contentCapture/augmentationHelper"),a=e("../../localization/localization"),s=e("../../logging/log"),l=e("../../utils"),p=e("../clipMode"),c=e("../frontEndGlobals"),u=e("../componentBase"),g=e("../components/spriteAnimation"),d=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getProgressLabel=function(){switch(this.props.clipperState.currentMode.get()){case p.ClipMode.Region:return a.Localization.getLocalizedString("WebClipper.ClipType.Region.ProgressLabel");case p.ClipMode.Augmentation:var e=void 0;try{var t=r.AugmentationModel[this.props.clipperState.augmentationResult.data.ContentModel];e=a.Localization.getLocalizedString("WebClipper.ClipType."+t+".ProgressLabel")}catch(t){c.Clipper.logger.logFailure(s.Failure.Label.GetLocalizedString,s.Failure.Type.Unexpected,{error:t.message},p.ClipMode[this.props.clipperState.currentMode.get()]),e=a.Localization.getLocalizedString("WebClipper.ClipType.ScreenShot.ProgressLabel")}return e;case p.ClipMode.Bookmark:return a.Localization.getLocalizedString("WebClipper.ClipType.Bookmark.ProgressLabel");case p.ClipMode.Selection:return a.Localization.getLocalizedString("WebClipper.ClipType.Selection.ProgressLabel");default:case p.ClipMode.FullPage:return a.Localization.getLocalizedString("WebClipper.ClipType.ScreenShot.ProgressLabel")}},t.prototype.render=function(){return{tag:"div",attrs:{id:i.Constants.Ids.clipperApiProgressContainer,className:"progressPadding"},children:[m.component(g.SpriteAnimation,{spriteUrl:l.Utils.getImageResourceUrl("spinner_loop.png"),imageHeight:32,totalFrameCount:21,loop:!0}),{tag:"span",attrs:{className:"actionLabelFont messageLabel",style:a.Localization.getFontFamilyAsStyle(a.Localization.FontFamily.Regular)},children:[this.getProgressLabel()]}]}},t}(u.ComponentBase),h=d.componentize();n.ClippingPanel=h},{"../../constants":59,"../../contentCapture/augmentationHelper":60,"../../localization/localization":85,"../../logging/log":88,"../../utils":111,"../clipMode":9,"../componentBase":12,"../components/spriteAnimation":35,"../frontEndGlobals":36}],40:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../componentBase"),r=e("../../constants"),a=e("../../utils"),s=e("../../localization/localization"),l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getExtraMessages=function(){},t.prototype.onPanelAnimatorDraw=function(e){this.props.animationStrategy&&this.props.animationStrategy.animate(e)},t.prototype.render=function(){var e=this,t=a.Utils.isNullOrUndefined(this.props.fontFamily)?s.Localization.FontFamily.Semibold:this.props.fontFamily,n=a.Utils.isNullOrUndefined(this.props.buttonFontFamily)?s.Localization.FontFamily.Semibold:this.props.buttonFontFamily,o=this.props.containerId?this.props.containerId:"";return{tag:"div",attrs:{id:o},children:[{tag:"div",attrs:Object.assign({className:r.Constants.Classes.panelAnimator},this.onElementDraw(this.onPanelAnimatorDraw)),children:[{tag:"div",attrs:{id:r.Constants.Ids.dialogMessageContainer,className:"resultPagePadding"},children:[{tag:"div",attrs:{className:"messageLabelContainer",style:s.Localization.getFontFamilyAsStyle(t)},children:[{tag:"div",attrs:{id:r.Constants.Ids.dialogMessage,className:"dialogMessageFont messageLabel"},children:[this.props.message]},this.getExtraMessages()]}]},{tag:"div",attrs:{id:r.Constants.Ids.dialogContentContainer,className:""},children:[this.props.content]},{tag:"div",attrs:{id:r.Constants.Ids.dialogButtonContainer},children:[this.props.buttons.map(function(t,o){return{tag:"a",attrs:Object.assign({id:t.id,className:"dialogButton"},e.enableInvoke(t.handler,70)),children:[{tag:"div",attrs:{className:"wideButtonContainer"},children:[{tag:"span",attrs:{className:"wideButtonFont wideActionButton",style:s.Localization.getFontFamilyAsStyle(n)},children:[t.label]}]}]}})]}]}]}},t}(i.ComponentBase);n.DialogPanelClass=l;var p=l.componentize();n.DialogPanel=p},{"../../constants":59,"../../localization/localization":85,"../../utils":111,"../componentBase":12}],41:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../frontEndGlobals"),a=e("./dialogPanel"),s=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getExtraMessages=function(){return{tag:"div",attrs:{id:i.Constants.Ids.dialogDebugMessageContainer},children:[this.getDebugSessionId()]}},t.prototype.getDebugSessionId=function(){return"Usid: "+r.Clipper.getUserSessionId()},t}(a.DialogPanelClass),l=s.componentize();n.ErrorDialogPanel=l},{"../../constants":59,"../frontEndGlobals":36,"./dialogPanel":40}],42:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../utils"),a=e("../componentBase"),s=e("../components/spriteAnimation"),l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.render=function(){return{tag:"div",attrs:{id:i.Constants.Ids.clipperLoadingContainer,className:"progressPadding"},children:[m.component(s.SpriteAnimation,{spriteUrl:r.Utils.getImageResourceUrl("spinner_loop.png"),imageHeight:32,totalFrameCount:21,loop:!0})]}},t}(a.ComponentBase),p=l.componentize();n.LoadingPanel=p},{"../../constants":59,"../../utils":111,"../componentBase":12,"../components/spriteAnimation":35}],43:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../localization/localization"),a=e("../components/modeButtonSelector"),s=e("../components/sectionPicker"),l=e("../clipperState"),p=e("../componentBase"),c=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.render=function(){var e=l.ClipperStateHelperFunctions.clipButtonEnabled(this.props.clipperState),t=e?"wideButtonContainer":"wideButtonContainer disabled";return{tag:"div",attrs:{className:"optionsPanel"},children:[m.component(a.ModeButtonSelector,{clipperState:this.props.clipperState}),m.component(s.SectionPicker,{onPopupToggle:this.props.onPopupToggle.bind(this),clipperState:this.props.clipperState}),{tag:"div",attrs:{id:i.Constants.Ids.clipButtonContainer,className:t},children:[e?{tag:"a",attrs:Object.assign({id:i.Constants.Ids.clipButton,className:"wideActionButton"},this.enableInvoke(this.props.onStartClip,1)),children:[{tag:"span",attrs:{className:"wideButtonFont",style:r.Localization.getFontFamilyAsStyle(r.Localization.FontFamily.Semibold)},children:[r.Localization.getLocalizedString("WebClipper.Action.Clip")]}]}:{tag:"a",attrs:{id:i.Constants.Ids.clipButton,className:"wideActionButton"},children:[{tag:"span",attrs:{className:"wideButtonFont",style:r.Localization.getFontFamilyAsStyle(r.Localization.FontFamily.Semibold)},children:[r.Localization.getLocalizedString("WebClipper.Action.Clip")]}]}]}]}},t}(p.ComponentBase),u=c.componentize();n.OptionsPanel=u},{"../../constants":59,"../../localization/localization":85,"../clipperState":11,"../componentBase":12,"../components/modeButtonSelector":17,"../components/sectionPicker":34}],44:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../utils"),a=e("../../localization/localization"),s=e("../../storage/clipperStorageKeys"),l=e("../componentBase"),p=e("../frontEndGlobals"),c=e("../ratingsHelper"),u=e("../animations/slideFromRightAnimationStrategy"),g=e("./dialogPanel"),d=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getInitialState=function(){return{currentRatingsPromptStage:c.RatingsPromptStage.Init,userSelectedRatingsPromptStage:c.RatingsPromptStage.Init}},t.prototype.getAnimationStategy=function(e){return new u.SlideFromRightAnimationStrategy({extShouldAnimateIn:function(){return e.state.userSelectedRatingsPromptStage!==e.state.currentRatingsPromptStage},extShouldAnimateOut:function(){return!1},onAfterAnimateIn:function(){e.setState({currentRatingsPromptStage:e.state.userSelectedRatingsPromptStage})}})},t.prototype.getMessage=function(e){switch(e){case c.RatingsPromptStage.Init:return a.Localization.getLocalizedString("WebClipper.Label.Ratings.Message.Init");case c.RatingsPromptStage.Rate:return a.Localization.getLocalizedString("WebClipper.Label.Ratings.Message.Rate");case c.RatingsPromptStage.Feedback:return a.Localization.getLocalizedString("WebClipper.Label.Ratings.Message.Feedback");case c.RatingsPromptStage.End:return a.Localization.getLocalizedString("WebClipper.Label.Ratings.Message.End");default:case c.RatingsPromptStage.None:return}},t.prototype.getDialogButtons=function(e){var t=e.state.userSelectedRatingsPromptStage,n=e.props.clipperState,o=n.clientInfo.clipperType,r=[];switch(t){case c.RatingsPromptStage.Init:r.push({id:i.Constants.Ids.ratingsButtonInitYes,label:a.Localization.getLocalizedString("WebClipper.Label.Ratings.Button.Init.Positive"),handler:function(){c.RatingsHelper.setDoNotPromptStatus();var t=c.RatingsHelper.getRateUrlIfExists(o);t?e.setState({userSelectedRatingsPromptStage:c.RatingsPromptStage.Rate}):e.setState({userSelectedRatingsPromptStage:c.RatingsPromptStage.End})}},{id:i.Constants.Ids.ratingsButtonInitNo,label:a.Localization.getLocalizedString("WebClipper.Label.Ratings.Button.Init.Negative"),handler:function(){c.RatingsHelper.badRatingAlreadyOccurred()&&c.RatingsHelper.setDoNotPromptStatus();var t=p.Clipper.getCachedValue(s.ClipperStorageKeys.lastSeenVersion);p.Clipper.storeValue(s.ClipperStorageKeys.lastBadRatingDate,Date.now().toString()),p.Clipper.storeValue(s.ClipperStorageKeys.lastBadRatingVersion,t);var o=c.RatingsHelper.getFeedbackUrlIfExists(n);o?e.setState({userSelectedRatingsPromptStage:c.RatingsPromptStage.Feedback}):e.setState({userSelectedRatingsPromptStage:c.RatingsPromptStage.End})}});break;case c.RatingsPromptStage.Rate:var l=c.RatingsHelper.getRateUrlIfExists(o);l?r.push({id:i.Constants.Ids.ratingsButtonRateYes,label:a.Localization.getLocalizedString("WebClipper.Label.Ratings.Button.Rate"),handler:function(){window.open(l,"_blank"),e.setState({userSelectedRatingsPromptStage:c.RatingsPromptStage.End})}},{id:i.Constants.Ids.ratingsButtonRateNo,label:a.Localization.getLocalizedString("WebClipper.Label.Ratings.Button.NoThanks"),handler:function(){e.setState({userSelectedRatingsPromptStage:c.RatingsPromptStage.None})}}):e.setState({userSelectedRatingsPromptStage:c.RatingsPromptStage.None});break;case c.RatingsPromptStage.Feedback:var u=c.RatingsHelper.getFeedbackUrlIfExists(n);u?r.push({id:i.Constants.Ids.ratingsButtonFeedbackYes,label:a.Localization.getLocalizedString("WebClipper.Label.Ratings.Button.Feedback"),handler:function(){window.open(u,"_blank"),e.setState({userSelectedRatingsPromptStage:c.RatingsPromptStage.End})}},{id:i.Constants.Ids.ratingsButtonFeedbackNo,label:a.Localization.getLocalizedString("WebClipper.Label.Ratings.Button.NoThanks"),handler:function(){e.setState({userSelectedRatingsPromptStage:c.RatingsPromptStage.None})}}):e.setState({userSelectedRatingsPromptStage:c.RatingsPromptStage.None});break;default:case c.RatingsPromptStage.End:case c.RatingsPromptStage.None:}return r},t.prototype.render=function(){if(!this.props.clipperState.showRatingsPrompt||!this.props.clipperState.showRatingsPrompt.get())return{tag:"div",attrs:{}};var e=this.getMessage(this.state.userSelectedRatingsPromptStage);if(!r.Utils.isNullOrUndefined(e)){var t=this.getDialogButtons(this),n=this.getAnimationStategy(this);return m.component(g.DialogPanel,{message:e,buttons:t,buttonFontFamily:a.Localization.FontFamily.Regular,containerId:i.Constants.Ids.ratingsPromptContainer,animationStrategy:n})}return{tag:"div",attrs:{}}},t}(l.ComponentBase),h=d.componentize();n.RatingsPanel=h},{"../../constants":59,"../../localization/localization":85,"../../storage/clipperStorageKeys":107,"../../utils":111,"../animations/slideFromRightAnimationStrategy":6,"../componentBase":12,"../frontEndGlobals":36,"../ratingsHelper":49,"./dialogPanel":40}],45:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../localization/localization"),a=e("../componentBase"),s=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.handleCancelButton=function(){this.props.clipperState.reset()},t.prototype.render=function(){return{tag:"div",attrs:{id:i.Constants.Ids.regionInstructionsContainer},children:[{tag:"div",attrs:{className:"regionClipPadding"},children:[{tag:"div",attrs:{className:"messageLabelContainer"},children:[{tag:"span",attrs:{className:"informationLabelFont messageLabel",style:r.Localization.getFontFamilyAsStyle(r.Localization.FontFamily.Light)},children:[r.Localization.getLocalizedString("WebClipper.Label.DragAndRelease")]}]},{tag:"a",attrs:Object.assign({id:i.Constants.Ids.regionClipCancelButton},this.enableInvoke(this.handleCancelButton,70)),children:[{tag:"div",attrs:{className:"wideButtonContainer"},children:[{tag:"span",attrs:{className:"wideButtonFont wideActionButton",style:r.Localization.getFontFamilyAsStyle(r.Localization.FontFamily.Semibold)},children:[r.Localization.getLocalizedString("WebClipper.Action.Cancel")]}]}]}]}]}},t}(a.ComponentBase),l=s.componentize();n.RegionSelectingPanel=l},{"../../constants":59,"../../localization/localization":85,"../componentBase":12}],46:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../userInfo"),a=e("../../utils"),s=e("../../localization/localization"),l=e("../componentBase"),p=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.onSignInMsa=function(){this.props.onSignInInvoked(r.AuthType.Msa)},t.prototype.onSignInOrgId=function(){this.props.onSignInInvoked(r.AuthType.OrgId)},t.prototype.getSignInDescription=function(){if(!this.props.clipperState.userResult||!this.props.clipperState.userResult.data)return s.Localization.getLocalizedString("WebClipper.Label.SignInDescription");switch(this.props.clipperState.userResult.data.updateReason){case r.UpdateReason.SignInAttempt:return s.Localization.getLocalizedString("WebClipper.Error.SignInUnsuccessful");case r.UpdateReason.TokenRefreshForPendingClip:return s.Localization.getLocalizedString("WebClipper.Error.GenericExpiredTokenRefreshError");default:case r.UpdateReason.SignInCancel:case r.UpdateReason.SignOutAction:case r.UpdateReason.InitialRetrieval:return s.Localization.getLocalizedString("WebClipper.Label.SignInDescription")}},t.prototype.render=function(){var e=this.getSignInDescription();return{tag:"div",attrs:{id:i.Constants.Ids.signInContainer},children:[{tag:"div",attrs:{className:"signInPadding"},children:[{tag:"img",attrs:{id:i.Constants.Ids.signInLogo,src:a.Utils.getImageResourceUrl("onenote_logo_clipper.png")}},{tag:"div",attrs:{id:i.Constants.Ids.signInMessageLabelContainer,className:"messageLabelContainer"},children:[{tag:"span",attrs:{className:"messageLabel",style:s.Localization.getFontFamilyAsStyle(s.Localization.FontFamily.Regular)},children:[s.Localization.getLocalizedString("WebClipper.Label.OneNoteClipper")]}]},{tag:"div",attrs:{className:"signInDescription"},children:[{tag:"span",attrs:{id:i.Constants.Ids.signInText,style:s.Localization.getFontFamilyAsStyle(s.Localization.FontFamily.Light)},children:[e]}]},{tag:"a",attrs:Object.assign({id:i.Constants.Ids.signInButtonMsa},this.enableInvoke(this.onSignInMsa,1)),children:[{tag:"div",attrs:{className:"wideButtonContainer"},children:[{tag:"span",attrs:{className:"wideButtonFont wideActionButton",style:s.Localization.getFontFamilyAsStyle(s.Localization.FontFamily.Regular)},children:[s.Localization.getLocalizedString("WebClipper.Action.SigninMsa")]}]}]},{tag:"a",attrs:Object.assign({id:i.Constants.Ids.signInButtonOrgId},this.enableInvoke(this.onSignInOrgId,2)),children:[{tag:"div",attrs:{className:"wideButtonContainer"},children:[{tag:"span",attrs:{className:"wideButtonFont wideActionButton",style:s.Localization.getFontFamilyAsStyle(s.Localization.FontFamily.Regular)},children:[s.Localization.getLocalizedString("WebClipper.Action.SigninOrgId")]}]}]}]}]}},t}(l.ComponentBase),c=p.componentize();n.SignInPanel=c},{"../../constants":59,"../../localization/localization":85,"../../userInfo":110,"../../utils":111,"../componentBase":12}],47:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../constants"),r=e("../../utils"),a=e("../../localization/localization"),s=e("../../logging/log"),l=e("../componentBase"),p=e("../frontEndGlobals"),c=e("../components/spriteAnimation"),u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.onLaunchOneNoteButton=function(){p.Clipper.logger.logUserFunnel(s.Funnel.Label.ViewInWac);var e=this.props.clipperState.oneNoteApiResult.data;if(e&&e.links&&e.links.oneNoteWebUrl&&e.links.oneNoteWebUrl.href){var t=r.Utils.addUrlQueryValue(e.links.oneNoteWebUrl.href,i.Constants.Urls.QueryParams.wdFromClipper,"1");window.open(t,"_blank")}else p.Clipper.logger.logFailure(s.Failure.Label.OnLaunchOneNoteButton,s.Failure.Type.Unexpected,{error:"Page created and returned by API is either missing entirely, or missing its links, oneNoteWebUrl, or oneNoteWebUrl.href. Page: "+e})},t.prototype.render=function(){return{tag:"div",attrs:{id:i.Constants.Ids.clipperSuccessContainer},children:[{tag:"div",attrs:{className:"messageLabelContainer successPagePadding"},children:[m.component(c.SpriteAnimation,{spriteUrl:r.Utils.getImageResourceUrl("checkmark.png"),imageHeight:28,totalFrameCount:30,loop:!1}),{tag:"span",attrs:{className:"actionLabelFont messageLabel",style:a.Localization.getFontFamilyAsStyle(a.Localization.FontFamily.Light)},children:[a.Localization.getLocalizedString("WebClipper.Label.ClipSuccessful")]}]},{tag:"a",attrs:Object.assign({id:i.Constants.Ids.launchOneNoteButton},this.enableInvoke(this.onLaunchOneNoteButton,70)),children:[{tag:"div",attrs:{className:"wideButtonContainer"},children:[{tag:"span",attrs:{className:"wideButtonFont wideActionButton",style:a.Localization.getFontFamilyAsStyle(a.Localization.FontFamily.Regular)},children:[a.Localization.getLocalizedString("WebClipper.Action.ViewInOneNote")]}]}]}]}},t}(l.ComponentBase),g=u.componentize();n.SuccessPanel=g},{"../../constants":59,"../../localization/localization":85,"../../logging/log":88,"../../utils":111,"../componentBase":12,"../components/spriteAnimation":35,"../frontEndGlobals":36}],48:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./clipMode"),r=e("./componentBase"),a=e("./components/previewViewer/augmentationPreview"),s=e("./components/previewViewer/bookmarkPreview"),l=e("./components/previewViewer/fullPagePreview"),p=e("./components/previewViewer/regionPreview"),c=e("./components/previewViewer/selectionPreview"),u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.render=function(){switch(this.props.clipperState.currentMode.get()){case i.ClipMode.FullPage:return m.component(l.FullPagePreview,{clipperState:this.props.clipperState});case i.ClipMode.Region:return m.component(p.RegionPreview,{clipperState:this.props.clipperState});case i.ClipMode.Augmentation:return m.component(a.AugmentationPreview,{clipperState:this.props.clipperState});case i.ClipMode.Bookmark:return m.component(s.BookmarkPreview,{clipperState:this.props.clipperState});case i.ClipMode.Selection:return m.component(c.SelectionPreview,{clipperState:this.props.clipperState});default:return{tag:"div",attrs:{}}}},t}(r.ComponentBase),g=u.componentize();n.PreviewViewer=g},{"./clipMode":9,"./componentBase":12,"./components/previewViewer/augmentationPreview":18,"./components/previewViewer/bookmarkPreview":19,"./components/previewViewer/fullPagePreview":21,"./components/previewViewer/regionPreview":30,"./components/previewViewer/selectionPreview":31}],49:[function(e,t,n){"use strict";var o=e("../clientType"),i=e("../constants"),r=e("../utils"),a=e("../settings"),s=e("../storage/clipperStorageKeys"),l=e("../versioning/version"),p=e("./frontEndGlobals"),c=e("../logging/log");!function(e){e[e.None=0]="None",e[e.Init=1]="Init",e[e.Rate=2]="Rate",e[e.Feedback=3]="Feedback",e[e.End=4]="End"}(n.RatingsPromptStage||(n.RatingsPromptStage={}));var u=(n.RatingsPromptStage,function(){function e(){}return e.badRatingAlreadyOccurred=function(){var t=p.Clipper.getCachedValue(s.ClipperStorageKeys.lastBadRatingDate),n=parseInt(t,10);return!(isNaN(n)||!e.isValidDate(n))},e.getFeedbackUrlIfExists=function(e){var t=a.Settings.getSetting("LogCategory_RatingsPrompt");if(!r.Utils.isNullOrUndefined(t)&&t.length>0)return r.Utils.generateFeedbackUrl(e,p.Clipper.getUserSessionId(),t)},e.getRateUrlIfExists=function(t){var n=e.getRateUrlSettingNameForClient(t);return a.Settings.getSetting(n)},e.preCacheNeededValues=function(){var e=[s.ClipperStorageKeys.doNotPromptRatings,s.ClipperStorageKeys.lastBadRatingDate,s.ClipperStorageKeys.lastBadRatingVersion,s.ClipperStorageKeys.lastSeenVersion,s.ClipperStorageKeys.numSuccessfulClips];p.Clipper.preCacheStoredValues(e)},e.setDoNotPromptStatus=function(){p.Clipper.storeValue(s.ClipperStorageKeys.doNotPromptRatings,"true"),p.Clipper.logger.logEvent(new c.Event.BaseEvent(c.Event.Label.SetDoNotPromptRatings))},e.shouldShowRatingsPrompt=function(t){var n=new c.Event.PromiseEvent(c.Event.Label.ShouldShowRatingsPrompt),o={},i=e.shouldShowRatingsPromptInternal(t,n,o);return n.setCustomProperty(c.PropertyName.Custom.ShouldShowRatingsPrompt,i),n.setCustomProperty(c.PropertyName.Custom.RatingsInfo,JSON.stringify(o)),p.Clipper.logger.logEvent(n),i},e.ratingsPromptEnabledForClient=function(t){var n=e.getRatingsPromptEnabledSettingNameForClient(t),o=a.Settings.getSetting(n);return!r.Utils.isNullOrUndefined(o)&&"true"===o.toLowerCase()},e.badRatingTimingDelayIsOver=function(t,n){return!!isNaN(t)||!(!e.isValidDate(t)||!e.isValidDate(n))&&n-t>=i.Constants.Settings.minTimeBetweenBadRatings},e.badRatingVersionDelayIsOver=function(e,t){if(r.Utils.isNullOrUndefined(e))return!0;var n,o;try{n=new l.Version(e),o=new l.Version(t)}catch(e){return!1}return o.isGreaterThan(n,!0)},e.clipSuccessDelayIsOver=function(e){return!isNaN(e)&&(e>=i.Constants.Settings.minClipSuccessForRatingsPrompt&&e<=i.Constants.Settings.maxClipSuccessForRatingsPrompt)},e.shouldShowRatingsPromptInternal=function(t,n,o){if(r.Utils.isNullOrUndefined(t))return n.setStatus(c.Status.Failed),n.setFailureInfo({error:"Clipper state is null or undefined"}),!1;if(!r.Utils.isNullOrUndefined(t.showRatingsPrompt.get()))return o.usedCachedValue=!0,t.showRatingsPrompt.get();var i=e.ratingsPromptEnabledForClient(t.clientInfo.clipperType);if(o.ratingsPromptEnabledForClient=i,!i)return!1;var a=p.Clipper.getCachedValue(s.ClipperStorageKeys.doNotPromptRatings),l=p.Clipper.getCachedValue(s.ClipperStorageKeys.lastBadRatingDate),u=p.Clipper.getCachedValue(s.ClipperStorageKeys.lastBadRatingVersion),g=p.Clipper.getCachedValue(s.ClipperStorageKeys.lastSeenVersion),d=p.Clipper.getCachedValue(s.ClipperStorageKeys.numSuccessfulClips);if(!r.Utils.isNullOrUndefined(a)&&"true"===a.toLowerCase())return o.doNotPromptRatings=!0,!1;var m=parseInt(l,10),h=parseInt(d,10);o.lastBadRatingDate=m?new Date(m).toString():null,o.lastBadRatingVersion=u,o.lastSeenVersion=g,o.numSuccessfulClips=h;var f=e.badRatingTimingDelayIsOver(m,Date.now()),S=e.badRatingVersionDelayIsOver(u,g),C=e.clipSuccessDelayIsOver(h);return o.badRatingTimingDelayIsOver=f,o.badRatingVersionDelayIsOver=S,o.clipSuccessDelayIsOver=C,!!(f&&S&&C)},e.combineClientTypeAndSuffix=function(e,t){return o.ClientType[e]+t},e.getRateUrlSettingNameForClient=function(t){return e.combineClientTypeAndSuffix(t,e.rateUrlSettingNameSuffix)},e.getRatingsPromptEnabledSettingNameForClient=function(t){return e.combineClientTypeAndSuffix(t,e.ratingsPromptEnabledSettingNameSuffix)},e.isValidDate=function(e){var t=i.Constants.Settings.maximumJSTimeValue*-1;return e>=t&&e<=i.Constants.Settings.maximumJSTimeValue},e.rateUrlSettingNameSuffix="_RatingUrl",e.ratingsPromptEnabledSettingNameSuffix="_RatingsEnabled",e}());n.RatingsHelper=u},{"../clientType":1,"../constants":59,"../logging/log":88,"../settings":104,"../storage/clipperStorageKeys":107,"../utils":111,"../versioning/version":114,"./frontEndGlobals":36}],50:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../domParsers/domUtils"),r=e("../logging/log"),a=e("../constants"),s=e("./status"),l=e("./componentBase"),p=e("./frontEndGlobals"),c=function(e){function t(t){e.call(this,t),this.devicePixelRatio=1,this.resizeHandler=this.handleResize.bind(this),this.resetState(),window.addEventListener("resize",this.resizeHandler)}return o(t,e),t.prototype.getInitialState=function(){return{selectionInProgress:!1,winHeight:window.innerHeight,winWidth:window.innerWidth}},t.prototype.onunload=function(){window.removeEventListener("resize",this.resizeHandler)},t.prototype.resetState=function(){this.setState({firstPoint:void 0,secondPoint:void 0,selectionInProgress:!1}),this.props.clipperState.setState({regionResult:{status:s.Status.NotStarted,data:this.props.clipperState.regionResult.data}})},t.prototype.startSelection=function(e){this.props.clipperState.regionResult.status!==s.Status.InProgress&&(this.setState({firstPoint:e,secondPoint:void 0,selectionInProgress:!0}),this.props.clipperState.setState({regionResult:{status:s.Status.InProgress,data:this.props.clipperState.regionResult.data}}))},t.prototype.completeSelection=function(e){var t=this.props.clipperState.regionResult.data;t||(t=[]),t.push(e),this.props.clipperState.setState({regionResult:{status:s.Status.Succeeded,data:t}})},t.prototype.moveSelection=function(e){this.setState({secondPoint:e})},t.prototype.stopSelection=function(e){this.state.selectionInProgress&&(this.state.firstPoint&&this.state.secondPoint&&this.state.firstPoint.x!==this.state.secondPoint.x&&this.state.firstPoint.y!==this.state.secondPoint.y?(this.setState({secondPoint:e,selectionInProgress:!1}),this.startRegionClip()):this.resetState())},t.prototype.mouseDownHandler=function(e){e.preventDefault(),this.startSelection({x:e.pageX,y:e.pageY})},t.prototype.mouseMoveHandler=function(e){if(this.state.selectionInProgress){if(0===e.buttons)return void this.stopSelection(this.state.secondPoint);this.moveSelection({
x:e.pageX,y:e.pageY})}},t.prototype.mouseUpHandler=function(e){this.stopSelection({x:e.pageX,y:e.pageY})},t.prototype.touchStartHandler=function(e){var t=e.changedTouches[0];this.startSelection({x:t.clientX,y:t.clientY})},t.prototype.touchMoveHandler=function(e){if(this.state.selectionInProgress){var t=e.changedTouches[0];this.moveSelection({x:t.clientX,y:t.clientY}),e.preventDefault()}},t.prototype.touchEndHandler=function(e){var t=e.changedTouches[0];this.stopSelection({x:t.clientX,y:t.clientY})},t.prototype.handleResize=function(){this.setState({winHeight:window.innerHeight,winWidth:window.innerWidth})},t.prototype.updateVisualElements=function(){var e=this.refs.outerFrame;if(e){var t,n,o,i;if(this.state.firstPoint&&this.state.secondPoint){t=Math.min(this.state.firstPoint.x,this.state.secondPoint.x),n=Math.min(this.state.firstPoint.y,this.state.secondPoint.y),o=Math.max(this.state.firstPoint.x,this.state.secondPoint.x),i=Math.max(this.state.firstPoint.y,this.state.secondPoint.y);var r=this.refs.innerFrame;if(r){var a=1;r.style.top=n-a+"px",r.style.left=t-a+"px",r.style.height=i-n+"px",r.style.width=o-t+"px"}}else t=0,n=0,o=0,i=0;var s=this.state.winWidth,l=this.state.winHeight,p=e.getContext("2d");p.canvas.width=s,p.canvas.height=l,p.beginPath(),p.fillStyle="black",p.fillRect(0,0,t,l),p.fillRect(t,0,o-t,n),p.fillRect(o,0,s-o,l),p.fillRect(t,i,o-t,l-i)}},t.prototype.startRegionClip=function(){var e=this;this.devicePixelRatio=window.devicePixelRatio;var t=new r.Event.BaseEvent(r.Event.Label.RegionSelectionProcessing),n=new r.Event.BaseEvent(r.Event.Label.RegionSelectionCapturing);n.setCustomProperty(r.PropertyName.Custom.Width,Math.abs(this.state.firstPoint.x-this.state.secondPoint.x)),n.setCustomProperty(r.PropertyName.Custom.Height,Math.abs(this.state.firstPoint.y-this.state.secondPoint.y)),p.Clipper.getExtensionCommunicator().callRemoteFunction(a.Constants.FunctionKeys.takeTabScreenshot,{callback:function(o){p.Clipper.logger.logEvent(n),e.saveCompressedSelectionToState(o).then(function(e){t.setCustomProperty(r.PropertyName.Custom.Width,e.width),t.setCustomProperty(r.PropertyName.Custom.Height,e.height),p.Clipper.logger.logEvent(t)})}})},t.prototype.saveCompressedSelectionToState=function(e){var t=this;return new Promise(function(n,o){t.createSelectionAsCanvas(e).then(function(e){var o=t.getCompressedDataUrl(e);t.completeSelection(o),n(e)},function(e){p.Clipper.logger.logFailure(r.Failure.Label.RegionSelectionProcessing,r.Failure.Type.Unexpected,{error:e.message}),t.resetState(),o(e)})})},t.prototype.createSelectionAsCanvas=function(e){var t=this;return e?this.state.firstPoint&&this.state.secondPoint?new Promise(function(n){var o=new r.Event.BaseEvent(r.Event.Label.RegionSelectionLoading),i=new Image;i.onload=function(){p.Clipper.logger.logEvent(o);var e=Math.min(t.state.firstPoint.x,t.state.secondPoint.x),r=Math.min(t.state.firstPoint.y,t.state.secondPoint.y),a=Math.min(i.width,Math.max(t.state.firstPoint.x,t.state.secondPoint.x)),s=Math.min(i.height,Math.max(t.state.firstPoint.y,t.state.secondPoint.y)),l=0,c=0,u=a-e,g=s-r,d=e*t.devicePixelRatio,m=r*t.devicePixelRatio,h=(a-e)*t.devicePixelRatio,f=(s-r)*t.devicePixelRatio,S=document.createElement("canvas");S.width=u,S.height=g;var C=S.getContext("2d");C.drawImage(i,d,m,h,f,l,c,u,g),n(S)},i.src=e}):Promise.reject(new Error("Expected the two points to be set, but they were not")):Promise.reject(new Error("baseDataUrl should be a non-empty string, but was: "+e))},t.prototype.getCompressedDataUrl=function(e){var t=new r.Event.BaseEvent(r.Event.Label.CompressRegionSelection),n=e,o=n.toDataURL("image/png");return t.setCustomProperty(r.PropertyName.Custom.InitialDataUrlLength,o.length),o=i.DomUtils.adjustImageQualityIfNecessary(n,o),t.setCustomProperty(r.PropertyName.Custom.FinalDataUrlLength,o.length),p.Clipper.logger.logEvent(t),o},t.prototype.getInnerFrame=function(){if(this.state.secondPoint)return{tag:"div",attrs:Object.assign({id:a.Constants.Ids.innerFrame},this.ref(a.Constants.Ids.innerFrame))}},t.prototype.render=function(){var e=this.getInnerFrame();return{tag:"div",attrs:{config:this.updateVisualElements.bind(this),id:a.Constants.Ids.regionSelectorContainer,onmousedown:this.mouseDownHandler.bind(this),onmousemove:this.mouseMoveHandler.bind(this),onmouseup:this.mouseUpHandler.bind(this),ontouchstart:this.touchStartHandler.bind(this),ontouchmove:this.touchMoveHandler.bind(this),ontouchend:this.touchEndHandler.bind(this)},children:[{tag:"canvas",attrs:Object.assign({id:a.Constants.Ids.outerFrame},this.ref(a.Constants.Ids.outerFrame))},e]}},t}(l.ComponentBase),u=c.componentize();n.RegionSelector=u},{"../constants":59,"../domParsers/domUtils":66,"../logging/log":88,"./componentBase":12,"./frontEndGlobals":36,"./status":52}],51:[function(e,t,n){"use strict";var o=e("../constants"),i=e("../settings"),r=e("../utils"),a=e("../contentCapture/augmentationHelper"),s=e("../domParsers/domUtils"),l=e("../localization/localization"),p=e("../logging/log"),c=e("../storage/clipperStorageKeys"),u=e("./clipMode"),g=e("./frontEndGlobals"),d=e("./status"),m=function(){function e(){}return e.startClip=function(e){var t=this;return this.logPageModifications(e),new Promise(function(n,o){t.clipperState=e;var i=e.pageInfo,r=e.previewGlobalInfo.previewTitleText,a=new OneNoteApi.OneNotePage(r,"",i.contentLocale,t.getMetaData()),s=t.addAnnotationToPage(a);e.currentMode.get()!==u.ClipMode.Bookmark&&t.addClippedFromUrlToPage(a),t.addPrimaryContentToPage(a,e.currentMode.get()).then(function(){t.createNewPage(a).then(function(o){t.incrementClipSuccessCount(e),n({responsePackage:o,annotationAdded:s})},function(e){o(e)})})})},e.getClipSuccessStatus=function(e){return e.showRatingsPrompt&&!r.Utils.isNullOrUndefined(e.showRatingsPrompt.get())&&e.oneNoteApiResult.data?d.Status.Succeeded:d.Status.InProgress},e.logPageModifications=function(e){var t=e.currentMode.get()===u.ClipMode.Augmentation,n="Not Applicable",i=new p.Event.BaseEvent(p.Event.Label.PageModifications);if(i.setCustomProperty(p.PropertyName.Custom.ClipMode,u.ClipMode[e.currentMode.get()]),i.setCustomProperty(p.PropertyName.Custom.AugmentationModel,t?a.AugmentationModel[e.augmentationResult.data.ContentModel]:n),i.setCustomProperty(p.PropertyName.Custom.PageTitleModified,e.pageInfo.contentTitle!==e.previewGlobalInfo.previewTitleText),i.setCustomProperty(p.PropertyName.Custom.FontSize,t?e.previewGlobalInfo.fontSize:n),i.setCustomProperty(p.PropertyName.Custom.IsSerif,t?e.previewGlobalInfo.serif:n),t){var r=document.createElement("div");r.innerHTML=s.DomUtils.cleanHtml(e.augmentationPreviewInfo.previewBodyHtml);var l=r.getElementsByClassName(o.Constants.Classes.highlighted);i.setCustomProperty(p.PropertyName.Custom.ContainsAtLeastOneHighlight,l&&l.length>0)}else i.setCustomProperty(p.PropertyName.Custom.ContainsAtLeastOneHighlight,n);g.Clipper.logger.logEvent(i)},e.getMetaData=function(){if(this.clipperState.currentMode.get()===u.ClipMode.Augmentation&&this.clipperState.augmentationResult.data&&this.clipperState.augmentationResult.data.PageMetadata)return this.clipperState.augmentationResult.data.PageMetadata},e.addAnnotationToPage=function(t){var n=this.clipperState.previewGlobalInfo.annotation&&""!==this.clipperState.previewGlobalInfo.annotation;if(n){var o='"'+this.clipperState.previewGlobalInfo.annotation+'"',i=t.escapeHtmlEntities(o),r=e.createPostProcessessedHtml("<div>"+i+"</div>");t.addOnml(r.outerHTML)}return n},e.addClippedFromUrlToPage=function(t){var n=l.Localization.getLocalizedString("WebClipper.FromCitation").replace("{0}",'<a href="'+this.clipperState.pageInfo.rawUrl+'">'+this.clipperState.pageInfo.rawUrl+"</a>"),o=e.createPostProcessessedHtml(n);t.addOnml(o.outerHTML)},e.addPrimaryContentToPage=function(t,n){var o=this,i=this.clipperState;return new Promise(function(n,r){switch(i.currentMode.get()){default:case u.ClipMode.FullPage:i.pageInfo.contentType===OneNoteApi.ContentType.EnhancedUrl?o.addEnhancedUrlContentToPage(t).then(function(){n()}):(t.addHtml(i.pageInfo.contentData),n());break;case u.ClipMode.Region:for(var a=0,s=i.regionResult.data;a<s.length;a++){var l=s[a];t.addOnml('<p><img src="'+l+'" /></p>&nbsp;')}n();break;case u.ClipMode.Augmentation:var p=e.createPostProcessessedHtml(o.clipperState.augmentationPreviewInfo.previewBodyHtml);t.addOnml(p.outerHTML),n();break;case u.ClipMode.Bookmark:var c=e.createPostProcessessedHtml(o.clipperState.bookmarkPreviewInfo.previewBodyHtml);t.addOnml(c.outerHTML),n();break;case u.ClipMode.Selection:var g=e.createPostProcessessedHtml(o.clipperState.selectionPreviewInfo.previewBodyHtml);t.addOnml(g.outerHTML),n()}})},e.createPostProcessessedHtml=function(e){var t=document.createElement("div");t.innerHTML=s.DomUtils.cleanHtml(e);var n=this.clipperState.previewGlobalInfo.fontSize.toString()+"px",o=this.clipperState.previewGlobalInfo.serif?"WebClipper.FontFamily.Preview.SerifDefault":"WebClipper.FontFamily.Preview.SansSerifDefault",i=l.Localization.getLocalizedString(o),r="font-size: "+n+"; font-family: "+i+";";t.setAttribute("style",r);for(var a=t.getElementsByTagName("TABLE"),p=0;p<a.length;p++){var c=a[p];c.setAttribute("style",r)}return this.stripUnwantedUIElements(t),t},e.incrementClipSuccessCount=function(e){var t=e.numSuccessfulClips.get();t++,g.Clipper.storeValue(c.ClipperStorageKeys.numSuccessfulClips,t.toString()),e.numSuccessfulClips.set(t)},e.stripUnwantedUIElements=function(e){for(;;){var t=e.querySelector("."+o.Constants.Classes.deleteHighlightButton);if(!t)break;t.parentNode.removeChild(t)}},e.addEnhancedUrlContentToPage=function(e){var t=this,n=this.clipperState;return new Promise(function(o,i){if(n.pdfResult.status===d.Status.InProgress){var r=new p.Event.PromiseEvent(p.Event.Label.WaitOnBinaryRequestBeforePdfClip);n.pdfResult.data.subscribe(function(n){g.Clipper.logger.logEvent(r),t.addEnhancedUrlContentToPageHelper(e,n.arrayBuffer),o()},{times:1,callOnSubscribe:!1})}else t.addEnhancedUrlContentToPageHelper(e,n.pdfResult.data.get().arrayBuffer),o()})},e.addEnhancedUrlContentToPageHelper=function(e,t){if(this.clipperState.pdfResult.status===d.Status.Succeeded&&t&&t.byteLength<this.maxMimeSizeLimit){var n=r.Utils.getFileNameFromUrl(this.clipperState.pageInfo.rawUrl,"Original.pdf");e.addAttachment(t,n)}e.addObjectUrlAsImage(this.clipperState.pageInfo.rawUrl)},e.createNewPage=function(e){var t={};t[o.Constants.HeaderValues.appIdKey]=i.Settings.getSetting("App_Id"),t[o.Constants.HeaderValues.userSessionIdKey]=g.Clipper.getUserSessionId();var n=new OneNoteApi.OneNoteApi(this.clipperState.userResult.data.user.accessToken,(void 0),t);return n.createPage(e,this.clipperState.saveLocation)},e.maxMimeSizeLimit=249e5,e}();n.SaveToOneNote=m},{"../constants":59,"../contentCapture/augmentationHelper":60,"../domParsers/domUtils":66,"../localization/localization":85,"../logging/log":88,"../settings":104,"../storage/clipperStorageKeys":107,"../utils":111,"./clipMode":9,"./frontEndGlobals":36,"./status":52}],52:[function(e,t,n){"use strict";!function(e){e[e.NotStarted=0]="NotStarted",e[e.InProgress=1]="InProgress",e[e.Succeeded=2]="Succeeded",e[e.Failed=3]="Failed"}(n.Status||(n.Status={}));n.Status},{}],53:[function(e,t,n){"use strict";var o=e("../extensions/invokeSource");!function(e){e[e.ChangeLog=0]="ChangeLog",e[e.Pdf=1]="Pdf",e[e.Product=2]="Product",e[e.Recipe=3]="Recipe",e[e.Video=4]="Video",e[e.WhatsNew=5]="WhatsNew"}(n.TooltipType||(n.TooltipType={}));var i,r=n.TooltipType;!function(e){function t(e){switch(e){case r.Pdf:return o.InvokeSource.PdfTooltip;case r.Product:return o.InvokeSource.ProductTooltip;case r.Recipe:return o.InvokeSource.RecipeTooltip;case r.Video:return o.InvokeSource.VideoTooltip;case r.WhatsNew:return o.InvokeSource.WhatsNewTooltip;default:throw Error("Invalid TooltipType passed in TooltipType.toInvokeSource")}}e.toInvokeSource=t}(i=n.TooltipTypeUtils||(n.TooltipTypeUtils={}))},{"../extensions/invokeSource":78}],54:[function(e,t,n){"use strict";var o=function(){function e(e,t){this.otherSideKeys={},this.queuedCalls={},this.callbackIdPostfix=0,this.functionMap={},this.svFunctions={},this.trackedSmartValues={},this.channel=t,this.messageHandler=e,this.messageHandler.onMessageReceived=this.parseMessage.bind(this),this.sendInitializationMessage()}return e.prototype.getMessageHandler=function(){return this.messageHandler},e.prototype.onInitialized=function(){},e.prototype.tearDown=function(){for(var e in this.trackedSmartValues)if(this.trackedSmartValues.hasOwnProperty(e)&&this.svFunctions[e])for(var t=0;t<this.svFunctions[e].length;t++)this.trackedSmartValues[e].unsubscribe(this.svFunctions[e][t]);this.messageHandler.tearDown()},e.prototype.setErrorHandler=function(e){this.communicatorErrorHandler=e},e.prototype.parseMessage=function(e){var t;try{t=JSON.parse(e)}catch(e){return}if(t&&(!this.channel||t.channel&&t.channel===this.channel)&&(this.channel||!t.channel))try{this.handleDataPackage(t)}catch(e){if(!this.communicatorErrorHandler)throw e;this.communicatorErrorHandler(e)}},e.prototype.handleDataPackage=function(t){var n=this;if(t.functionKey===e.initializationKey){this.sendAcknowledgementMessage();for(var o in this.functionMap)this.functionMap.hasOwnProperty(o)&&this.postMessage({data:o,functionKey:e.registrationKey});this.onInitialized()}else if(t.functionKey===e.acknowledgeKey)this.onInitialized();else if(t.functionKey===e.registrationKey){var i=t.data.toString();if(this.otherSideKeys[i]||(this.otherSideKeys[i]=!0),this.isSmartValueSubscription(i)){var r=i.substr(e.setValuePrefix.length),a=this.trackedSmartValues[r];a&&this.updateRemoteSmartValue(r,a.get())}else if(this.queuedCalls[i]){for(var s=this.queuedCalls[i],l=0;l<s.length;l++)this.postMessage(s[l]);delete this.queuedCalls[i]}}else{var p=this.functionMap[t.functionKey];if(p){var c=p(t.data);c&&c.then&&t.callbackKey&&c.then(function(e){n.callRemoteFunction(t.callbackKey,{param:e})},function(e){n.callRemoteFunction(t.callbackKey,{param:e})})}}},e.prototype.registerFunction=function(t,n){if(!t)throw new Error("param 'name' is invalid");this.functionMap[t]=n,this.postMessage({data:t,functionKey:e.registrationKey})},e.prototype.callRemoteFunction=function(t,n){if(!t)throw new Error("param 'name' is invalid");var o=n?n.param:void 0,i=void 0;n&&n.callback&&(i=t+e.callbackPostfix+"-"+this.callbackIdPostfix++,this.registerFunction(i,n.callback));var r={data:o,functionKey:t};i&&(r.callbackKey=i),this.otherSideKeys[t]?this.postMessage(r):this.isSmartValueSubscription(t)||(this.queuedCalls[t]=this.queuedCalls[t]||[],this.queuedCalls[t].push(r))},e.prototype.subscribeAcrossCommunicator=function(t,n,o){o&&t.subscribe(o,{callOnSubscribe:!1}),this.registerFunction(e.setValuePrefix+n,function(e){t.set(e)})},e.prototype.broadcastAcrossCommunicator=function(e,t){var n=this,o=function(e){n.updateRemoteSmartValue(t,e)};this.svFunctions[t]||(this.svFunctions[t]=[]),this.svFunctions[t].push(o),this.trackedSmartValues[t]=e,e.subscribe(o)},e.prototype.updateRemoteSmartValue=function(t,n){this.callRemoteFunction(e.setValuePrefix+t,{param:n})},e.prototype.sendInitializationMessage=function(){this.postMessage({functionKey:e.initializationKey})},e.prototype.sendAcknowledgementMessage=function(){this.postMessage({functionKey:e.acknowledgeKey})},e.prototype.isSmartValueSubscription=function(t){return t.substr(0,e.setValuePrefix.length)===e.setValuePrefix},e.prototype.postMessage=function(e){this.channel&&(e.channel=this.channel);try{this.messageHandler.sendMessage(JSON.stringify(e))}catch(e){if(!this.communicatorErrorHandler)throw e;this.communicatorErrorHandler(e)}},e.initializationKey="INITIALIZATION-K3Y",e.acknowledgeKey="ACKNOWLEDGE-K3Y",e.registrationKey="REGISTER-FUNCTION-K3Y",e.setValuePrefix="SETVALUE-",e.callbackPostfix="-CALLBACK",e}();n.Communicator=o},{}],55:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./messageHandler"),r=function(e){function t(t){e.call(this),this.getOtherWindow=t,this.initMessageHandler(),window.addEventListener("message",this.messageHandler)}return o(t,e),t.prototype.initMessageHandler=function(){var e=this;this.messageHandler=function(t){e.onMessageReceived(t.data),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}},t.prototype.sendMessage=function(e){var t=this.getOtherWindow();t.postMessage(e,"*")},t.prototype.tearDown=function(){window.removeEventListener("message",this.messageHandler)},t}(i.MessageHandler);n.IFrameMessageHandler=r},{"./messageHandler":57}],56:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("./messageHandler"),r=function(e){function t(t){e.call(this),this.setOtherSide(t)}return o(t,e),t.prototype.initMessageHandler=function(){},t.prototype.inlineMessage=function(e){this.onMessageReceived(e)},t.prototype.setOtherSide=function(e){this.otherSide=e},t.prototype.sendMessage=function(e){this.otherSide&&this.otherSide.inlineMessage(e)},t.prototype.tearDown=function(){},t}(i.MessageHandler);n.InlineMessageHandler=r},{"./messageHandler":57}],57:[function(e,t,n){"use strict";var o=function(){function e(){}return e.prototype.onMessageReceived=function(e){},e}();n.MessageHandler=o},{}],58:[function(e,t,n){"use strict";var o=function(){function e(e){this.subscriptions=[],this.t=e}return e.prototype.subscribe=function(e,t){void 0===t&&(t={}),void 0===t.times&&(t.times=1/0),void 0===t.callOnSubscribe&&(t.callOnSubscribe=!0),t.callOnSubscribe&&e(this.t),t.times>0&&this.subscriptions.push({func:e,times:t.times})},e.prototype.unsubscribe=function(e){for(var t=0;t<this.subscriptions.length;t++)if(e===this.subscriptions[t].func)return void this.subscriptions.splice(t,1)},e.prototype.set=function(e){return this.t!==e&&(this.t=e,this.notifySubscribers()),this},e.prototype.get=function(){return this.t},e.prototype.forceUpdate=function(){this.notifySubscribers()},e.prototype.equals=function(e){return this.t===e},e.prototype.toString=function(){return this.t?this.t.toString():"undefined"},e.prototype.notifySubscribers=function(){for(var e=this.subscriptions.length,t=0;t<e;t++){this.subscriptions[t].times--,this.subscriptions[t].func(this.t);var n=this.subscriptions[t]&&0===this.subscriptions[t].times;n&&this.subscriptions.splice(t,1),this.subscriptions[t]&&!n||(e--,t--)}},e.subscribe=function(e,t){for(var n=0;n<e.length;n++)e[n].subscribe(function(){for(var n=[],o=0;o<e.length;o++)n.push(e[o].get());t.apply(this,n)})},e}();n.SmartValue=o},{}],59:[function(e,t,n){"use strict";var o;!function(e){var t;!function(e){e.heightAnimator="height-animator",e.panelAnimator="panel-animator",e.change="change",e.changes="changes",e.changeBody="change-body",e.changeDescription="change-description",e.changeImage="change-image",e.changeTitle="change-title",e.textAreaInput="textAreaInput",e.textAreaInputMirror="textAreaInputMirror",e.deleteHighlightButton="delete-highlight",e.highlightable="highlightable",e.highlighted="highlighted",e.regionSelection="region-selection",e.regionSelectionImage="region-selection-image",e.regionSelectionRemoveButton="region-selection-remove-button",e.spinner="spinner",e.tooltip="tooltip",e.centeredInPreview="centered-in-preview"}(t=e.Classes||(e.Classes={}));var n;!function(e){e.clipperInfo="ClipperInfo"}(n=e.Cookies||(e.Cookies={}));var o;!function(e){e.annotationContainer="annotationContainer",e.annotationField="annotationField",e.annotationFieldMirror="annotationFieldMirror",e.annotationPlaceholder="annotationPlaceholder",e.bookmarkThumbnail="bookmarkThumbnail",e.bookmarkPreviewContentContainer="bookmarkPreviewContentContainer",e.bookmarkPreviewInnerContainer="bookmarkPreviewInnerContainer",e.clipperApiProgressContainer="clipperApiProgressContainer",e.dialogBackButton="dialogBackButton",e.dialogButtonContainer="dialogButtonContainer",e.dialogDebugMessageContainer="dialogDebugMessageContainer",e.dialogMessageContainer="dialogMessageContainer",e.dialogContentContainer="dialogContentContainer",e.dialogMessage="dialogMessage",e.dialogTryAgainButton="dialogTryAgainButton",e.highlightablePreviewBody="highlightablePreviewBody",e.apiErrorMessage="apiErrorMessage",e.backToHomeButton="backToHomeButton",e.clipperFailureContainer="clipperFailureContainer",e.refreshPageButton="refreshPageButton",e.tryAgainButton="tryAgainButton",e.clipperFooterContainer="clipperFooterContainer",e.currentUserControl="currentUserControl",e.currentUserDetails="currentUserDetails",e.currentUserEmail="currentUserEmail",e.currentUserId="currentUserId",e.currentUserName="currentUserName",e.feedbackButton="feedbackButton",e.feedbackImage="feedbackImage",e.signOutButton="signOutButton",e.userDropdownArrow="userDropdownArrow",e.userSettingsContainer="userSettingsContainer",e.clipperLoadingContainer="clipperLoadingContainer",e.closeButton="closeButton",e.closeButtonContainer="closeButtonContainer",e.mainController="mainController",e.saveToLocationContainer="saveToLocationContainer",e.clipButton="clipButton",e.clipButtonContainer="clipButtonContainer",e.previewBody="previewBody",e.previewContentContainer="previewContentContainer",e.previewHeader="previewHeader",e.previewHeaderContainer="previewHeaderContainer",e.previewHeaderInput="previewHeaderInput",e.previewHeaderInputMirror="previewHeaderInputMirror",e.previewTitleContainer="previewTitleContainer",e.previewSubtitleContainer="previewSubtitleContainer",e.previewInnerContainer="previewInnerContainer",e.previewOptionsContainer="previewOptionsContainer",e.previewInnerWrapper="previewInnerWrapper",e.previewOuterContainer="previewOuterContainer",e.previewUrlContainer="previewUrlContainer",e.previewNotesContainer="previewNotesContainer",e.fullPageControl="fullPageControl",e.fullPageHeaderTitle="fullPageHeaderTitle",e.addAnotherRegionButton="addAnotherRegionButton",e.addRegionControl="addRegionControl",e.regionControl="regionControl",e.regionHeaderTitle="regionHeaderTitle",e.highlightControl="highlightControl",e.highlightButton="highlightButton",e.decrementFontSize="decrementFontSize",e.incrementFontSize="incrementFontSize",e.serifControl="serifControl",e.sansSerif="sansSerif",e.serif="serif",e.bookmarkControl="bookmarkControl",e.bookmarkHeaderTitle="bookmarkHeaderTitle",e.ratingsButtonFeedbackNo="ratingsButtonFeedbackNo",e.ratingsButtonFeedbackYes="ratingsButtonFeedbackYes",e.ratingsButtonInitNo="ratingsButtonInitNo",e.ratingsButtonInitYes="ratingsButtonInitYes",e.ratingsButtonRateNo="ratingsButtonRateNo",e.ratingsButtonRateYes="ratingsButtonRateYes",e.ratingsPromptContainer="ratingsPromptContainer",e.regionInstructionsContainer="regionInstructionsContainer",e.regionClipCancelButton="regionClipCancelButton",e.innerFrame="innerFrame",e.outerFrame="outerFrame",e.regionSelectorContainer="regionSelectorContainer",e.spinnerText="spinnerText",e.locationPickerContainer="locationPickerContainer",e.signInButtonMsa="signInButtonMsa",e.signInButtonOrgId="signInButtonOrgId",e.signInContainer="signInContainer",e.signInLogo="signInLogo",e.signInMessageLabelContainer="signInMessageLabelContainer",e.signInText="signInText",e.clipperSuccessContainer="clipperSuccessContainer",e.launchOneNoteButton="launchOneNoteButton",e.pageNavAnimatedTooltip="pageNavAnimatedTooltip",e.unsupportedBrowserContainer="unsupportedBrowserContainer",e.unsupportedBrowserPanel="unsupportedBrowserPanel",e.changeLogSubPanel="changeLogSubPanel",e.checkOutWhatsNewButton="checkOutWhatsNewButton",e.proceedToWebClipperButton="proceedToWebClipperButton",e.whatsNewTitleSubPanel="whatsNewTitleSubPanel",e.clipperRootScript="oneNoteCaptureRootScript",e.clipperUiFrame="oneNoteWebClipper",e.clipperPageNavFrame="oneNoteWebClipperPageNav",e.clipperExtFrame="oneNoteWebClipperExtension",e.brandingContainer="brandingContainer"}(o=e.Ids||(e.Ids={}));var i;!function(e){e.accept="Accept",e.appIdKey="MS-Int-AppId",e.correlationId="X-CorrelationId",e.noAuthKey="X-NoAuth",e.userSessionIdKey="X-UserSessionId"}(i=e.HeaderValues||(e.HeaderValues={}));var r;!function(e){e.debugLoggingInjectedAndExtension="DEBUGLOGGINGINJECTED_AND_EXTENSION",e.extensionAndUi="EXTENSION_AND_UI",e.injectedAndUi="INJECTED_AND_UI",e.injectedAndExtension="INJECTED_AND_EXTENSION",e.extensionAndPageNavUi="EXTENSION_AND_PAGENAVUI",e.pageNavInjectedAndPageNavUi="PAGENAVINJECTED_AND_PAGENAVUI",e.pageNavInjectedAndExtension="PAGENAVINJECTED_AND_EXTENSION"}(r=e.CommunicationChannels||(e.CommunicationChannels={}));var a;!function(e){e.clipperStrings="CLIPPER_STRINGS",e.clipperStringsFrontLoaded="CLIPPER_STRINGS_FRONT_LOADED",e.closePageNavTooltip="CLOSE_PAGE_NAV_TOOLTIP",e.createHiddenIFrame="CREATE_HIDDEN_IFRAME",e.ensureFreshUserBeforeClip="ENSURE_FRESH_USER_BEFORE_CLIP",e.escHandler="ESC_HANDLER",e.getInitialUser="GET_INITIAL_USER",e.getPageNavTooltipProps="GET_PAGE_NAV_TOOLTIP_PROPS",e.getStorageValue="GET_STORAGE_VALUE",e.getMultipleStorageValues="GET_MULTIPLE_STORAGE_VALUES",e.getTooltipToRenderInPageNav="GET_TOOLTIP_TO_RENDER_IN_PAGE_NAV",e.hideUi="HIDE_UI",e.invokeClipper="INVOKE_CLIPPER",e.invokeClipperFromPageNav="INVOKE_CLIPPER_FROM_PAGE_NAV",e.invokeDebugLogging="INVOKE_DEBUG_LOGGING",e.invokePageNav="INVOKE_PAGE_NAV",e.noOpTracker="NO_OP_TRACKER",e.onSpaNavigate="ON_SPA_NAVIGATE",e.refreshPage="REFRESH_PAGE",e.showRefreshClipperMessage="SHOW_REFRESH_CLIPPER_MESSAGE",e.setInjectOptions="SET_INJECT_OPTIONS",e.setInvokeOptions="SET_INVOKE_OPTIONS",e.setStorageValue="SET_STORAGE_VALUE",e.signInUser="SIGN_IN_USER",e.signOutUser="SIGN_OUT_USER",e.tabToLowestIndexedElement="TAB_TO_LOWEST_INDEXED_ELEMENT",e.takeTabScreenshot="TAKE_TAB_SCREENSHOT",e.telemetry="TELEMETRY",e.toggleClipper="TOGGLE_CLIPPER",e.unloadHandler="UNLOAD_HANDLER",e.updateFrameHeight="UPDATE_FRAME_HEIGHT",e.updatePageInfoIfUrlChanged="UPDATE_PAGE_INFO_IF_URL_CHANGED"}(a=e.FunctionKeys||(e.FunctionKeys={}));var s;!function(e){e.tab=9,e.enter=13,e.esc=27}(s=e.KeyCodes||(e.KeyCodes={}));var l;!function(e){e.clientInfo="CLIENT_INFO",e.isFullScreen="IS_FULL_SCREEN",e.pageInfo="PAGE_INFO",e.sessionId="SESSION_ID",e.user="USER"}(l=e.SmartValueKeys||(e.SmartValueKeys={}));var p;!function(e){e.sectionPickerContainerHeight=280,e.clipperUiWidth=322,e.clipperUiTopRightOffset=20,e.clipperUiDropShadowBuffer=7,e.clipperUiInnerPadding=30;var t;!function(e){e.oneNoteHighlightColor="#fefe56"}(t=e.Colors||(e.Colors={}))}(p=e.Styles||(e.Styles={}));var c;!function(e){e.serviceDomain="https://www.onenote.com",e.augmentationApiUrl=e.serviceDomain+"/onaugmentation/clipperextract/v1.0/",e.changelogUrl=e.serviceDomain+"/whatsnext/webclipper",e.clipperFeedbackUrl=e.serviceDomain+"/feedback",e.clipperInstallPageUrl=e.serviceDomain+"/clipper/installed",e.fullPageScreenshotUrl=e.serviceDomain+"/onaugmentation/clipperDomEnhancer/v1.0/",e.localizedStringsUrlBase=e.serviceDomain+"/strings?ids=WebClipper.",e.userFlightingEndpoint=e.serviceDomain+"/webclipper/userflight",e.msaDomain="https://login.live.com",e.orgIdDomain="https://login.microsoftonline.com";var t;!function(t){t.authRedirectUrl=e.serviceDomain+"/webclipper/auth",t.signInUrl=e.serviceDomain+"/webclipper/signin",t.signOutUrl=e.serviceDomain+"/webclipper/signout",t.userInformationUrl=e.serviceDomain+"/webclipper/userinfo"}(t=e.Authentication||(e.Authentication={}));var n;!function(e){e.authType="authType",e.category="category",e.changelogLocale="omkt",e.channel="channel",e.clientType="clientType",e.clipperId="clipperId",e.clipperVersion="clipperVersion",e.correlationId="correlationId",e.error="error",e.errorDescription="errorDescription",e.event="event",e.eventName="eventName",e.failureId="failureId",e.failureInfo="failureInfo",e.failureType="failureType",e.inlineInstall="inlineInstall",e.label="label",e.noOpType="noOpType",e.stackTrace="stackTrace",e.timeoutInMs="timeoutInMs",e.url="url",e.userSessionId="userSessionId",e.wdFromClipper="wdfromclipper"}(n=e.QueryParams||(e.QueryParams={}))}(c=e.Urls||(e.Urls={}));var u;!function(e){e.oneNoteClipperUsage="OneNoteClipperUsage"}(u=e.LogCategories||(e.LogCategories={}));var g;!function(e){e.fontSizeStep=2,e.maxClipSuccessForRatingsPrompt=12,e.maximumJSTimeValue=864e13,e.maximumFontSize=72,e.maximumNumberOfTimesToShowTooltips=3,e.minClipSuccessForRatingsPrompt=4,e.minimumFontSize=8,e.minTimeBetweenBadRatings=6048e6,e.noOpTrackerTimeoutDuration=2e4,e.timeBetweenDifferentTooltips=6048e5,e.timeBetweenSameTooltip=18144e5,e.timeBetweenTooltips=18144e5}(g=e.Settings||(e.Settings={}))}(o=n.Constants||(n.Constants={}))},{}],60:[function(e,t,n){"use strict";var o=e("../constants"),i=e("../settings"),r=e("../utils"),a=e("../clipperUI/frontEndGlobals"),s=e("../clipperUI/oneNoteApiUtils"),l=e("../domParsers/domUtils"),p=e("../http/http"),c=e("../logging/log");!function(e){e[e.None=0]="None",e[e.Article=1]="Article",e[e.BizCard=2]="BizCard",e[e.Recipe=3]="Recipe",e[e.Product=4]="Product",e[e.Screenshot=5]="Screenshot",e[e.Wrapstar=6]="Wrapstar"}(n.AugmentationModel||(n.AugmentationModel={}));var u=n.AugmentationModel,g=function(){function e(){}return e.augmentPage=function(t,n,i){return new Promise(function(p,g){var d=new c.Event.PromiseEvent(c.Event.Label.AugmentationApiCall),m=r.Utils.generateGuid();d.setCustomProperty(c.PropertyName.Custom.RequestCorrelationId,m),e.makeAugmentationRequest(t,n,i,m).then(function(n){var r=n.parsedResponse,a={ContentModel:u.None,ContentObjects:[]};if(d.setCustomProperty(c.PropertyName.Custom.CorrelationId,n.request.getResponseHeader(o.Constants.HeaderValues.correlationId)),r&&r.length>0&&r[0].ContentInHtml){a=r[0],d.setCustomProperty(c.PropertyName.Custom.AugmentationModel,u[a.ContentModel]);var s=(new DOMParser).parseFromString(a.ContentInHtml,"text/html"),g=e.getArticlePreviewElement(s);l.DomUtils.removeElementsNotSupportedInOnml(s),l.DomUtils.removeBlankImages(s).then(function(){l.DomUtils.addPreviewContainerStyling(g),e.addSupportedVideosToElement(g,i,t),a.ContentInHtml=s.body.innerHTML,p(a)})}else p(a);d.setCustomProperty(c.PropertyName.Custom.AugmentationModel,u[a.ContentModel])},function(e){s.OneNoteApiUtils.logOneNoteApiRequestError(d,e),g()}).then(function(){a.Clipper.logger.logEvent(d)})})},e.getAugmentationType=function(t){var n=u[u.Article].toString();if(!t||!t.augmentationResult||!t.augmentationResult.data)return n;var o=t.augmentationResult.data.ContentModel;return e.isSupportedAugmentatationType(o)&&(n=u[o].toString()),n},e.makeAugmentationRequest=function(e,t,n,r){return new Promise(function(s,l){var c=o.Constants.Urls.augmentationApiUrl+"?renderMethod=extractAggressive&url="+e+"&lang="+t,u={};u[o.Constants.HeaderValues.appIdKey]=i.Settings.getSetting("App_Id"),u[o.Constants.HeaderValues.noAuthKey]="true",u[o.Constants.HeaderValues.userSessionIdKey]=r,p.Http.post(c,n,u).then(function(e){var t;try{t=JSON.parse(e.response)}catch(t){return a.Clipper.logger.logJsonParseUnexpected(e.response),l(OneNoteApi.ErrorUtils.createRequestErrorObject(e,OneNoteApi.RequestErrorType.UNABLE_TO_PARSE_RESPONSE))}var n={parsedResponse:t,request:e};s(n)},function(e){l(e)})})},e.getArticlePreviewElement=function(e){var t=e.getElementsByClassName("MainArticleContainer");return r.Utils.isNullOrUndefined(t)||r.Utils.isNullOrUndefined(t[0])?e.body:t[0]},e.isSupportedAugmentatationType=function(e){return e===u.Article||e===u.Recipe||e===u.Product},e.addSupportedVideosToElement=function(e,t,n){var o=new c.Event.PromiseEvent(c.Event.Label.AddEmbeddedVideo);o.setCustomProperty(c.PropertyName.Custom.Url,n),l.DomUtils.addEmbeddedVideosWhereSupported(e,t,n).then(function(e){r.Utils.isNullOrUndefined(e)||(o.setCustomProperty(c.PropertyName.Custom.VideoSrcUrl,JSON.stringify(e.map(function(e){return e.srcAttribute}))),o.setCustomProperty(c.PropertyName.Custom.VideoDataOriginalSrcUrl,JSON.stringify(e.map(function(e){return e.dataOriginalSrcAttribute}))),a.Clipper.logger.logEvent(o))},function(e){o.setStatus(c.Status.Failed),o.setFailureInfo(e),
a.Clipper.logger.logEvent(o)})},e}();n.AugmentationHelper=g},{"../clipperUI/frontEndGlobals":36,"../clipperUI/oneNoteApiUtils":38,"../constants":59,"../domParsers/domUtils":66,"../http/http":84,"../logging/log":88,"../settings":104,"../utils":111}],61:[function(e,t,n){"use strict";var o=e("../utils"),i=e("../clipperUI/frontEndGlobals"),r=e("../domParsers/domUtils"),a=e("../logging/log"),s=function(){function e(){}return e.bookmarkPage=function(t,n,s,l,p,c){var u=this;return void 0===l&&(l=!1),new Promise(function(g,d){var m=new a.Event.PromiseEvent(a.Event.Label.BookmarkPage);if(o.Utils.isNullOrUndefined(t)||""===t){var h={error:"Page url is null, undefined, or empty",url:t};m.setStatus(a.Status.Failed),m.setFailureInfo(h),i.Clipper.logger.logEvent(m),d(h)}var f={url:t,title:n},S={metadataElementsExist:!0,pageTitleExists:!0,descriptionMetadataUsed:"",thumbnailSrcMetadataUsed:"",thumbnailSrcToDataUrlFailure:void 0};(o.Utils.isNullOrUndefined(n)||0===n.length)&&(S.pageTitleExists=!1),(o.Utils.isNullOrUndefined(s)||0===s.length)&&(S.metadataElementsExist=!1,m.setCustomProperty(a.PropertyName.Custom.BookmarkInfo,JSON.stringify(S)),i.Clipper.logger.logEvent(m),g(f));var C=u.getPrimaryDescription(s);l&&o.Utils.isNullOrUndefined(C)&&(C=e.getFallbackDescription(s),o.Utils.isNullOrUndefined(C)&&(C=e.getTextOnPage(c)));var y=u.getPrimaryThumbnailSrc(s);l&&o.Utils.isNullOrUndefined(y)&&(y=e.getFallbackThumbnailSrc(s),o.Utils.isNullOrUndefined(y)&&(y=e.getFirstImageOnPage(p))),o.Utils.isNullOrUndefined(C)||(C.description=e.truncateString(C.description),f.description=C.description,S.descriptionMetadataUsed=C.metadataUsed.value),o.Utils.isNullOrUndefined(y)?(m.setCustomProperty(a.PropertyName.Custom.BookmarkInfo,JSON.stringify(S)),i.Clipper.logger.logEvent(m),g(f)):(S.thumbnailSrcMetadataUsed=y.metadataUsed.value,y.thumbnailSrc=r.DomUtils.toAbsoluteUrl(y.thumbnailSrc,t),r.DomUtils.getImageDataUrl(y.thumbnailSrc).then(function(e){o.Utils.isNullOrUndefined(e)?(f.thumbnailSrc=y.thumbnailSrc,S.thumbnailSrcToDataUrlFailure="thumbnail conversion to data url returned undefined. falling back to non-data url as source: "+y.thumbnailSrc):f.thumbnailSrc=e},function(e){S.thumbnailSrcToDataUrlFailure=e.error}).then(function(){m.setCustomProperty(a.PropertyName.Custom.BookmarkInfo,JSON.stringify(S)),i.Clipper.logger.logEvent(m),g(f)}))})},e.getElementsByTagName=function(e,t){if(!o.Utils.isNullOrUndefined(e)&&!o.Utils.isNullOrUndefined(t)){for(var n=new Array,i=0,r=t;i<r.length;i++){var a=r[i];n=n.concat(n,Array.prototype.slice.call(e.getElementsByTagName(a)))}return n}},e.getNonWhiteSpaceTextElements=function(e,t){return void 0===t&&(t=!1),t&&r.DomUtils.removeElementsNotSupportedInOnml(e),r.DomUtils.textNodesNoWhitespaceUnder(e)},e.getPrimaryDescription=function(t){var n=e.primaryDescriptionKeyValuePair,i=e.getMetaContent(t,n);if(!o.Utils.isNullOrUndefined(i))return{metadataUsed:n,description:i}},e.getFallbackDescription=function(t){for(var n=0,i=e.fallbackDescriptionKeyValuePairs;n<i.length;n++){var r=i[n],a=e.getMetaContent(t,r);if(!o.Utils.isNullOrUndefined(a))return{metadataUsed:r,description:a}}},e.getTextOnPage=function(t,n){if(void 0===n&&(n=50),!o.Utils.isNullOrUndefined(t)&&t.length>0){var i=e.textOnPageKeyValuePair,r=t.map(function(e){return e.wholeText.trim()}).join(" ");if(!o.Utils.isNullOrUndefined(r)&&r.length>0)return{metadataUsed:i,description:r}}},e.truncateString=function(t,n){if(void 0===n&&(n=e.maxNumCharsInDescription),!o.Utils.isNullOrUndefined(t)){if(0===t.length)return"";if(t.length<=n)return t;var i="...",r=new RegExp("^(.{"+n+"}[^\\s]*)"),a=t.replace(/\s+/g," ").match(r);if(!o.Utils.isNullOrUndefined(a))return a[1]+i}},e.getPrimaryThumbnailSrc=function(t){var n=e.primaryThumbnailKeyValuePair,i=e.getMetaContent(t,n);if(!o.Utils.isNullOrUndefined(i))return{metadataUsed:n,thumbnailSrc:i}},e.getFallbackThumbnailSrc=function(t){for(var n=0,i=e.fallbackThumbnailKeyValuePairs;n<i.length;n++){var r=i[n],a=e.getMetaContent(t,r);if(!o.Utils.isNullOrUndefined(a))return{metadataUsed:r,thumbnailSrc:a}}},e.getFirstImageOnPage=function(t){if(!o.Utils.isNullOrUndefined(t)&&t.length>0){var n=t[0].getAttribute(e.srcAttrName),i=e.firstImageOnPageKeyValuePair;if(!o.Utils.isNullOrUndefined(n)&&""!==n)return{metadataUsed:i,thumbnailSrc:n}}},e.getMetaContent=function(e,t){if(!(o.Utils.isNullOrUndefined(e)||o.Utils.isNullOrUndefined(t)||o.Utils.isNullOrUndefined(t.key)||o.Utils.isNullOrUndefined(t.value)))for(var n=0,i=e;n<i.length;n++){var r=i[n],a=r.getAttribute(t.key);if(a&&a.toLowerCase().split(/\s/).indexOf(t.value.toLowerCase())>-1){var s=void 0;"LINK"===r.nodeName&&(s="href"),"META"===r.nodeName&&(s="content");var l=r.getAttribute(s);if(o.Utils.isNullOrUndefined(l)||0===l.length)return;return l}}},e.maxNumCharsInDescription=140,e.metadataTagNames=[r.DomUtils.Tags.meta,r.DomUtils.Tags.link],e.nameAttrName="name",e.propertyAttrName="property",e.relAttrName="rel",e.srcAttrName="src",e.primaryDescriptionKeyValuePair={key:e.propertyAttrName,value:"og:description"},e.primaryThumbnailKeyValuePair={key:e.propertyAttrName,value:"og:image"},e.firstImageOnPageKeyValuePair={key:"",value:"firstImageOnPage"},e.textOnPageKeyValuePair={key:"",value:"textOnPage"},e.fallbackDescriptionKeyValuePairs=[{key:e.nameAttrName,value:"description"},{key:e.nameAttrName,value:"twitter:description"},{key:e.nameAttrName,value:"keywords"},{key:e.propertyAttrName,value:"article:tag"}],e.fallbackThumbnailKeyValuePairs=[{key:e.nameAttrName,value:"twitter:image:src"},{key:e.nameAttrName,value:"twitter:image"},{key:e.relAttrName,value:"image_src"},{key:e.relAttrName,value:"icon"}],e}();n.BookmarkHelper=s},{"../clipperUI/frontEndGlobals":36,"../domParsers/domUtils":66,"../logging/log":88,"../utils":111}],62:[function(e,t,n){"use strict";var o=e("../clipperUI/frontEndGlobals"),i=e("../clipperUI/oneNoteApiUtils"),r=e("../http/http"),a=e("../logging/log"),s=e("../constants"),l=e("../settings"),p=e("../utils"),c=function(){function e(){}return e.getFullPageScreenshot=function(t){return new Promise(function(n,c){var u=new a.Event.PromiseEvent(a.Event.Label.FullPageScreenshotCall),g=p.Utils.generateGuid();u.setCustomProperty(a.PropertyName.Custom.RequestCorrelationId,g);var d={};d[s.Constants.HeaderValues.accept]="application/json",d[s.Constants.HeaderValues.appIdKey]=l.Settings.getSetting("App_Id"),d[s.Constants.HeaderValues.noAuthKey]="true",d[s.Constants.HeaderValues.userSessionIdKey]=g;var m=function(e){u.setCustomProperty(a.PropertyName.Custom.CorrelationId,e.responseHeaders[s.Constants.HeaderValues.correlationId]),i.OneNoteApiUtils.logOneNoteApiRequestError(u,e)};r.Http.post(s.Constants.Urls.fullPageScreenshotUrl,t,d,[200,204],e.timeout).then(function(e){if(200===e.status)try{n(JSON.parse(e.response)),u.setCustomProperty(a.PropertyName.Custom.FullPageScreenshotContentFound,!0)}catch(t){m(OneNoteApi.ErrorUtils.createRequestErrorObject(e,OneNoteApi.RequestErrorType.UNABLE_TO_PARSE_RESPONSE)),c()}else u.setCustomProperty(a.PropertyName.Custom.FullPageScreenshotContentFound,!1),c()},function(e){m(e),c()}).then(function(){o.Clipper.logger.logEvent(u)})})},e.timeout=5e4,e}();n.FullPageScreenshotHelper=c},{"../clipperUI/frontEndGlobals":36,"../clipperUI/oneNoteApiUtils":38,"../constants":59,"../http/http":84,"../logging/log":88,"../settings":104,"../utils":111}],63:[function(e,t,n){"use strict";var o=e("../clipperUI/frontEndGlobals"),i=e("../logging/log"),r=function(){function e(){}return e.getPdfData=function(t){return new Promise(function(n,r){var a=new i.Event.PromiseEvent(i.Event.Label.GetBinaryRequest);a.setCustomProperty(i.PropertyName.Custom.Url,t);var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer";var l=function(e){a.setStatus(i.Status.Failed),a.setFailureInfo(e),o.Clipper.logger.logEvent(a),r()};s.onload=function(){if(200===s.status&&s.response){var t=s.response;a.setCustomProperty(i.PropertyName.Custom.ByteLength,t.byteLength),o.Clipper.logger.logEvent(a),PDFJS.getDocument(t).then(function(o){e.convertPdfToDataUrls(o).then(function(e){n({arrayBuffer:t,dataUrls:e})})})}else l(OneNoteApi.ErrorUtils.createRequestErrorObject(s,OneNoteApi.RequestErrorType.UNEXPECTED_RESPONSE_STATUS))},s.ontimeout=function(){l(OneNoteApi.ErrorUtils.createRequestErrorObject(s,OneNoteApi.RequestErrorType.REQUEST_TIMED_OUT))},s.onerror=function(){l(OneNoteApi.ErrorUtils.createRequestErrorObject(s,OneNoteApi.RequestErrorType.NETWORK_ERROR))},s.send()})},e.convertPdfToDataUrls=function(t){if(!t||!t.numPages||0===t.numPages)return Promise.resolve([]);var n=new i.Event.PromiseEvent(i.Event.Label.ProcessPdfIntoDataUrls);n.setCustomProperty(i.PropertyName.Custom.NumPages,t.numPages);var r=new Array(t.numPages);return new Promise(function(a){for(var s=function(s){t.getPage(s+1).then(function(l){var p=l.getViewport(1),c=document.createElement("canvas"),u=c.getContext("2d");c.height=p.height,c.width=p.width;var g={canvasContext:u,viewport:p};l.render(g).then(function(){r[s]=c.toDataURL(),e.isArrayComplete(r)&&(n.stopTimer(),n.setCustomProperty(i.PropertyName.Custom.AverageProcessingDurationPerPage,n.getDuration()/t.numPages),o.Clipper.logger.logEvent(n),a(r))})})},l=0;l<t.numPages;l++)s(l)})},e.isArrayComplete=function(e){for(var t=0;t<e.length;t++)if(!e[t])return!1;return!0},e}();n.PdfScreenshotHelper=r},{"../clipperUI/frontEndGlobals":36,"../logging/log":88}],64:[function(e,t,n){"use strict";var o,i=e("./khanAcademyVideoExtractor"),r=e("./videoUtils"),a=e("./vimeoVideoExtractor"),s=e("./YoutubeVideoExtractor");!function(e){function t(e){var t=r.VideoUtils.SupportedVideoDomains;switch(e){case t.KhanAcademy:return new i.KhanAcademyVideoExtractor;case t.Vimeo:return new a.VimeoVideoExtractor;case t.YouTube:return new s.YoutubeVideoExtractor;default:return}}e.createVideoExtractor=t}(o=n.VideoExtractorFactory||(n.VideoExtractorFactory={}))},{"./YoutubeVideoExtractor":65,"./khanAcademyVideoExtractor":67,"./videoUtils":68,"./vimeoVideoExtractor":69}],65:[function(e,t,n){"use strict";var o=e("./domUtils"),i=e("../utils"),r=function(){function e(){this.youTubeWatchVideoBaseUrl="https://www.youtube.com/watch",this.youTubeVideoIdQueryKey="v",this.dataOriginalSrcAttribute="data-original-src"}return e.prototype.getVideoIds=function(e,t){if(!i.Utils.isNullOrUndefined(e)){var n;if(0!==i.Utils.getPathname(e).indexOf("/watch")||(n=i.Utils.getQueryValue(e,this.youTubeVideoIdQueryKey),!i.Utils.isNullOrUndefined(n))){if(0===i.Utils.getPathname(e).indexOf("/embed")){var o=e.match(/youtube\.com\/embed\/(\S+)/);if(i.Utils.isNullOrUndefined(o)||i.Utils.isNullOrUndefined(o[1]))return;n=o[1]}if(!i.Utils.isNullOrUndefined(n))return[n]}}},e.prototype.getVideoSrcValues=function(e,t){if(!i.Utils.isNullOrUndefined(e)){var n=this.getVideoIds(e,t);if(!i.Utils.isNullOrUndefined(n))return["https://www.youtube.com/embed/"+n]}},e.prototype.createEmbeddedVideos=function(e,t){var n=o.DomUtils.createEmbedVideoIframe(),r=this.getVideoSrcValues(e,t),a=this.getVideoIds(e,t)[0];if(i.Utils.isNullOrUndefined(r)||i.Utils.isNullOrUndefined(a))throw new Error("YouTube page url does not contain video id");return n.src=r[0],n.setAttribute(this.dataOriginalSrcAttribute,i.Utils.addUrlQueryValue(this.youTubeWatchVideoBaseUrl,this.youTubeVideoIdQueryKey,a)),[n]},e}();n.YoutubeVideoExtractor=r},{"../utils":111,"./domUtils":66}],66:[function(e,t,n){"use strict";var o,i=e("../constants"),r=e("../utils"),a=e("./videoUtils"),s=e("./VideoExtractorFactory");!function(e){function t(e){var t=[];for(var n in j)j.hasOwnProperty(n)&&(t=t.concat(j[n]));var o=$.concat(q).concat(G),i=sanitizeHtml(e,{allowedTags:o,allowedAttributes:j,allowedSchemes:sanitizeHtml.defaults.allowedSchemes.concat(["data"]),allowedClasses:{"*":["MainArticleContainer"]}});return i}function n(t){o(t,J.join());var n=[K.main,K.article,K.figure,K.header,K.center];o(t,n.join(),function(t){var n=document.createElement("div");return n.innerHTML=e.cleanHtml(t.innerHTML),n})}function o(e,t,n){void 0===n&&(n=function(){});for(var o=e.querySelectorAll(t),i=0;i<o.length;i++){var r=o[i];try{var a=n(r,i);a?r!==a&&r.parentNode.replaceChild(a,r):r.parentNode.removeChild(r)}catch(e){}}}function l(e,t,n){return void 0===n&&(n=function(){return Promise.resolve(void 0)}),new Promise(function(o){var i=e.querySelectorAll(t),r=0;0===i.length&&o();for(var a=function(e){var t=i[e];n(t,e).then(function(e){e?t!==e&&t.parentNode.replaceChild(e,t):t.parentNode.removeChild(t)},function(){}).then(function(){++r===i.length&&o()})},s=0;s<i.length;s++)a(s)})}function p(e){var t=e.createElement("a");if(t.href=e.URL,/\.pdf$/i.test(t.pathname)){var n=e.querySelector("embed");if(n&&/application\/pdf/i.test(n.type))return OneNoteApi.ContentType.EnhancedUrl;if(window&&window.PDFJS)return OneNoteApi.ContentType.EnhancedUrl}return OneNoteApi.ContentType.Html}function c(e){var t=e.querySelectorAll("link[rel=canonical]");if(0===t.length)return e.URL;for(var n=t[0].href,o=void 0,i=1;i<t.length;i++)o=t.item(i).href,o.length<n.length&&(n=o);return n}function u(e){var t=y(e);F(t,e),v(t,e.location),N(t),g(t);var n=k(t);return n}function g(e){I(e),P(e),T(e)}function d(e){e.setAttribute("style","margin-bottom: 16px")}function m(e,t,n){return new Promise(function(o,i){var r=a.VideoUtils.videoDomainIfSupported(n);r||o();var l=[];try{var p=a.VideoUtils.SupportedVideoDomains[r],c=s.VideoExtractorFactory.createVideoExtractor(p);c&&(l=l.concat(c.createEmbeddedVideos(n,t)))}catch(n){i({error:JSON.stringify({doc:e.outerHTML,pageContent:t,message:n.message})})}o(f(e,l))})}function h(){var e=document.createElement("iframe");return e.width="600",e.height="338",e.frameBorder="0",e.allowFullscreen=!1,e}function f(e,t){if(!r.Utils.isNullOrUndefined(e)&&!r.Utils.isNullOrUndefined(t)&&0!==t.length){for(var n,o=[],i=0,a=t;i<a.length;i++){var s=a[i];r.Utils.isNullOrUndefined(s.src)||r.Utils.isNullOrUndefined(s.getAttribute(Q))?o.push({srcAttribute:"",dataOriginalSrcAttribute:""}):(n=S(e,s,n),n=C(e,n.nextSibling),o.push({srcAttribute:s.src,dataOriginalSrcAttribute:s.getAttribute(Q)}))}return o}}function S(e,t,n){var o;return o=r.Utils.isNullOrUndefined(n)?e.children[0]:n.nextSibling,e.insertBefore(t,o)}function C(e,t){var n=document.createElement("br");return e.insertBefore(n,t)}function y(e){return e.cloneNode(!0)}function v(e,t){if(!e.head){var n=e.createElement(K.head),o=e.getElementsByTagName(K.html)[0];o.insertBefore(n,o.children[0])}t||(t=document.location);var i=e.head.getElementsByTagName(K.base);if(0===i.length){var r=t.href.split("#")[0].split("?")[0];r=r.substr(0,r.lastIndexOf("/")+1);var a=e.createElement(K.base);a.href=r,e.head.insertBefore(a,e.head.firstChild)}}function b(e){return l(e,K.img,function(e){return new Promise(function(t){var n=e,o=new Image;o.crossOrigin="anonymous",o.onload=function(){t(w(o)?void 0:e)},o.onerror=function(){t(void 0)},o.src=n.src})})}function w(e){if(0===e.width||0===e.height)return!1;var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);try{for(var o=n.getImageData(0,0,t.width,t.height),i=o.data,r=0;r<i.length;r+=4)if(0!==i[r+3]&&(255!==i[r]||255!==i[r+1]||255!==i[r+2]))return!1;return!0}catch(e){return!1}}function I(e){o(e,["#"+i.Constants.Ids.clipperRootScript,"#"+i.Constants.Ids.clipperUiFrame,"#"+i.Constants.Ids.clipperExtFrame].join()),o(e,K.iframe,function(e){var t=e,n=t.src;if(0!==n.indexOf("chrome-extension://")&&0!==n.indexOf("safari-extension://")&&0!==n.indexOf("firefox-extension://")&&0!==n.indexOf("file://"))return t})}function P(e){o(e,[K.script,K.noscript].join())}function T(e){for(var t=e.getElementsByTagName("IMG"),n=0;n<t.length;n++){var o=t[n];o.srcset=void 0,o.removeAttribute("srcset")}}function E(e){o(e,K.img,function(e,t){var n=e,o=n.attributes.src;if(o&&o.value)return n.src=U(o.value,location.origin),n}),o(e,K.a,function(e,t){var n=e,o=n.attributes.href;return o&&o.value?(n.href=U(o.value,location.origin),n):e})}function U(e,t){if(!e||!t)throw new Error("parameters must be non-empty, but was: "+e+", "+t);var n=new URI(e);return n.is("relative")?n.absoluteTo(t).valueOf():e}function F(e,t){var n=t.querySelectorAll(K.canvas);o(e,K.canvas,function(t,o){var i=n[o];if(i){var r=e.createElement(K.img);return r.src=i.toDataURL(),r.style.cssText=window.getComputedStyle(i).cssText,r}})}function N(e){for(var t=e.getElementsByTagName("img"),n=0;n<t.length;n++){var o=t[n];if(!o.hasAttribute("data-height")){var i=o.height;o.setAttribute("data-height",i.toString())}if(!o.hasAttribute("data-width")){var r=o.width;o.setAttribute("data-width",r.toString())}}}function A(t){return new Promise(function(n,o){(r.Utils.isNullOrUndefined(t)||""===t)&&o({error:"image source is undefined or empty"});var i=new Image;i.crossOrigin="anonymous",i.onload=function(){var o=document.createElement(K.canvas);o.width=i.naturalWidth,o.height=i.naturalHeight,o.getContext("2d").drawImage(i,0,0);try{var r=o.toDataURL("image/png");r=e.adjustImageQualityIfNecessary(o,r),n(r)}catch(e){n(t)}},i.onerror=function(e){var t,n=e.currentTarget;r.Utils.isNullOrUndefined(n)||(t=n.src),o({error:"onerror occurred fetching "+t})},i.src=t,(i.complete||void 0===i.complete)&&(i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",i.src=t)})}function L(t,n,o,i){void 0===o&&(o=1),void 0===i&&(i=.1);for(var r=0;o>0&&n.length>e.maxBytesForMediaTypes;)n=t.toDataURL("image/jpeg",o),o-=i,r++;return n}function k(e){return O(e)+e.documentElement.outerHTML}function R(e,t){var n=document.implementation.createHTMLDocument(t);return n.documentElement.innerHTML=e,n}function O(e){var t=e.doctype;return t?"<!DOCTYPE "+t.name+(t.publicId?' PUBLIC "'+t.publicId+'"':"")+(!t.publicId&&t.systemId?" SYSTEM":"")+(t.systemId?' "'+t.systemId+'"':"")+">":""}function x(e){return unescape?unescape(encodeURIComponent(e)).length:z(e).length}function B(e,t){var n=z(e);if(n.length<=t)return e;n=n.slice(0,t);for(var o=n.join("");o.length;)try{return o=o.slice(0,-1),decodeURIComponent(o)}catch(e){return""}}function z(e){return encodeURIComponent(e).match(/%..|./g)||[]}function H(e){var t=e.getElementsByTagName("html")[0].getAttribute("lang");return t?t:window.navigator.language||window.navigator.userLanguage}function D(e){var t=e.createElement("a");if(t.href=e.URL,t.pathname.match(new RegExp(".pdf$","gi"))){var n=t.pathname.match(/[^\/]+$/g);if(n)return decodeURIComponent(n.pop())}return e.title}function M(e){for(var t,n=[],o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){if(!/^\s*$/.test(e.data))return NodeFilter.FILTER_ACCEPT}},!1);t=o.nextNode();)n.push(t);return n}function V(e){for(var t=["onclick","ondblclick","onmousedown","onmouseup","onmouseover","onmousemove","onmouseout","ondragstart","ondrag","ondragenter","ondragleave","ondragover","ondrop","ondragend","onkeydown","onkeypress","onkeyup","onload","onunload","onabort","onerror","onresize","onscroll","onselect","onchange","onsubmit","onreset","onfocus","onblur"],n=0;n<t.length;n++)for(var o=e.querySelectorAll("["+t[n]+"]"),i=0;i<o.length;i++)o[i].removeAttribute(t[n])}function W(e){return n(e),o(e,[K.iframe].join()),g(e),E(e),_(e),V(e),b(e)}function _(e){o(e,"*",function(e,t){return e.removeAttribute("style"),e.removeAttribute("class"),e})}var K;!function(e){e.a="a",e.b="b",e.applet="applet",e.article="article",e.audio="audio",e.base="base",e.body="body",e.br="br",e.button="button",e.canvas="canvas",e.center="center",e.cite="cite",e.del="del",e.div="div",e.em="em",e.embed="embed",e.figure="figure",e.font="font",e.h1="h1",e.h2="h2",e.h3="h3",e.h4="h4",e.h5="h5",e.h6="h6",e.head="head",e.header="header",e.hr="hr",e.html="html",e.i="i",e.iframe="iframe",e.img="img",e.input="input",e.li="li",e.link="link",e.main="main",e.map="map",e.menu="menu",e.menuitem="menuitem",e.meta="meta",e.meter="meter",e.noscript="noscript",e.object="object",e.ol="ol",e.p="p",e.progress="progress",e.script="script",e.span="span",e.source="source",e.strike="strike",e.strong="strong",e.style="style",e.sub="sub",e.sup="sup",e.svg="svg",e.table="table",e.td="td",e.title="title",e.tr="tr",e.u="u",e.ul="ul",e.video="video"}(K=e.Tags||(e.Tags={}));var j={a:["href","name","target"],img:["src"],"*":["src","background-color","color","font-family","font-size","data*","alt","height","width","style","id","type"]},G=[K.table,K.td,K.tr],q=[K.b,K.em,K.strong,K.i,K.u,K.strike,K.del,K.sup,K.sub,K.cite,K.font],$=[K.html,K.head,K.title,K.meta,K.body,K.div,K.span,K.article,K.figure,K.header,K.main,K.center,K.iframe,K.a,K.p,K.br,K.h1,K.h2,K.h3,K.h4,K.h5,K.h6,K.ul,K.ol,K.li,K.img,K.object,K.video],J=[K.applet,K.audio,K.button,K.canvas,K.embed,K.hr,K.input,K.link,K.map,K.menu,K.menuitem,K.meter,K.noscript,K.progress,K.script,K.source,K.style,K.svg,K.video];e.cleanHtml=t,e.removeElementsNotSupportedInOnml=n,e.domReplacer=o,e.domReplacerAsync=l,e.getPageContentType=p,e.fetchCanonicalUrl=c,e.getCleanDomOfCurrentPage=u,e.removeUnwantedItems=g,e.addPreviewContainerStyling=d;var Q="data-original-src";e.addEmbeddedVideosWhereSupported=m,e.createEmbedVideoIframe=h,e.cloneDocument=y,e.addBaseTagIfNecessary=v,e.removeBlankImages=b,e.imageIsBlank=w,e.removeClipperElements=I,e.removeUnwantedElements=P,e.removeUnwantedAttributes=T,e.convertRelativeUrlsToAbsolute=E,e.toAbsoluteUrl=U,e.convertCanvasElementsToImages=F,e.addImageSizeInformationToDom=N,e.getImageDataUrl=A,e.maxBytesForMediaTypes=2096652,e.adjustImageQualityIfNecessary=L,e.getDomString=k,e.getDocumentFromDomString=R,e.getDoctype=O,e.getByteSize=x,e.truncateStringToByteSize=B,e.getByteArray=z,e.getLocale=H,e.getFileNameFromUrl=D,e.textNodesNoWhitespaceUnder=M,e.removeEventListenerAttributes=V,e.toOnml=W}(o=n.DomUtils||(n.DomUtils={}))},{"../constants":59,"../utils":111,"./VideoExtractorFactory":64,"./videoUtils":68}],67:[function(e,t,n){"use strict";var o=e("./videoUtils"),i=e("./youtubeVideoExtractor"),r=e("../utils"),a=function(){function e(){this.youtubeExtractor=new i.YoutubeVideoExtractor}return e.prototype.getVideoIds=function(e,t){var n=/id\s*=\s*("\s*video_(\S+)\s*"|'\s*video_(\S+)\s*')/gi,i=/data-youtubeid\s*=\s*("\s*(\S+)\s*"|'\s*(\S+)\s*')/gi,r=[n,i];return o.VideoUtils.matchRegexFromPageContent(t,r)},e.prototype.getVideoSrcValues=function(e,t){if(!r.Utils.isNullOrUndefined(t)){var n=this.getVideoIds(e,t);if(!r.Utils.isNullOrUndefined(n)&&0!==n.length)return["https://www.youtube.com/embed/"+n[0]]}},e.prototype.createEmbeddedVideos=function(e,t){var n=this.getVideoSrcValues(e,t);if(0===n.length)return[];var o=n[0];return this.youtubeExtractor.createEmbeddedVideos(o,t)},e}();n.KhanAcademyVideoExtractor=a},{"../utils":111,"./videoUtils":68,"./youtubeVideoExtractor":70}],68:[function(e,t,n){"use strict";var o,i=e("../utils");!function(e){function t(e){if(i.Utils.onWhitelistedDomain(e)){var t=i.Utils.getHostname(e);for(var n in o)if("string"==typeof n&&t.indexOf(n.toLowerCase()+".")>-1)return n}}function n(e,t){if(!i.Utils.isNullOrUndefined(e)){var n,o=[];if(t.forEach(function(t){for(;n=t.exec(e);)n[2]?o.push(n[2]):o.push(n[3])}),0!==o.length)return o.filter(function(e,t,n){return n.indexOf(e)===t})}}e.youTubeWatchVideoBaseUrl="https://www.youtube.com/watch",e.youTubeVideoIdQueryKey="v",function(e){e[e.YouTube=0]="YouTube",e[e.Vimeo=1]="Vimeo",e[e.KhanAcademy=2]="KhanAcademy"}(e.SupportedVideoDomains||(e.SupportedVideoDomains={}));var o=e.SupportedVideoDomains;e.videoDomainIfSupported=t,e.matchRegexFromPageContent=n}(o=n.VideoUtils||(n.VideoUtils={}))},{"../utils":111}],69:[function(e,t,n){"use strict";var o=e("./domUtils"),i=e("./videoUtils"),r=e("../utils"),a=function(){function e(){this.dataOriginalSrcAttribute="data-original-src"}return e.prototype.getVideoIds=function(e,t){if(!r.Utils.isNullOrUndefined(t)){var n=/id\s*=\s*("\s*clip_(\d+)\s*"|'\s*clip_(\d+)\s*')/gi;return i.VideoUtils.matchRegexFromPageContent(t,[n])}},e.prototype.getVideoSrcValues=function(e,t){if(!r.Utils.isNullOrUndefined(t)){var n=this.getVideoIds(e,t);if(!r.Utils.isNullOrUndefined(n)){for(var o=[],i=0,a=n;i<a.length;i++){var s=a[i];o.push("https://player.vimeo.com/video/"+s)}return o}}},e.prototype.createEmbeddedVideos=function(e,t){var n=this.getVideoSrcValues(e,t);if(r.Utils.isNullOrUndefined(n))throw new Error("Vimeo page content does not contain clip ids");for(var i=[],a=0,s=n;a<s.length;a++){var l=s[a],p=o.DomUtils.createEmbedVideoIframe();p.src=l,p.setAttribute(this.dataOriginalSrcAttribute,l),i.push(p)}return i},e}();n.VimeoVideoExtractor=a},{"../utils":111,"./domUtils":66,"./videoUtils":68}],70:[function(e,t,n){arguments[4][65][0].apply(n,arguments)},{"../utils":111,"./domUtils":66,dup:65}],71:[function(e,t,n){"use strict";var o;!function(e){function t(e,t){var i=o[e];if(!n||!n[i])return!1;var r=n[i];return!(!t||t.indexOf(r)===-1)}var n={DummyExperiment:"dummy-flight"};e.updateIntervalForFlights=18e6,function(e){e[e.DummyExperiment=0]="DummyExperiment"}(e.Feature||(e.Feature={}));var o=e.Feature;e.isFeatureEnabled=t}(o=n.Experiments||(n.Experiments={}))},{}],72:[function(e,t,n){"use strict";var o=e("../communicator/smartValue"),i=e("../logging/log"),r=e("../http/http"),a=e("../storage/clipperStorageKeys"),s=e("../constants"),l=e("../userInfo"),p=e("../utils"),c=function(){function e(e,t){this.user=new o.SmartValue,this.logger=t,this.clipperData=e}return e.prototype.updateUserInfoData=function(t,n){var o=this;return new Promise(function(r){var s=0,l=o.clipperData.getValue(a.ClipperStorageKeys.userInformation);if(l){var c=void 0;try{c=JSON.parse(l)}catch(e){o.logger.logJsonParseUnexpected(l)}c&&c.data&&p.Utils.isNumeric(c.data.accessTokenExpiration)&&(s=Math.max(1e3*c.data.accessTokenExpiration-18e4,0))}var u=function(){return new Promise(function(n,o){e.getClipperInfoCookie(t).then(function(i){e.retrieveUserInformation(t,i).then(function(e){n(e)},function(e){o(e)})})})},g=new i.Event.PromiseEvent(i.Event.Label.GetExistingUserInformation);g.setCustomProperty(i.PropertyName.Custom.UserInformationStored,!!l),o.clipperData.getFreshValue(a.ClipperStorageKeys.userInformation,u,s).then(function(e){g.setCustomProperty(i.PropertyName.Custom.FreshUserInfoAvailable,!!e),e?o.user.set({user:e.data,lastUpdated:e.lastUpdated,updateReason:n}):o.user.set({updateReason:n}),r(o.user.get())},function(e){g.setStatus(i.Status.Failed),g.setFailureInfo(e),o.user.set({updateReason:n}),r(o.user.get())}).then(function(){o.logger.logEvent(g)})})},e.getClipperInfoCookie=function(e){return new Promise(function(e){var t=setTimeout(function(){e(void 0)},3e3);navigator.userAgent.search(/edge/i)!==-1?browser.cookies.get({url:s.Constants.Urls.serviceDomain,name:s.Constants.Cookies.clipperInfo},function(n){clearTimeout(t),e(n?n.value:"")}):e(void 0)})},e.deleteUserAuthenticationCookies=function(e){browser.cookies.remove({url:s.Constants.Urls.serviceDomain,name:s.Constants.Cookies.clipperInfo});var t=s.Constants.Urls.msaDomain;e===l.AuthType.OrgId&&(t=s.Constants.Urls.orgIdDomain),browser.cookies.getAll({url:t},function(e){for(var n=0;n<e.length;n++)browser.cookies.remove({url:t+e[n].path,name:e[n].name})})},e.retrieveUserInformation=function(e,t){var n=this;return void 0===t&&(t=void 0),new Promise(function(o,i){var a=p.Utils.addUrlQueryValue(s.Constants.Urls.Authentication.userInformationUrl,s.Constants.Urls.QueryParams.clipperId,e),l={};l["Content-type"]="application/x-www-form-urlencoded";var c="";p.Utils.isNullOrUndefined(t)||(c=t.replace(/\+/g,"%2B")),r.Http.post(a,c,l).then(function(e){var t=e.response;o({parsedResponse:n.isValidUserInformationJsonString(t)?t:void 0,request:e})},function(e){i(e)})})},e.isValidUserInformationJsonString=function(e){var t;try{t=JSON.parse(e)}catch(e){return!1}return!!(t&&t.accessToken&&t.accessTokenExpiration>0&&t.authType)},e}();n.AuthenticationHelper=c},{"../communicator/smartValue":58,"../constants":59,"../http/http":84,"../logging/log":88,"../storage/clipperStorageKeys":107,"../userInfo":110,"../utils":111}],73:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../clientType"),r=e("../../storage/clipperData"),a=e("../../storage/localStorage"),s=e("../extensionBase"),l=e("./inlineWorker"),p=function(e){function t(){e.call(this,i.ClientType.Bookmarklet,new r.ClipperData(new a.LocalStorage)),this.worker=new l.InlineWorker(this.clientInfo,this.auth),this.addWorker(this.worker)}return o(t,e),t.prototype.getIdFromTab=function(e){},t.prototype.getInlineMessageHandler=function(){return this.worker.getUiMessageHandler()},t.prototype.getUniqueId=function(){},t.prototype.addPageNavListener=function(e){},t.prototype.checkIfTabMatchesATooltipType=function(e,t){},t.prototype.checkIfTabIsAVideoDomain=function(e){return!1},t.prototype.checkIfTabIsOnWhitelistedUrl=function(e){return!1},t.prototype.createWorker=function(e){},t.prototype.onFirstRun=function(){},t}(s.ExtensionBase);n.InlineExtension=p},{"../../clientType":1,"../../storage/clipperData":105,"../../storage/localStorage":108,"../extensionBase":75,"./inlineWorker":74}],74:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../../communicator/iframeMessageHandler"),r=e("../../communicator/inlineMessageHandler"),a=e("../../logging/log"),s=e("../../storage/clipperData"),l=e("../../storage/localStorage"),p=e("../../userInfo"),c=e("../../utils"),u=e("../extensionWorkerBase"),g=e("../invokeOptions"),d=e("../invokeSource"),m=function(e){function t(t,n){var o=function(){return new r.InlineMessageHandler},p=function(){return new i.IFrameMessageHandler(function(){return parent})};e.call(this,t,n,new s.ClipperData(new l.LocalStorage),o,p),this.logger.setContextProperty(a.Context.Custom.InPrivateBrowsing,a.unknownValue);var c={invokeMode:g.InvokeMode.Default};this.sendInvokeOptionsToInject(c),this.logger.logUserFunnel(a.Funnel.Label.Invoke),this.logClipperInvoke({invokeSource:d.InvokeSource.Bookmarklet},c)}return o(t,e),t.prototype.getUiMessageHandler=function(){return this.uiCommunicator.getMessageHandler()},t.prototype.getUrl=function(){return"inline - unknown"},t.prototype.invokeClipperBrowserSpecific=function(){return this.throwNotImplementedFailure()},t.prototype.invokeDebugLoggingBrowserSpecific=function(){return this.throwNotImplementedFailure()},t.prototype.invokeWhatsNewTooltipBrowserSpecific=function(e){return this.throwNotImplementedFailure()},t.prototype.invokeTooltipBrowserSpecific=function(){return this.throwNotImplementedFailure()},t.prototype.takeTabScreenshot=function(){return this.throwNotImplementedFailure()},t.prototype.doSignInAction=function(e){var t=this.getUserSessionIdQueryParamValue(),n=c.Utils.generateSignInUrl(this.clientInfo.get().clipperId,t,p.AuthType[e]);return this.launchPopupAndWaitForClose(n)},t.prototype.doSignOutAction=function(e){var t=this.getUserSessionIdQueryParamValue(),n=c.Utils.generateSignOutUrl(this.clientInfo.get().clipperId,t,p.AuthType[e]),o=document.createElement("iframe");o.hidden=!0,o.style.display="none",o.src=n,document.body.appendChild(o)},t.prototype.throwNotImplementedFailure=function(){throw this.logger.logFailure(a.Failure.Label.NotImplemented,a.Failure.Type.Unexpected),new Error("not implemented")},t}(u.ExtensionWorkerBase);n.InlineWorker=m},{"../../communicator/iframeMessageHandler":55,"../../communicator/inlineMessageHandler":56,"../../logging/log":88,"../../storage/clipperData":105,"../../storage/localStorage":108,"../../userInfo":110,"../../utils":111,"../extensionWorkerBase":76,"../invokeOptions":77,"../invokeSource":78}],75:[function(e,t,n){"use strict";var o=e("../clientType"),i=e("../constants"),r=e("../experiments"),a=e("../utils"),s=e("../clipperUI/tooltipType"),l=e("../communicator/smartValue"),p=e("../http/http"),c=e("../localization/localization"),u=e("../localization/localizationHelper"),g=e("../logging/log"),d=e("../storage/clipperStorageKeys"),m=e("../versioning/changeLog"),h=e("../versioning/changeLogHelper"),f=e("../versioning/version"),S=e("./authenticationHelper"),C=e("./tooltipHelper"),y=e("./workerPassthroughLogger"),v=function(){
function e(t,n){this.setUnhandledExceptionLogging(),this.workers=[],this.logger=new y.WorkerPassthroughLogger(this.workers),this.clipperData=n,this.clipperData.setLogger(this.logger),this.auth=new S.AuthenticationHelper(this.clipperData,this.logger),this.tooltip=new C.TooltipHelper(this.clipperData);var o=!1,i=this.clipperData.getValue(d.ClipperStorageKeys.clipperId);i||(o=!0,i=e.generateClipperId(),this.clipperData.setValue(d.ClipperStorageKeys.clipperId,i),this.updateLastSeenVersionInStorageToCurrent()),this.clientInfo=new l.SmartValue({clipperType:t,clipperVersion:e.getExtensionVersion(),clipperId:i}),o&&this.onFirstRun(),this.initializeUserFlighting(),this.listenForOpportunityToShowPageNavTooltip()}return e.getExtensionVersion=function(){return e.version},e.shouldCheckForMajorUpdates=function(e,t){return!!t&&(!e||e.isLesserThan(t))},e.prototype.addWorker=function(e){var t=this;e.setOnUnloading(function(){e.destroy(),t.removeWorker(e)}),this.workers.push(e)},e.prototype.getWorkers=function(){return this.workers},e.prototype.removeWorker=function(e){var t=this.workers.indexOf(e);t>-1&&this.workers.splice(t,1)},e.isOnOneNoteDomain=function(e){return e.indexOf("onenote.com")>=0||e.indexOf("onenote-int.com")>=0},e.prototype.fetchAndStoreLocStrings=function(){var e=this,t=navigator.language||navigator.userLanguage;return new Promise(function(n,o){u.LocalizationHelper.makeLocStringsFetchRequest(t).then(function(i){try{var r=JSON.parse(i.parsedResponse);r&&(e.clipperData.setValue(d.ClipperStorageKeys.locale,t),e.clipperData.setValue(d.ClipperStorageKeys.locStrings,i.parsedResponse),c.Localization.setLocalizedStrings(r)),n(r)}catch(e){o()}},function(e){o()})})},e.prototype.getClipperInstalledPageUrl=function(t,n,r){var s=i.Constants.Urls.clipperInstallPageUrl;return s=a.Utils.addUrlQueryValue(s,i.Constants.Urls.QueryParams.clientType,o.ClientType[n]),s=a.Utils.addUrlQueryValue(s,i.Constants.Urls.QueryParams.clipperId,t),s=a.Utils.addUrlQueryValue(s,i.Constants.Urls.QueryParams.clipperVersion,e.getExtensionVersion()),s=a.Utils.addUrlQueryValue(s,i.Constants.Urls.QueryParams.inlineInstall,r.toString()),this.logger.logTrace(g.Trace.Label.RequestForClipperInstalledPageUrl,g.Trace.Level.Information,s),s},e.prototype.getExistingWorkerForTab=function(e){for(var t=this.getWorkers(),n=0,o=t;n<o.length;n++){var i=o[n];if(i.getUniqueId()===e)return i}},e.prototype.getFlightingAssignments=function(e){var t=this,n=function(){return new Promise(function(t,n){var o=a.Utils.addUrlQueryValue(i.Constants.Urls.userFlightingEndpoint,i.Constants.Urls.QueryParams.clipperId,e);p.Http.get(o).then(function(e){t({request:e,parsedResponse:e.responseText})},function(e){n(e)})})};return new Promise(function(e,o){t.clipperData.getFreshValue(d.ClipperStorageKeys.flightingInfo,n,r.Experiments.updateIntervalForFlights).then(function(t){var n=t.data.Features?t.data.Features:[];e(n)},function(e){o(e)})})},e.prototype.getLastSeenVersion=function(){var e=this.clipperData.getValue(d.ClipperStorageKeys.lastSeenVersion);return e?new f.Version(e):void 0},e.prototype.getNewUpdates=function(e,t){var n=this;return new Promise(function(o,r){var s=n.clipperData.getValue(d.ClipperStorageKeys.displayLanguageOverride),l=s||navigator.language||navigator.userLanguage,c=a.Utils.addUrlQueryValue(i.Constants.Urls.changelogUrl,i.Constants.Urls.QueryParams.changelogLocale,l);p.Http.get(c).then(function(n){try{for(var i=JSON.parse(n.responseText),a=void 0,s=0;s<i.length;s++)if(i[s].schemaVersion===m.ChangeLog.schemaVersionSupported){a=i[s].updates;break}if(!a)throw new Error("No matching schemas were found.");var l=h.ChangeLogHelper.getUpdatesBetweenVersions(a,e,t);o(l)}catch(e){r(e)}},function(e){r(e)})})},e.prototype.getOrCreateWorkerForTab=function(e,t){var n=t(e),o=this.getExistingWorkerForTab(n);return o||(o=this.createWorker(e),this.addWorker(o)),o},e.generateClipperId=function(){var e="ON";return e+"-"+a.Utils.generateGuid()},e.prototype.initializeUserFlighting=function(){var e=this,t=new g.Event.PromiseEvent(g.Event.Label.GetFlightingAssignments);this.getFlightingAssignments(this.clientInfo.get().clipperId).then(function(t){e.updateClientInfoWithFlightInformation(t)},function(n){e.updateClientInfoWithFlightInformation([]),t.setStatus(g.Status.Failed),t.setFailureInfo(n)}).then(function(){e.logger.logEvent(t)})},e.prototype.shouldShowTooltip=function(e,t){var n=this.checkIfTabMatchesATooltipType(e,t);if(n&&this.tooltip.tooltipDelayIsOver(n,Date.now()))return n},e.prototype.shouldShowVideoTooltip=function(e){return!(!this.checkIfTabIsAVideoDomain(e)||!this.tooltip.tooltipDelayIsOver(s.TooltipType.Video,Date.now()))},e.prototype.showTooltip=function(e,t){var n=this,o=this.getOrCreateWorkerForTab(e,this.getIdFromTab),i=new g.Event.BaseEvent(g.Event.Label.TooltipImpression);i.setCustomProperty(g.PropertyName.Custom.TooltipType,s.TooltipType[t]),i.setCustomProperty(g.PropertyName.Custom.LastSeenTooltipTime,this.tooltip.getTooltipInformation(d.ClipperStorageKeys.lastSeenTooltipTimeBase,t)),i.setCustomProperty(g.PropertyName.Custom.NumTimesTooltipHasBeenSeen,this.tooltip.getTooltipInformation(d.ClipperStorageKeys.numTimesTooltipHasBeenSeenBase,t)),o.invokeTooltip(t).then(function(e){if(e){n.tooltip.setTooltipInformation(d.ClipperStorageKeys.lastSeenTooltipTimeBase,t,Date.now().toString());var r=d.ClipperStorageKeys.numTimesTooltipHasBeenSeenBase,a=n.tooltip.getTooltipInformation(r,t)+1;n.tooltip.setTooltipInformation(d.ClipperStorageKeys.numTimesTooltipHasBeenSeenBase,t,a.toString())}i.setCustomProperty(g.PropertyName.Custom.FeatureEnabled,e),o.getLogger().logEvent(i)})},e.prototype.shouldShowWhatsNewTooltip=function(t,n,o){return this.checkIfTabIsOnWhitelistedUrl(t)&&e.shouldCheckForMajorUpdates(n,o)},e.prototype.showWhatsNewTooltip=function(e,t,n){var i=this;this.getNewUpdates(t,n).then(function(t){var n=h.ChangeLogHelper.filterUpdatesThatDontApplyToBrowser(t,o.ClientType[i.clientInfo.get().clipperType]);if(n&&n.length>0){var r=i.getOrCreateWorkerForTab(e,i.getIdFromTab);r.invokeWhatsNewTooltip(n).then(function(e){if(e){var t=new g.Event.BaseEvent(g.Event.Label.WhatsNewImpression);t.setCustomProperty(g.PropertyName.Custom.FeatureEnabled,e),r.getLogger().logEvent(t),i.updateLastSeenVersionInStorageToCurrent()}})}else i.updateLastSeenVersionInStorageToCurrent()},function(e){g.ErrorUtils.sendFailureLogRequest({label:g.Failure.Label.GetChangeLog,properties:{failureType:g.Failure.Type.Unexpected,failureInfo:{error:e},failureId:"GetChangeLog",stackTrace:e},clientInfo:i.clientInfo})})},e.prototype.listenForOpportunityToShowPageNavTooltip=function(){var t=this;this.addPageNavListener(function(n){var o;try{o=t.getLastSeenVersion()}catch(e){return void t.updateLastSeenVersionInStorageToCurrent()}var i=new f.Version(e.getExtensionVersion()),r=[s.TooltipType.Pdf,s.TooltipType.Product,s.TooltipType.Recipe],a=t.shouldShowTooltip(n,r);return a?void t.showTooltip(n,a):t.shouldShowVideoTooltip(n)?void t.showTooltip(n,s.TooltipType.Video):t.shouldShowWhatsNewTooltip(n,o,i)?void t.showWhatsNewTooltip(n,o,i):void 0})},e.prototype.setUnhandledExceptionLogging=function(){var e=this,t=window.onerror;window.onerror=function(n,o,i,r,a){var s=a?g.Failure.getStackTrace(a):"[unknown stacktrace]";g.ErrorUtils.sendFailureLogRequest({label:g.Failure.Label.UnhandledExceptionThrown,properties:{failureType:g.Failure.Type.Unexpected,failureInfo:{error:JSON.stringify({error:a.toString(),message:n,lineno:i,colno:r})},failureId:"ExtensionBase",stackTrace:s},clientInfo:e.clientInfo}),t&&t(n,o,i,r,a)}},e.prototype.updateClientInfoWithFlightInformation=function(e){this.clientInfo.set({clipperType:this.clientInfo.get().clipperType,clipperVersion:this.clientInfo.get().clipperVersion,clipperId:this.clientInfo.get().clipperId,flightingInfo:e})},e.prototype.updateLastSeenVersionInStorageToCurrent=function(){this.clipperData.setValue(d.ClipperStorageKeys.lastSeenVersion,e.getExtensionVersion())},e.version="3.2.8",e}();n.ExtensionBase=v},{"../clientType":1,"../clipperUI/tooltipType":53,"../communicator/smartValue":58,"../constants":59,"../experiments":71,"../http/http":84,"../localization/localization":85,"../localization/localizationHelper":86,"../logging/log":88,"../storage/clipperStorageKeys":107,"../utils":111,"../versioning/changeLog":112,"../versioning/changeLogHelper":113,"../versioning/version":114,"./authenticationHelper":72,"./tooltipHelper":79,"./workerPassthroughLogger":80}],76:[function(e,t,n){"use strict";var o=e("../clientType"),i=e("../constants"),r=e("../polyfills"),a=e("../userInfo"),s=e("../settings"),l=e("../utils"),p=e("../clipperUI/tooltipType"),c=e("../communicator/communicator"),u=e("../communicator/smartValue"),g=e("../http/clipperCachedHttp"),d=e("../localization/localizationHelper"),m=e("../logging/log"),h=e("../logging/logHelpers"),f=e("../storage/clipperStorageKeys"),S=e("./invokeSource"),C=e("./invokeOptions"),y=function(){function e(e,t,n,o,a){this.clipperFunnelAlreadyLogged=!1,r.Polyfills.init(),this.onUnloading=function(){},this.uiCommunicator=new c.Communicator(o(),i.Constants.CommunicationChannels.extensionAndUi),this.pageNavUiCommunicator=new c.Communicator(o(),i.Constants.CommunicationChannels.extensionAndPageNavUi),this.debugLoggingInjectCommunicator=new c.Communicator(a(),i.Constants.CommunicationChannels.debugLoggingInjectedAndExtension),this.injectCommunicator=new c.Communicator(a(),i.Constants.CommunicationChannels.injectedAndExtension),this.pageNavInjectCommunicator=new c.Communicator(a(),i.Constants.CommunicationChannels.pageNavInjectedAndExtension),this.sessionId=new u.SmartValue,this.logger=LogManager.createExtLogger(this.sessionId,h.LogHelpers.isConsoleOutputEnabled()?this.debugLoggingInjectCommunicator:void 0),this.logger.logSessionStart(),this.clipperData=n,this.clipperData.setLogger(this.logger),this.auth=t,this.clientInfo=e,this.logDeviceIdMapEvent(),this.initializeCommunicators(),this.initializeContextProperties()}return e.prototype.initializeContextProperties=function(){var e=this,t=this.clientInfo.get();if(this.logger.setContextProperty(m.Context.Custom.AppInfoId,s.Settings.getSetting("App_Id")),this.logger.setContextProperty(m.Context.Custom.UserInfoId,void 0),this.logger.setContextProperty(m.Context.Custom.AuthType,"None"),this.logger.setContextProperty(m.Context.Custom.AppInfoVersion,t.clipperVersion),this.logger.setContextProperty(m.Context.Custom.DeviceInfoId,t.clipperId),this.logger.setContextProperty(m.Context.Custom.ClipperType,o.ClientType[t.clipperType]),t.flightingInfo)this.logger.setContextProperty(m.Context.Custom.FlightInfo,t.flightingInfo.join(","));else{var n=function(t){t.flightingInfo&&(e.clientInfo.unsubscribe(n),e.logger.setContextProperty(m.Context.Custom.FlightInfo,t.flightingInfo.join(",")))}.bind(this);this.clientInfo.subscribe(n,{callOnSubscribe:!1})}},e.prototype.getUniqueId=function(){return this.tabId},e.prototype.closeAllFramesAndInvokeClipper=function(e,t){this.pageNavInjectCommunicator.callRemoteFunction(i.Constants.FunctionKeys.closePageNavTooltip),this.invokeClipper(e,t)},e.prototype.getLogger=function(){return this.logger},e.prototype.invokeClipper=function(e,t){var n=this,o={invokeDataForMode:t?t.invokeDataForMode:void 0,invokeMode:t?t.invokeMode:C.InvokeMode.Default};this.sendInvokeOptionsToInject(o),this.invokeClipperBrowserSpecific().then(function(t){t&&!n.clipperFunnelAlreadyLogged&&(n.logger.logUserFunnel(m.Funnel.Label.Invoke),n.clipperFunnelAlreadyLogged=!0),n.logClipperInvoke(e,o)})},e.prototype.invokeWhatsNewTooltip=function(e){var t=this;return new Promise(function(n){var o=new m.Event.PromiseEvent(m.Event.Label.InvokeWhatsNew);t.registerLocalizedStringsForPageNav().then(function(i){i?(t.registerWhatsNewCommunicatorFunctions(e),t.invokeWhatsNewTooltipBrowserSpecific(e).then(function(e){e||(o.setStatus(m.Status.Failed),o.setFailureInfo({error:"invoking the What's New experience failed"})),t.logger.logEvent(o),n(e)})):(o.setStatus(m.Status.Failed),o.setFailureInfo({error:"getLocalizedStringsForBrowser returned undefined/null"}),t.logger.logEvent(o),n(!1))})})},e.prototype.invokeTooltip=function(e){var t=this;return new Promise(function(n){var o=new m.Event.PromiseEvent(m.Event.Label.InvokeTooltip);o.setCustomProperty(m.PropertyName.Custom.TooltipType,p.TooltipType[e]),t.registerLocalizedStringsForPageNav().then(function(i){i?(t.registerTooltipCommunicatorFunctions(e),t.invokeTooltipBrowserSpecific(e).then(function(e){t.logger.logEvent(o),n(e)})):(o.setStatus(m.Status.Failed),o.setFailureInfo({error:"getLocalizedStringsForBrowser returned undefined/null"}),t.logger.logEvent(o),n(!1))})})},e.prototype.setOnUnloading=function(e){this.onUnloading=e},e.prototype.destroy=function(){this.logger.logSessionEnd(m.Session.EndTrigger.Unload)},e.prototype.getLocalizedStrings=function(e,t){var n=this;this.logger.setContextProperty(m.Context.Custom.BrowserLanguage,e);var o=this.clipperData.getValue(f.ClipperStorageKeys.locale),i=!o||o!==e,r=new m.Event.BaseEvent(m.Event.Label.GetLocale);r.setCustomProperty(m.PropertyName.Custom.StoredLocaleDifferentThanRequested,i),this.logger.logEvent(r);var a=function(){return d.LocalizationHelper.makeLocStringsFetchRequest(e)},s=i?0:g.ClipperCachedHttp.getDefaultExpiry(),l=new m.Event.PromiseEvent(m.Event.Label.GetLocalizedStrings);l.setCustomProperty(m.PropertyName.Custom.ForceRetrieveFreshLocStrings,i),this.clipperData.getFreshValue(f.ClipperStorageKeys.locStrings,a,s).then(function(o){n.clipperData.setValue(f.ClipperStorageKeys.locale,e),t&&t(o?o.data:void 0)},function(e){l.setStatus(m.Status.Failed),l.setFailureInfo(e),t&&t(void 0)}).then(function(){n.logger.logEvent(l)})},e.prototype.getLocalizedStringsForBrowser=function(e){var t=this.clipperData.getValue(f.ClipperStorageKeys.displayLanguageOverride),n=t||navigator.language||navigator.userLanguage;this.getLocalizedStrings(n,e)},e.prototype.getUserSessionIdQueryParamValue=function(){var e=this.logger.getUserSessionId();return e?e:this.clientInfo.get().clipperId},e.prototype.invokeDebugLoggingIfEnabled=function(){return h.LogHelpers.isConsoleOutputEnabled()?this.invokeDebugLoggingBrowserSpecific():Promise.resolve(!1)},e.prototype.launchPopupAndWaitForClose=function(e){var t=this;return new Promise(function(n,o){var r,a=l.Utils.openPopupWindow(e),s=function(e){if(e.source===a){var n=void 0;try{n=JSON.parse(e.data)}catch(n){t.logger.logJsonParseUnexpected(e.data)}n&&(n[i.Constants.Urls.QueryParams.error]||n[i.Constants.Urls.QueryParams.errorDescription])&&(r={correlationId:n[i.Constants.Urls.QueryParams.correlationId],error:n[i.Constants.Urls.QueryParams.error],errorDescription:n[i.Constants.Urls.QueryParams.errorDescription]})}};window.addEventListener("message",s);var p=setInterval(function(){a&&!a.closed||(clearInterval(p),window.removeEventListener("message",s),r?o(r):n(!0))},100)})},e.prototype.logClipperInvoke=function(e,t){var n=new m.Event.BaseEvent(m.Event.Label.InvokeClipper);n.setCustomProperty(m.PropertyName.Custom.InvokeSource,S.InvokeSource[e.invokeSource]),n.setCustomProperty(m.PropertyName.Custom.InvokeMode,C.InvokeMode[t.invokeMode]),this.logger.logEvent(n)},e.prototype.registerTooltipToRenderInPageNav=function(e,t){this.pageNavUiCommunicator.registerFunction(i.Constants.FunctionKeys.getTooltipToRenderInPageNav,function(){return Promise.resolve(e)}),this.pageNavUiCommunicator.registerFunction(i.Constants.FunctionKeys.getPageNavTooltipProps,function(){return Promise.resolve(t)})},e.prototype.registerWhatsNewCommunicatorFunctions=function(e){this.registerTooltipToRenderInPageNav(p.TooltipType.WhatsNew,{updates:e})},e.prototype.registerTooltipCommunicatorFunctions=function(e){this.registerTooltipToRenderInPageNav(e)},e.prototype.sendInvokeOptionsToInject=function(e){this.injectCommunicator.callRemoteFunction(i.Constants.FunctionKeys.setInvokeOptions,{param:e})},e.prototype.setUpNoOpTrackers=function(e){var t=m.ErrorUtils.setNoOpTrackerRequestTimeout({label:m.NoOp.Label.InitializeCommunicator,channel:i.Constants.CommunicationChannels.injectedAndExtension,clientInfo:this.clientInfo,url:e},!0);this.injectCommunicator.callRemoteFunction(i.Constants.FunctionKeys.noOpTracker,{param:(new Date).getTime(),callback:function(){clearTimeout(t)}});var n=m.ErrorUtils.setNoOpTrackerRequestTimeout({label:m.NoOp.Label.InitializeCommunicator,channel:i.Constants.CommunicationChannels.extensionAndUi,clientInfo:this.clientInfo,url:e},!0);this.uiCommunicator.callRemoteFunction(i.Constants.FunctionKeys.noOpTracker,{param:(new Date).getTime(),callback:function(){clearTimeout(n)}})},e.prototype.doSignOutActionInFrontEnd=function(e){var t=this.getUserSessionIdQueryParamValue(),n=l.Utils.generateSignOutUrl(this.clientInfo.get().clipperId,t,a.AuthType[e]);this.uiCommunicator.callRemoteFunction(i.Constants.FunctionKeys.createHiddenIFrame,{param:n})},e.prototype.initializeCommunicators=function(){this.initializeDebugLoggingCommunicators(),this.initializeClipperCommunicators(),this.initializePageNavCommunicators()},e.prototype.initializeClipperCommunicators=function(){this.initializeClipperUiCommunicator(),this.initializeClipperInjectCommunicator()},e.prototype.initializeClipperUiCommunicator=function(){var e=this;this.uiCommunicator.broadcastAcrossCommunicator(this.auth.user,i.Constants.SmartValueKeys.user),this.uiCommunicator.broadcastAcrossCommunicator(this.clientInfo,i.Constants.SmartValueKeys.clientInfo),this.uiCommunicator.broadcastAcrossCommunicator(this.sessionId,i.Constants.SmartValueKeys.sessionId),this.uiCommunicator.registerFunction(i.Constants.FunctionKeys.clipperStrings,function(){return new Promise(function(t){e.getLocalizedStringsForBrowser(function(e){t(e)})})}),this.uiCommunicator.registerFunction(i.Constants.FunctionKeys.getStorageValue,function(t){return new Promise(function(n){var o=e.clipperData.getValue(t);n(o)})}),this.uiCommunicator.registerFunction(i.Constants.FunctionKeys.getMultipleStorageValues,function(t){return new Promise(function(n){for(var o={},i=0,r=t;i<r.length;i++){var a=r[i];o[a]=e.clipperData.getValue(a)}n(o)})}),this.uiCommunicator.registerFunction(i.Constants.FunctionKeys.setStorageValue,function(t){e.clipperData.setValue(t.key,t.value)}),this.uiCommunicator.registerFunction(i.Constants.FunctionKeys.getInitialUser,function(){return e.auth.updateUserInfoData(e.clientInfo.get().clipperId,a.UpdateReason.InitialRetrieval)}),this.uiCommunicator.registerFunction(i.Constants.FunctionKeys.signInUser,function(t){return new Promise(function(n,o){e.doSignInAction(t).then(function(t){if(t)e.auth.updateUserInfoData(e.clientInfo.get().clipperId,a.UpdateReason.SignInAttempt).then(function(e){n(e)});else{var o={updateReason:a.UpdateReason.SignInCancel};e.auth.user.set(o),n(o)}},function(t){e.auth.user.set({updateReason:a.UpdateReason.SignInAttempt}),o(t)})})}),this.uiCommunicator.registerFunction(i.Constants.FunctionKeys.signOutUser,function(t){e.clientInfo.get().clipperType===o.ClientType.EdgeExtension?e.doSignOutActionInFrontEnd(t):e.doSignOutAction(t),e.auth.user.set({updateReason:a.UpdateReason.SignOutAction}),e.clipperData.setValue(f.ClipperStorageKeys.userInformation,void 0),e.clipperData.setValue(f.ClipperStorageKeys.currentSelectedSection,void 0),e.clipperData.setValue(f.ClipperStorageKeys.cachedNotebooks,void 0)}),this.uiCommunicator.registerFunction(i.Constants.FunctionKeys.telemetry,function(t){m.parseAndLogDataPackage(t,e.logger)}),this.uiCommunicator.registerFunction(i.Constants.FunctionKeys.ensureFreshUserBeforeClip,function(){return e.auth.updateUserInfoData(e.clientInfo.get().clipperId,a.UpdateReason.TokenRefreshForPendingClip)}),this.uiCommunicator.registerFunction(i.Constants.FunctionKeys.takeTabScreenshot,function(){return e.takeTabScreenshot()}),this.uiCommunicator.setErrorHandler(function(t){m.ErrorUtils.handleCommunicatorError(i.Constants.CommunicationChannels.extensionAndUi,t,e.clientInfo)})},e.prototype.initializeClipperInjectCommunicator=function(){var e=this;this.injectCommunicator.broadcastAcrossCommunicator(this.clientInfo,i.Constants.SmartValueKeys.clientInfo),this.injectCommunicator.registerFunction(i.Constants.FunctionKeys.unloadHandler,function(){e.tearDownCommunicators(),e.onUnloading()}),this.injectCommunicator.registerFunction(i.Constants.FunctionKeys.setStorageValue,function(t){e.clipperData.setValue(t.key,t.value)}),this.injectCommunicator.setErrorHandler(function(t){m.ErrorUtils.handleCommunicatorError(i.Constants.CommunicationChannels.injectedAndExtension,t,e.clientInfo)})},e.prototype.initializeDebugLoggingCommunicators=function(){var e=this;this.debugLoggingInjectCommunicator.registerFunction(i.Constants.FunctionKeys.unloadHandler,function(){e.tearDownCommunicators(),e.onUnloading()})},e.prototype.initializePageNavCommunicators=function(){this.initializePageNavUiCommunicator(),this.initializePageNavInjectCommunicator()},e.prototype.initializePageNavUiCommunicator=function(){var e=this;this.pageNavUiCommunicator.registerFunction(i.Constants.FunctionKeys.telemetry,function(t){m.parseAndLogDataPackage(t,e.logger)}),this.pageNavUiCommunicator.registerFunction(i.Constants.FunctionKeys.invokeClipperFromPageNav,function(t){e.closeAllFramesAndInvokeClipper({invokeSource:t},{invokeMode:C.InvokeMode.Default})})},e.prototype.initializePageNavInjectCommunicator=function(){var e=this;this.pageNavInjectCommunicator.registerFunction(i.Constants.FunctionKeys.telemetry,function(t){m.parseAndLogDataPackage(t,e.logger)}),this.pageNavInjectCommunicator.registerFunction(i.Constants.FunctionKeys.unloadHandler,function(){e.tearDownCommunicators(),e.onUnloading()})},e.prototype.registerLocalizedStringsForPageNav=function(){var e=this;return new Promise(function(t){e.getLocalizedStringsForBrowser(function(n){n&&e.pageNavUiCommunicator.registerFunction(i.Constants.FunctionKeys.clipperStringsFrontLoaded,function(){return Promise.resolve(n)}),t(!!n)})})},e.prototype.tearDownCommunicators=function(){this.uiCommunicator.tearDown(),this.pageNavUiCommunicator.tearDown(),this.injectCommunicator.tearDown(),this.pageNavInjectCommunicator.tearDown()},e.prototype.logDeviceIdMapEvent=function(){var e=this.clientInfo.get().clipperId,t=l.Utils.readCookie("MicrosoftApplicationsTelemetryDeviceId");if(t!==e){var n=new m.Event.BaseEvent(m.Event.Label.DeviceIdMap);n.setCustomProperty(m.PropertyName.Custom.DeviceIdInStorage,e),n.setCustomProperty(m.PropertyName.Custom.DeviceIdInCookie,t),this.logger.logEvent(n)}},e}();n.ExtensionWorkerBase=y},{"../clientType":1,"../clipperUI/tooltipType":53,"../communicator/communicator":54,"../communicator/smartValue":58,"../constants":59,"../http/clipperCachedHttp":83,"../localization/localizationHelper":86,"../logging/log":88,"../logging/logHelpers":89,"../polyfills":103,"../settings":104,"../storage/clipperStorageKeys":107,"../userInfo":110,"../utils":111,"./invokeOptions":77,"./invokeSource":78}],77:[function(e,t,n){"use strict";!function(e){e[e.ContextImage=0]="ContextImage",e[e.ContextTextSelection=1]="ContextTextSelection",e[e.Default=2]="Default"}(n.InvokeMode||(n.InvokeMode={}));n.InvokeMode},{}],78:[function(e,t,n){"use strict";!function(e){e[e.Bookmarklet=0]="Bookmarklet",e[e.ContextMenu=1]="ContextMenu",e[e.ExtensionButton=2]="ExtensionButton",e[e.WhatsNewTooltip=3]="WhatsNewTooltip",e[e.PdfTooltip=4]="PdfTooltip",e[e.ProductTooltip=5]="ProductTooltip",e[e.RecipeTooltip=6]="RecipeTooltip",e[e.VideoTooltip=7]="VideoTooltip"}(n.InvokeSource||(n.InvokeSource={}));n.InvokeSource},{}],79:[function(e,t,n){"use strict";var o=e("../constants"),i=e("../utils"),r=e("../clipperUI/tooltipType"),a=e("../storage/clipperStorageKeys"),s=function(){function e(e){this.storage=e,this.validTypes=[r.TooltipType.Pdf,r.TooltipType.Product,r.TooltipType.Recipe,r.TooltipType.Video]}return e.prototype.getTooltipInformation=function(t,n){if(i.Utils.isNullOrUndefined(t)||i.Utils.isNullOrUndefined(n))throw new Error("Invalid argument passed to getTooltipInformation");var o=e.getStorageKeyForTooltip(t,n),r=this.storage.getValue(o),a=parseInt(r,10);return isNaN(a)?0:a},e.prototype.setTooltipInformation=function(t,n,o){if(i.Utils.isNullOrUndefined(t)||i.Utils.isNullOrUndefined(n))throw new Error("Invalid argument passed to setTooltipInformation");var r=e.getStorageKeyForTooltip(t,n);this.storage.setValue(r,o)},e.prototype.tooltipDelayIsOver=function(e,t){if(i.Utils.isNullOrUndefined(e)||i.Utils.isNullOrUndefined(t))throw new Error("Invalid argument passed to tooltipDelayIsOver");var n=this.getTooltipInformation(a.ClipperStorageKeys.lastClippedTooltipTimeBase,e);if(0!==n)return!1;var r=this.getTooltipInformation(a.ClipperStorageKeys.numTimesTooltipHasBeenSeenBase,e);if(r>=o.Constants.Settings.maximumNumberOfTimesToShowTooltips)return!1;this.getTooltipInformation(a.ClipperStorageKeys.lastSeenTooltipTimeBase,e);if(this.tooltipHasBeenSeenInLastTimePeriod(e,t,o.Constants.Settings.timeBetweenSameTooltip))return!1;var s=this.validTypes.indexOf(e),l=this.validTypes.slice();return l.splice(s,1),!this.hasAnyTooltipBeenSeenInLastTimePeriod(t,l,o.Constants.Settings.timeBetweenDifferentTooltips)},e.getStorageKeyForTooltip=function(e,t){if(i.Utils.isNullOrUndefined(e)||i.Utils.isNullOrUndefined(t))throw new Error("Invalid argument passed to getStorageKeyForTooltip");return e+r.TooltipType[t]},e.prototype.tooltipHasBeenSeenInLastTimePeriod=function(e,t,n){var o=this.getTooltipInformation(a.ClipperStorageKeys.lastSeenTooltipTimeBase,e);return 0!==o&&t-o<n},e.prototype.hasAnyTooltipBeenSeenInLastTimePeriod=function(e,t,n){var o=this;return t.some(function(t){var i=o.tooltipHasBeenSeenInLastTimePeriod(t,e,n);return i})},e}();n.TooltipHelper=s},{"../clipperUI/tooltipType":53,"../constants":59,"../storage/clipperStorageKeys":107,"../utils":111}],80:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../logging/logger"),r=function(e){function t(t){e.call(this),this.workers=t}return o(t,e),t.prototype.logEvent=function(e){for(var t=0,n=this.workers;t<n.length;t++){var o=n[t];o.getLogger().logEvent(e)}},t.prototype.pushToStream=function(e,t){for(var n=0,o=this.workers;n<o.length;n++){var i=o[n];i.getLogger().pushToStream(e,t)}},t.prototype.logFailure=function(e,t,n,o){for(var i=0,r=this.workers;i<r.length;i++){var a=r[i];a.getLogger().logFailure(e,t,n,o)}},t.prototype.logUserFunnel=function(e){for(var t=0,n=this.workers;t<n.length;t++){var o=n[t];o.getLogger().logUserFunnel(e)}},t.prototype.logSessionStart=function(){for(var e=0,t=this.workers;e<t.length;e++){var n=t[e];n.getLogger().logSessionStart()}},t.prototype.logSessionEnd=function(e){for(var t=0,n=this.workers;t<n.length;t++){var o=n[t];o.getLogger().logSessionEnd(e)}},t.prototype.logTrace=function(e,t,n){for(var o=0,i=this.workers;o<i.length;o++){var r=i[o];r.getLogger().logTrace(e,t,n)}},t.prototype.logClickEvent=function(e){for(var t=0,n=this.workers;t<n.length;t++){var o=n[t];o.getLogger().logClickEvent(e)}},t.prototype.setContextProperty=function(e,t){for(var n=0,o=this.workers;n<o.length;n++){var i=o[n];i.getLogger().setContextProperty(e,t)}},t}(i.Logger);n.WorkerPassthroughLogger=r},{"../logging/logger":90}],81:[function(e,t,n){"use strict";var o=function(){function e(){}return e.reconstructInstance=function(t,n){return e.tearDownCurrentInstance(),e.instance=new TextHighlighter(t,n),e.instance},e.tearDownCurrentInstance=function(){e.instance&&e.instance.disable()},e}();n.Highlighter=o},{}],82:[function(e,t,n){"use strict";var o=function(){function e(e){this.cache=e}return e.prototype.getFreshValue=function(t,n,o){var i=this;if(!t)throw new Error("key must be a non-empty string, but was: "+t);if(!n)throw new Error("getRemoteValue must be non-undefined");return o<0&&(o=0),new Promise(function(r,a){var s=i.cache.getValue(t),l=!!s;if(l){var p=void 0;try{p=JSON.parse(s)}catch(e){a({error:e})}var c=e.valueHasExpired(p,o);if(!c)return void r(p)}i.getAndCacheRemoteValue(t,n).then(function(e){r(e)},function(e){a(e)})})},e.prototype.getAndCacheRemoteValue=function(e,t){var n=this;if(!e)throw new Error("key must be a non-empty string, but was: "+e);if(!t)throw new Error("getRemoteValue must be non-undefined");return new Promise(function(o,i){t().then(function(t){var i=n.setTimeStampedValue(e,t.parsedResponse);i||n.cache.removeKey(e),o(i)},function(t){n.cache.removeKey(e),i(t)})})},e.valueHasExpired=function(e,t){var n=e&&e.lastUpdated?e.lastUpdated:0;return Date.now()-n>=t},e.prototype.setTimeStampedValue=function(e,t){if(!e)throw new Error("key must be a non-empty string, but was: "+e);if(t){var n;try{n=JSON.parse(t)}catch(e){return}var o={data:n,lastUpdated:Date.now()};return this.cache.setValue(e,JSON.stringify(o)),o}},e}();n.CachedHttp=o},{}],83:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../constants"),r=e("../logging/log"),a=e("./cachedHttp"),s=function(e){function t(t,n){e.call(this,t),this.logger=n}return o(t,e),t.prototype.setLogger=function(e){this.logger=e},t.getDefaultExpiry=function(){return t.defaultExpiry},t.prototype.getFreshValue=function(n,o,i){if(void 0===i&&(i=t.defaultExpiry),!n)return this.logger.logFailure(r.Failure.Label.InvalidArgument,r.Failure.Type.Unexpected,{error:"getFreshValue key parameter should be passed a non-empty string"},""+n),Promise.resolve(void 0);if(!o)return this.logger.logFailure(r.Failure.Label.InvalidArgument,r.Failure.Type.Unexpected,{error:"getFreshValue getRemoteValue parameter should be passed a non-undefined function"},""+o),Promise.resolve(void 0);i<0&&(this.logger.logFailure(r.Failure.Label.InvalidArgument,r.Failure.Type.Unexpected,{error:"getFreshValue updateInterval parameter should be passed a number >= 0"},""+i),i=0);var a=this.addLoggingToGetResponseAsync(n,o,i);return e.prototype.getFreshValue.call(this,n,a,i)},t.prototype.addLoggingToGetResponseAsync=function(e,n,o){var i=this;return function(){var a=new r.Event.PromiseEvent(r.Event.Label.FetchNonLocalData);return a.setCustomProperty(r.PropertyName.Custom.Key,e),a.setCustomProperty(r.PropertyName.Custom.UpdateInterval,o),new Promise(function(e,o){n().then(function(n){n.request&&t.addCorrelationIdToLogEvent(a,n.request),e(n)},function(e){a.setStatus(r.Status.Failed),a.setFailureInfo(e),o(e)}).then(function(){i.logger.logEvent(a)})})}},t.addCorrelationIdToLogEvent=function(e,t){var n=t.getResponseHeader(i.Constants.HeaderValues.correlationId);n&&e.setCustomProperty(r.PropertyName.Custom.CorrelationId,n)},t.defaultExpiry=432e5,t}(a.CachedHttp);n.ClipperCachedHttp=s},{"../constants":59,"../logging/log":88,"./cachedHttp":82}],84:[function(e,t,n){"use strict";var o=e("../utils"),i=function(){function e(){}return e.get=function(t,n,o,i){return void 0===o&&(o=e.defaultTimeout),void 0===i&&(i=[200]),e.createAndSendRequest("GET",t,n,i,o)},e.post=function(t,n,i,r,a){if(void 0===r&&(r=[200]),void 0===a&&(a=e.defaultTimeout),o.Utils.isNullOrUndefined(n))throw new Error("data must be a non-undefined object, but was: "+n);return e.createAndSendRequest("POST",t,i,r,a,n)},e.createAndSendRequest=function(t,n,o,i,r,a){if(void 0===i&&(i=[200]),void 0===r&&(r=e.defaultTimeout),!n)throw new Error("url must be a non-empty string, but was: "+n);return new Promise(function(s,l){var p=new XMLHttpRequest;p.open(t,n),p.onload=function(){i.indexOf(p.status)>-1?s(p):l(OneNoteApi.ErrorUtils.createRequestErrorObject(p,OneNoteApi.RequestErrorType.UNEXPECTED_RESPONSE_STATUS))},p.onerror=function(){l(OneNoteApi.ErrorUtils.createRequestErrorObject(p,OneNoteApi.RequestErrorType.NETWORK_ERROR))},p.ontimeout=function(){l(OneNoteApi.ErrorUtils.createRequestErrorObject(p,OneNoteApi.RequestErrorType.REQUEST_TIMED_OUT))},e.setHeaders(p,o),p.timeout=r,p.send(a)})},e.setHeaders=function(e,t){if(t)for(var n in t)e.setRequestHeader(n,t[n])},e.defaultTimeout=3e4,
e}();n.Http=i},{"../utils":111}],85:[function(e,t,n){"use strict";var o;!function(t){function n(e){if(!e)throw new Error("stringId must be a non-empty string, but was: "+e);if(s){var t=s[e];if(t)return t}var n=c[e];if(n)return n;throw new Error("getLocalizedString could not find a localized or fallback string: "+e)}function o(e){s=e}function i(e){return"font-family: "+r(e)+";"}function r(e){if(p[e])return p[e];var t="WebClipper.FontFamily."+l[e].toString(),o=n(t);return p[e]=a(o),p[e]}function a(e){if(!e)return"";for(var t=e.split(","),n=0;n<t.length;n++)t[n]=t[n].trim(),t[n].length>0&&t[n].indexOf(" ")>=0&&"'"!==t[n][0]&&"'"!==t[n][t.length-1]&&(t[n]="'"+t[n]+"'");return t.join(",")}!function(e){e[e.Regular=0]="Regular",e[e.Bold=1]="Bold",e[e.Light=2]="Light",e[e.Semibold=3]="Semibold",e[e.Semilight=4]="Semilight"}(t.FontFamily||(t.FontFamily={}));var s,l=t.FontFamily,p={},c=e("../../strings.json");t.getLocalizedString=n,t.setLocalizedStrings=o,t.getFontFamilyAsStyle=i,t.getFontFamily=r,t.formatFontFamily=a}(o=n.Localization||(n.Localization={}))},{"../../strings.json":116}],86:[function(e,t,n){"use strict";var o=e("../constants"),i=e("../utils"),r=function(){function e(){}return e.makeLocStringsFetchRequest=function(e){var t=i.Utils.addUrlQueryValue(o.Constants.Urls.localizedStringsUrlBase,"locale",e);return new Promise(function(e,n){var o=new XMLHttpRequest;o.open("GET",t),o.timeout=3e4,o.onreadystatechange=function(){if(4===o.readyState){var t=o.status;200===t?e({parsedResponse:o.responseText,request:o}):n(0===t?OneNoteApi.ErrorUtils.createRequestErrorObject(o,OneNoteApi.RequestErrorType.NETWORK_ERROR):OneNoteApi.ErrorUtils.createRequestErrorObject(o,OneNoteApi.RequestErrorType.UNEXPECTED_RESPONSE_STATUS))}},o.ontimeout=function(){n(OneNoteApi.ErrorUtils.createRequestErrorObject(o,OneNoteApi.RequestErrorType.REQUEST_TIMED_OUT))},o.send()})},e}();n.LocalizationHelper=r},{"../constants":59,"../utils":111}],87:[function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=e("../constants"),r=e("./log"),a=e("./logger"),s=function(e){function t(t){e.call(this),this.communicator=t}return o(t,e),t.prototype.logEvent=function(e){e.timerWasStopped()||e.stopTimer(),this.sendDataPackage(r.LogMethods.logEvent,[e.getEventCategory(),e.getEventData()])},t.prototype.logFailure=function(e,t,n,o){this.sendDataPackage(r.LogMethods.logFailure,arguments)},t.prototype.logUserFunnel=function(e){this.sendDataPackage(r.LogMethods.logFunnel,arguments)},t.prototype.logSessionStart=function(){this.sendDataPackage(r.LogMethods.logSessionStart,arguments)},t.prototype.logSessionEnd=function(e){this.sendDataPackage(r.LogMethods.logSessionEnd,arguments)},t.prototype.logTrace=function(e,t,n){n?this.sendDataPackage(r.LogMethods.logTrace,[e,t,n]):this.sendDataPackage(r.LogMethods.logTrace,[e,t])},t.prototype.pushToStream=function(e,t){this.sendDataPackage(r.LogMethods.pushToStream,arguments)},t.prototype.logClickEvent=function(e){this.sendDataPackage(r.LogMethods.logClickEvent,arguments)},t.prototype.setContextProperty=function(e,t){this.sendDataPackage(r.LogMethods.setContextProperty,arguments)},t.prototype.sendDataPackage=function(e,t){var n={methodName:e,methodArgs:Object.keys(t).map(function(e){return t[e]})};this.communicator.callRemoteFunction(i.Constants.FunctionKeys.telemetry,{param:n})},t}(a.Logger);n.CommunicatorLoggerPure=s},{"../constants":59,"./log":88,"./logger":90}],88:[function(e,t,n){"use strict";function o(e,t){switch(e.methodName){case r.LogMethods.logEvent:var n=e.methodArgs[0],o=e.methodArgs[1];t.logEvent.apply(t,[i.Event.createEvent(n,o)]);break;case r.LogMethods.logFailure:t.logFailure.apply(t,e.methodArgs);break;case r.LogMethods.pushToStream:t.pushToStream.apply(t,e.methodArgs);break;case r.LogMethods.logFunnel:t.logUserFunnel.apply(t,e.methodArgs);break;case r.LogMethods.logSessionStart:t.logSessionStart.apply(t,e.methodArgs);break;case r.LogMethods.logSessionEnd:t.logSessionEnd.apply(t,e.methodArgs);break;case r.LogMethods.logClickEvent:t.logClickEvent.apply(t,e.methodArgs);break;case r.LogMethods.setContextProperty:t.setContextProperty.apply(t,e.methodArgs);break;case r.LogMethods.logTrace:default:t.logTrace.apply(t,e.methodArgs)}}var i=e("./submodules/event"),r=e("./submodules/logMethods");n.contextPropertyNameRegex=/^[a-zA-Z0-9](([a-zA-Z0-9|_]){0,98}[a-zA-Z0-9])?$/,n.enableConsoleLogging="enable_console_logging",n.reportData="ReportData",n.unknownValue="unknown",n.parseAndLogDataPackage=o;var a=e("./submodules/click");n.Click=a.Click;var s=e("./submodules/context");n.Context=s.Context;var l=e("./submodules/errorUtils");n.ErrorUtils=l.ErrorUtils;var p=e("./submodules/event");n.Event=p.Event;var c=e("./submodules/failure");n.Failure=c.Failure;var u=e("./submodules/funnel");n.Funnel=u.Funnel;var g=e("./submodules/logMethods");n.LogMethods=g.LogMethods;var d=e("./submodules/noop");n.NoOp=d.NoOp;var m=e("./submodules/propertyName");n.PropertyName=m.PropertyName;var h=e("./submodules/session");n.Session=h.Session;var f=e("./submodules/status");n.Status=f.Status;var S=e("./submodules/trace");n.Trace=S.Trace},{"./submodules/click":91,"./submodules/context":92,"./submodules/errorUtils":93,"./submodules/event":94,"./submodules/failure":95,"./submodules/funnel":96,"./submodules/logMethods":97,"./submodules/noop":98,"./submodules/propertyName":99,"./submodules/session":100,"./submodules/status":101,"./submodules/trace":102}],89:[function(e,t,n){"use strict";var o,i=e("./log");!function(e){function t(e,t){var n={};n[i.PropertyName.Reserved.EventType]=i.reportData,n[i.PropertyName.Reserved.Label]=t;var o=i.PropertyName.Reserved.WebClipper+"."+e;return n[i.PropertyName.Reserved.Category]=o,n[i.PropertyName.Reserved.EventName]=o+"."+t,n}function n(t){if(!t)throw new Error("Button clicked without an ID! Logged with ID "+JSON.stringify(t));var n=e.createBaseEventAsJson(i.Click.category,t);return n}function o(t){t.timerWasStopped()||t.stopTimer();var n=t.getEventCategory(),o=e.createBaseEventAsJson(i.Event.Category[n],t.getLabel());switch(o[i.PropertyName.Reserved.Duration]=t.getDuration(),d(o,t.getCustomProperties()),n){case i.Event.Category.BaseEvent:break;case i.Event.Category.PromiseEvent:r(o,t);break;case i.Event.Category.StreamEvent:a(o,t);break;default:throw new Error("createLogEvent does not specify a case for event category: "+i.Event.Category[n])}return o}function r(e,t){var n=t.getStatus();e[i.PropertyName.Reserved.Status]=n,n===i.Status[i.Status.Failed]&&(e[i.PropertyName.Reserved.FailureInfo]=t.getFailureInfo(),e[i.PropertyName.Reserved.FailureType]=t.getFailureType())}function a(e,t){e[i.PropertyName.Reserved.Stream]=JSON.stringify(t.getEventData().Stream)}function s(t,n){var o=new i.Event.BaseEvent(i.Event.Label.SetContextProperty),r=e.createBaseEventAsJson(i.Event.Category[o.getEventCategory()],o.getLabel()),a=i.Context.toString(t);return r[i.PropertyName.Custom[i.PropertyName.Custom.Key]]=a,r[i.PropertyName.Custom[i.PropertyName.Custom.Value]]=n,r}function l(t,n,o,r){var a=e.createBaseEventAsJson(i.Failure.category,i.Failure.Label[t]);return a[i.PropertyName.Reserved.FailureType]=i.Failure.Type[n],o&&(a[i.PropertyName.Reserved.FailureInfo]=i.ErrorUtils.toString(o)),r&&(a[i.PropertyName.Reserved.Id]=r),a[i.PropertyName.Reserved.StackTrace]=i.Failure.getStackTrace(),a}function p(t){var n=e.createBaseEventAsJson(i.Funnel.category,i.Funnel.Label[t]);return n}function c(){var t=e.createBaseEventAsJson(i.Session.category,i.Session.State[i.Session.State.Started]);return t}function u(t){var n=e.createBaseEventAsJson(i.Session.category,i.Session.State[i.Session.State.Ended]);return n[i.PropertyName.Reserved.Trigger]=i.Session.EndTrigger[t],n}function g(t,n,o){var r=e.createBaseEventAsJson(i.Trace.category,i.Trace.Label[t]);switch(o&&(r[i.PropertyName.Reserved.Message]=o),r[i.PropertyName.Reserved.Level]=i.Trace.Level[n],n){case i.Trace.Level.Warning:r[i.PropertyName.Reserved.StackTrace]=i.Failure.getStackTrace()}return r}function d(e,t){if(e[i.PropertyName.Reserved.Status]===i.Status[i.Status.Failed]&&(e[i.PropertyName.Reserved.StackTrace]=i.Failure.getStackTrace()),t)for(var n in t)if(t.hasOwnProperty(n)){var o=void 0;o="object"==typeof t[n]?JSON.stringify(t[n]):t[n],e[n]=o}}function m(){try{if(localStorage.getItem(i.enableConsoleLogging))return!0}catch(e){}return!1}e.createBaseEventAsJson=t,e.createClickEventAsJson=n,e.createLogEventAsJson=o,e.createSetContextEventAsJson=s,e.createFailureEventAsJson=l,e.createFunnelEventAsJson=p,e.createSessionStartEventAsJson=c,e.createSessionEndEventAsJson=u,e.createTraceEventAsJson=g,e.addToLogEvent=d,e.isConsoleOutputEnabled=m}(o=n.LogHelpers||(n.LogHelpers={}))},{"./log":88}],90:[function(e,t,n){"use strict";var o=e("./log"),i=function(){function e(){}return e.prototype.logJsonParseUnexpected=function(e){this.logFailure(o.Failure.Label.JsonParse,o.Failure.Type.Unexpected,void 0,e)},e}();n.Logger=i},{"./log":88}],91:[function(e,t,n){"use strict";var o;!function(e){e.category="Click";var t;!function(e){e.regionSelectionRemoveButton="RegionSelectionRemoveButton",e.sectionComponent="SectionComponent",e.sectionPickerLocationContainer="SectionPickerLocationContainer"}(t=e.Label||(e.Label={}))}(o=n.Click||(n.Click={}))},{}],92:[function(e,t,n){"use strict";var o;!function(e){function t(e){return n[o[e]]}var n={AppInfoId:"AppInfo.Id",AppInfoVersion:"AppInfo.Version",DeviceInfoId:"DeviceInfo.Id",SessionId:"Session.Id",UserInfoId:"UserInfo.Id",UserInfoLanguage:"UserInfo.Language",AuthType:"AuthType",BrowserLanguage:"BrowserLanguage",ClipperType:"ClipperType",ContentType:"ContentType",FlightInfo:"FlightInfo",InPrivateBrowsing:"InPrivateBrowsing",InvokeHostname:"InvokeHostname",PageLanguage:"PageLanguage"};!function(e){e[e.AppInfoId=0]="AppInfoId",e[e.AppInfoVersion=1]="AppInfoVersion",e[e.DeviceInfoId=2]="DeviceInfoId",e[e.SessionId=3]="SessionId",e[e.UserInfoId=4]="UserInfoId",e[e.UserInfoLanguage=5]="UserInfoLanguage",e[e.AuthType=6]="AuthType",e[e.BrowserLanguage=7]="BrowserLanguage",e[e.ClipperType=8]="ClipperType",e[e.ContentType=9]="ContentType",e[e.FlightInfo=10]="FlightInfo",e[e.InPrivateBrowsing=11]="InPrivateBrowsing",e[e.InvokeHostname=12]="InvokeHostname",e[e.PageLanguage=13]="PageLanguage"}(e.Custom||(e.Custom={}));var o=e.Custom;e.toString=t}(o=n.Context||(n.Context={}))},{}],93:[function(e,t,n){"use strict";var o,i=e("../../clientType"),r=e("../../constants"),a=e("../../utils"),s=e("../../localization/localization"),l=e("../log");!function(e){function t(e){if(e){var t={};t[d[d.error]]=e.error;var n=e;return n&&void 0!==n.statusCode&&(t[d[d.statusCode]]=n.statusCode,t[d[d.response]]=n.response,t[d[d.responseHeaders]]=n.responseHeaders,void 0!==n.timeout&&(t[d[d.timeout]]=n.timeout)),JSON.stringify(t)}}function n(e){if(e){var t=e;return t&&void 0!==t.statusCode?void 0!==t.timeout?{error:t.error,statusCode:t.statusCode,response:t.response,responseHeaders:t.responseHeaders,timeout:t.timeout}:{error:t.error,statusCode:t.statusCode,response:t.response,responseHeaders:t.responseHeaders}:{error:e.error}}}function o(t){var n={};n[r.Constants.Urls.QueryParams.failureType]=l.Failure.Type[t.properties.failureType],n[r.Constants.Urls.QueryParams.failureInfo]=e.toString(t.properties.failureInfo),n[r.Constants.Urls.QueryParams.stackTrace]=t.properties.stackTrace,a.Utils.isNullOrUndefined(t.properties.failureId)||(n[r.Constants.Urls.QueryParams.failureId]=t.properties.failureId);var o=t.clientInfo;g(n,o),LogManager.sendMiscLogRequest({label:l.Failure.Label[t.label],category:l.Failure.category,properties:n},!0)}function p(t,n,o,i){var r;throw r=i?JSON.stringify({message:i,error:n.toString()}):n.toString(),e.sendFailureLogRequest({label:l.Failure.Label.UnhandledExceptionThrown,properties:{failureType:l.Failure.Type.Unexpected,failureInfo:{error:r},failureId:"Channel "+t,stackTrace:l.Failure.getStackTrace(n)},clientInfo:o}),n}function c(e,t){void 0===t&&(t=!1);var n={};n[r.Constants.Urls.QueryParams.channel]=e.channel,n[r.Constants.Urls.QueryParams.url]=encodeURIComponent(e.url),n[r.Constants.Urls.QueryParams.timeoutInMs]=r.Constants.Settings.noOpTrackerTimeoutDuration.toString();var o=e.clientInfo;g(n,o),LogManager.sendMiscLogRequest({label:l.NoOp.Label[e.label],category:l.NoOp.category,properties:n},!0),t&&window&&window.alert(s.Localization.getLocalizedString("WebClipper.Error.NoOpError"))}function u(e,t){return void 0===t&&(t=!1),setTimeout(function(){c(e,t)},r.Constants.Settings.noOpTrackerTimeoutDuration)}function g(e,t){t&&(e[r.Constants.Urls.QueryParams.clientType]=a.Utils.isNullOrUndefined(t.get())?l.unknownValue:i.ClientType[t.get().clipperType],e[r.Constants.Urls.QueryParams.clipperVersion]=a.Utils.isNullOrUndefined(t.get())?l.unknownValue:t.get().clipperVersion,e[r.Constants.Urls.QueryParams.clipperId]=a.Utils.isNullOrUndefined(t.get())?l.unknownValue:t.get().clipperId)}var d;!function(e){e[e.error=0]="error",e[e.statusCode=1]="statusCode",e[e.response=2]="response",e[e.responseHeaders=3]="responseHeaders",e[e.timeout=4]="timeout"}(d||(d={})),e.toString=t,e.clone=n,e.sendFailureLogRequest=o,e.handleCommunicatorError=p,e.sendNoOpTrackerRequest=c,e.setNoOpTrackerRequestTimeout=u}(o=n.ErrorUtils||(n.ErrorUtils={}))},{"../../clientType":1,"../../constants":59,"../../localization/localization":85,"../../utils":111,"../log":88}],94:[function(e,t,n){"use strict";var o,i=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},r=e("../log"),a=e("../../utils");!function(e){function t(t,n){switch(t){default:case e.Category.BaseEvent:return new e.BaseEvent(n);case e.Category.PromiseEvent:return new e.PromiseEvent(n);case e.Category.StreamEvent:return new e.StreamEvent(n)}}!function(e){e[e.BaseEvent=0]="BaseEvent",e[e.PromiseEvent=1]="PromiseEvent",e[e.StreamEvent=2]="StreamEvent"}(e.Category||(e.Category={}));e.Category;!function(e){e[e.AddEmbeddedVideo=0]="AddEmbeddedVideo",e[e.AugmentationApiCall=1]="AugmentationApiCall",e[e.BookmarkPage=2]="BookmarkPage",e[e.CompressRegionSelection=3]="CompressRegionSelection",e[e.ClearNoOpTracker=4]="ClearNoOpTracker",e[e.Click=5]="Click",e[e.ClipToOneNoteAction=6]="ClipToOneNoteAction",e[e.CloseClipper=7]="CloseClipper",e[e.ClosePageNavTooltip=8]="ClosePageNavTooltip",e[e.DebugFeedback=9]="DebugFeedback",e[e.DeviceIdMap=10]="DeviceIdMap",e[e.FetchNonLocalData=11]="FetchNonLocalData",e[e.FullPageScreenshotCall=12]="FullPageScreenshotCall",e[e.GetBinaryRequest=13]="GetBinaryRequest",e[e.GetCleanDom=14]="GetCleanDom",e[e.GetDefaultSection=15]="GetDefaultSection",e[e.GetExistingUserInformation=16]="GetExistingUserInformation",e[e.GetFlightingAssignments=17]="GetFlightingAssignments",e[e.GetLocale=18]="GetLocale",e[e.GetLocalizedStrings=19]="GetLocalizedStrings",e[e.GetNotebooks=20]="GetNotebooks",e[e.HandleSignInEvent=21]="HandleSignInEvent",e[e.HideClipperDueToSpaNavigate=22]="HideClipperDueToSpaNavigate",e[e.InvokeClipper=23]="InvokeClipper",e[e.InvokeTooltip=24]="InvokeTooltip",e[e.InvokeWhatsNew=25]="InvokeWhatsNew",e[e.RegionSelectionCapturing=26]="RegionSelectionCapturing",e[e.RegionSelectionLoading=27]="RegionSelectionLoading",e[e.RegionSelectionProcessing=28]="RegionSelectionProcessing",e[e.SetContextProperty=29]="SetContextProperty",e[e.SetDoNotPromptRatings=30]="SetDoNotPromptRatings",e[e.ShouldShowRatingsPrompt=31]="ShouldShowRatingsPrompt",e[e.PageModifications=32]="PageModifications",e[e.PostToOneNoteApi=33]="PostToOneNoteApi",e[e.ProcessPdfIntoDataUrls=34]="ProcessPdfIntoDataUrls",e[e.RefreshUserToken=35]="RefreshUserToken",e[e.TooltipImpression=36]="TooltipImpression",e[e.UserInfoUpdated=37]="UserInfoUpdated",e[e.WaitOnBinaryRequestBeforePdfClip=38]="WaitOnBinaryRequestBeforePdfClip",e[e.WhatsNewImpression=39]="WhatsNewImpression"}(e.Label||(e.Label={}));var n=(e.Label,function(){function t(e){if(this._timerWasStopped=!1,this.isEventData(e)){var t=e;this._label=t.Label,this._duration=t.Duration,this._properties=t.Properties?JSON.parse(JSON.stringify(t.Properties)):void 0}else{var n=e;this._label=n,this.startTimer()}}return t.prototype.getDuration=function(){return this._duration},t.prototype.getEventCategory=function(){return e.Category.BaseEvent},t.prototype.getEventData=function(){return{Label:this._label,Duration:this._duration,Properties:this.getCustomProperties()}},t.prototype.getLabel=function(){return e.Label[this._label]},t.prototype.getCustomProperties=function(){return this._properties?JSON.parse(JSON.stringify(this._properties)):void 0},t.prototype.setCustomProperty=function(e,t){if(this.isReservedPropertyName(e))throw new Error("Tried to overwrite key '"+r.PropertyName.Custom[e]+"' with value of "+JSON.stringify(t));this._properties||(this._properties={}),this._properties[r.PropertyName.Custom[e]]=t},t.prototype.startTimer=function(){this._startTime=(new Date).getTime()},t.prototype.stopTimer=function(){return!!this._startTime&&(this._duration=(new Date).getTime()-this._startTime,this._timerWasStopped=!0,!0)},t.prototype.timerWasStopped=function(){return this._timerWasStopped},t.prototype.isEventData=function(e){var t=e;return!(!t||a.Utils.isNullOrUndefined(t.Label))},t.prototype.isReservedPropertyName=function(e){for(var t in r.PropertyName.Reserved)if(r.PropertyName.Custom[e].toLowerCase()===t.toLowerCase())return!0;return!1},t}());e.BaseEvent=n;var o=function(t){function n(e){if(t.call(this,e),this._logStatus=r.Status.Succeeded,this._failureType=r.Failure.Type.Unexpected,this.isEventData(e)){var n=e;this._logStatus=n.LogStatus,this._failureType=n.FailureType,this._failureInfo=r.ErrorUtils.clone(n.FailureInfo)}}return i(n,t),n.prototype.getEventCategory=function(){return e.Category.PromiseEvent},n.prototype.getEventData=function(){return{Label:this._label,Duration:this._duration,Properties:this.getCustomProperties(),LogStatus:this._logStatus,FailureType:this._failureType,FailureInfo:r.ErrorUtils.clone(this._failureInfo)}},n.prototype.getStatus=function(){return r.Status[this._logStatus]},n.prototype.setStatus=function(e){this._logStatus=e,this._timerWasStopped||this.stopTimer()},n.prototype.getFailureInfo=function(){return r.ErrorUtils.toString(this._failureInfo)},n.prototype.setFailureInfo=function(e){this._failureInfo=r.ErrorUtils.clone(e)},n.prototype.getFailureType=function(){return r.Failure.Type[this._failureType]},n.prototype.setFailureType=function(e){this._failureType=e},n}(n);e.PromiseEvent=o;var s=function(t){function n(e){if(t.call(this,e),this._stream=[],this.isEventData(e)){var n=e;this._stream=n.Stream}}return i(n,t),n.prototype.getEventCategory=function(){return e.Category.StreamEvent},n.prototype.getEventData=function(){return{Label:this._label,Duration:this._duration,Properties:this.getCustomProperties(),Stream:this._stream}},n.prototype.append=function(e){this._stream.push(e)},n}(n);e.StreamEvent=s,e.createEvent=t}(o=n.Event||(n.Event={}))},{"../../utils":111,"../log":88}],95:[function(e,t,n){"use strict";var o;!function(e){function t(e){return e||(e=new Error),e.stack}e.category="Failure",function(e){e[e.Unexpected=0]="Unexpected",e[e.Expected=1]="Expected"}(e.Type||(e.Type={}));e.Type;e.getStackTrace=t,function(e){e[e.ClickedButtonWithNoId=0]="ClickedButtonWithNoId",e[e.EndSessionWithoutTrigger=1]="EndSessionWithoutTrigger",e[e.GetChangeLog=2]="GetChangeLog",e[e.GetComputedStyle=3]="GetComputedStyle",e[e.GetLocalizedString=4]="GetLocalizedString",e[e.GetSetting=5]="GetSetting",e[e.IFrameMessageHandlerHasNoOtherWindow=6]="IFrameMessageHandlerHasNoOtherWindow",e[e.InvalidArgument=7]="InvalidArgument",e[e.IsFeatureEnabled=8]="IsFeatureEnabled",e[e.JsonParse=9]="JsonParse",e[e.NotImplemented=10]="NotImplemented",e[e.OnLaunchOneNoteButton=11]="OnLaunchOneNoteButton",e[e.OrphanedWebClippersDueToExtensionRefresh=12]="OrphanedWebClippersDueToExtensionRefresh",e[e.RegionSelectionProcessing=13]="RegionSelectionProcessing",e[e.RenderFailurePanel=14]="RenderFailurePanel",e[e.ReservedPropertyOverwriteAttempted=15]="ReservedPropertyOverwriteAttempted",e[e.SessionAlreadySet=16]="SessionAlreadySet",e[e.SetLoggerNoop=17]="SetLoggerNoop",e[e.SetUndefinedLocalizedStrings=18]="SetUndefinedLocalizedStrings",e[e.TraceLevelErrorWarningMessage=19]="TraceLevelErrorWarningMessage",e[e.UnhandledApiCode=20]="UnhandledApiCode",e[e.UnhandledExceptionThrown=21]="UnhandledExceptionThrown",e[e.UserSetWithInvalidExpiredData=22]="UserSetWithInvalidExpiredData",e[e.WebExtensionWindowCreate=23]="WebExtensionWindowCreate",e[e.UnclippablePage=24]="UnclippablePage",e[e.UnsupportedBrowser=25]="UnsupportedBrowser"}(e.Label||(e.Label={}));e.Label}(o=n.Failure||(n.Failure={}))},{}],96:[function(e,t,n){"use strict";var o;!function(e){e.category="Funnel",function(e){e[e.Invoke=0]="Invoke",e[e.AuthAlreadySignedIn=1]="AuthAlreadySignedIn",e[e.AuthAttempted=2]="AuthAttempted",e[e.AuthSignInCompleted=3]="AuthSignInCompleted",e[e.ClipAttempted=4]="ClipAttempted",e[e.Interact=5]="Interact",e[e.ViewInWac=6]="ViewInWac",e[e.SignOut=7]="SignOut"}(e.Label||(e.Label={}));e.Label}(o=n.Funnel||(n.Funnel={}))},{}],97:[function(e,t,n){"use strict";!function(e){e[e.logEvent=0]="logEvent",e[e.logFailure=1]="logFailure",e[e.pushToStream=2]="pushToStream",e[e.logFunnel=3]="logFunnel",e[e.logSession=4]="logSession",e[e.logSessionStart=5]="logSessionStart",e[e.logSessionEnd=6]="logSessionEnd",e[e.logTrace=7]="logTrace",e[e.logClickEvent=8]="logClickEvent",e[e.setContextProperty=9]="setContextProperty"}(n.LogMethods||(n.LogMethods={}));n.LogMethods},{}],98:[function(e,t,n){"use strict";var o;!function(e){e.category="NoOp",function(e){e[e.InitializeCommunicator=0]="InitializeCommunicator",e[e.WebClipperUiFrameDidNotExist=1]="WebClipperUiFrameDidNotExist",e[e.WebClipperUiFrameIsNotVisible=2]="WebClipperUiFrameIsNotVisible"}(e.Label||(e.Label={}));e.Label}(o=n.NoOp||(n.NoOp={}))},{}],99:[function(e,t,n){"use strict";var o;!function(e){!function(e){e[e.AnnotationAdded=0]="AnnotationAdded",e[e.AugmentationModel=1]="AugmentationModel",e[e.AverageProcessingDurationPerPage=2]="AverageProcessingDurationPerPage",e[e.BookmarkInfo=3]="BookmarkInfo",e[e.ByteLength=4]="ByteLength",e[e.BytesTrimmed=5]="BytesTrimmed",e[e.Channel=6]="Channel",e[e.ClipMode=7]="ClipMode",e[e.CloseReason=8]="CloseReason",e[e.ContainsAtLeastOneHighlight=9]="ContainsAtLeastOneHighlight",e[e.ContentType=10]="ContentType",e[e.CorrelationId=11]="CorrelationId",e[e.CurrentPanel=12]="CurrentPanel",e[e.CurrentSectionStillExists=13]="CurrentSectionStillExists",e[e.DeviceIdInStorage=14]="DeviceIdInStorage",e[e.DeviceIdInCookie=15]="DeviceIdInCookie",e[e.DomSizeInBytes=16]="DomSizeInBytes",e[e.FeatureEnabled=17]="FeatureEnabled",e[e.FinalDataUrlLength=18]="FinalDataUrlLength",e[e.FontSize=19]="FontSize",e[e.ForceRetrieveFreshLocStrings=20]="ForceRetrieveFreshLocStrings",e[e.FoundDefaultNotebook=21]="FoundDefaultNotebook",e[e.FoundDefaultSection=22]="FoundDefaultSection",e[e.FreshUserInfoAvailable=23]="FreshUserInfoAvailable",e[e.FullPageScreenshotContentFound=24]="FullPageScreenshotContentFound",e[e.Height=25]="Height",e[e.InitialDataUrlLength=26]="InitialDataUrlLength",e[e.InvokeMode=27]="InvokeMode",e[e.InvokeSource=28]="InvokeSource",e[e.IsRetryable=29]="IsRetryable",e[e.IsSerif=30]="IsSerif",e[e.Key=31]="Key",e[e.LastSeenTooltipTime=32]="LastSeenTooltipTime",e[e.LastUpdated=33]="LastUpdated",e[e.MaxDepth=34]="MaxDepth",e[e.NumPages=35]="NumPages",e[e.NumTimesTooltipHasBeenSeen=36]="NumTimesTooltipHasBeenSeen",e[e.PageNavTooltipType=37]="PageNavTooltipType",e[e.PageTitleModified=38]="PageTitleModified",e[e.Quality=39]="Quality",e[e.QualityStepDownCount=40]="QualityStepDownCount",e[e.RatingsInfo=41]="RatingsInfo",e[e.RequestCorrelationId=42]="RequestCorrelationId",e[e.ShouldShowRatingsPrompt=43]="ShouldShowRatingsPrompt",e[e.SignInCancelled=44]="SignInCancelled",e[e.StoredLocaleDifferentThanRequested=45]="StoredLocaleDifferentThanRequested",e[e.Styles=46]="Styles",e[e.TimeToClearNoOpTracker=47]="TimeToClearNoOpTracker",e[e.TooltipType=48]="TooltipType",e[e.UpdateInterval=49]="UpdateInterval",e[e.UserInformationReturned=50]="UserInformationReturned",e[e.UserInformationStored=51]="UserInformationStored",e[e.UserUpdateReason=52]="UserUpdateReason",e[e.Url=53]="Url",e[e.Value=54]="Value",e[e.VideoDataOriginalSrcUrl=55]="VideoDataOriginalSrcUrl",e[e.VideoSrcUrl=56]="VideoSrcUrl",e[e.Width=57]="Width"}(e.Custom||(e.Custom={}));var t;e.Custom;!function(e){e.Category="Category",e.Duration="Duration",e.EventName="EventName",e.EventType="EventType",e.FailureInfo="FailureInfo",e.FailureType="FailureType",e.Id="Id",e.Label="Label",e.Level="Level",e.Message="Message",e.Properties="Properties",e.StackTrace="StackTrace",e.Status="Status",e.Stream="Stream",e.Trigger="Trigger",e.WebClipper="WebClipper"}(t=e.Reserved||(e.Reserved={}))}(o=n.PropertyName||(n.PropertyName={}))},{}],100:[function(e,t,n){"use strict";var o;!function(e){e.category="Session",function(e){e[e.SignOut=0]="SignOut",e[e.Unload=1]="Unload"}(e.EndTrigger||(e.EndTrigger={}));e.EndTrigger;!function(e){e[e.Started=0]="Started",e[e.Ended=1]="Ended"}(e.State||(e.State={}));e.State}(o=n.Session||(n.Session={}))},{}],101:[function(e,t,n){"use strict";!function(e){e[e.Succeeded=0]="Succeeded",e[e.Failed=1]="Failed"}(n.Status||(n.Status={}));n.Status},{}],102:[function(e,t,n){"use strict";var o;!function(e){e.category="Trace",function(e){e[e.DefaultingToConsoleLogger=0]="DefaultingToConsoleLogger",e[e.DebugMode=1]="DebugMode",e[e.RequestForClipperInstalledPageUrl=2]="RequestForClipperInstalledPageUrl"}(e.Label||(e.Label={}));e.Label;!function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Warning=2]="Warning",e[e.Information=3]="Information",e[e.Verbose=4]="Verbose"}(e.Level||(e.Level={}));e.Level}(o=n.Trace||(n.Trace={}))},{}],103:[function(e,t,n){"use strict";var o,i=e("es6-promise");!function(e){function t(){n(),o(),r()}function n(){"function"!=typeof Object.assign&&(Object.assign=function(e){if(!e)throw new TypeError("Cannot convert undefined to object");for(var t=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(o)for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i])}return t})}function o(){"undefined"==typeof Promise&&i.polyfill()}function r(){window.requestAnimationFrame||(window.requestAnimationFrame=window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(function(){e(Date.now())},16)})}e.init=t}(o=n.Polyfills||(n.Polyfills={}))},{"es6-promise":118}],104:[function(e,t,n){"use strict";var o,i=e("../settings.json");!function(t){function n(e){var t=i[e];if(t&&t.Value)return t.Value}function o(t){i=t?t:e("../settings.json")}t.getSetting=n,t.setSettingsJsonForTesting=o}(o=n.Settings||(n.Settings={}))},{"../settings.json":115}],105:[function(e,t,n){"use strict";var o=e("../http/clipperCachedHttp"),i=e("./clipperStorageGateStrategy"),r=function(){function e(e,t){this.storage=e,this.storageGateStrategy=new i.ClipperStorageGateStrategy(e),this.cachedHttp=new o.ClipperCachedHttp(this,t)}return e.prototype.setLogger=function(e){this.cachedHttp.setLogger(e)},e.prototype.getFreshValue=function(e,t,n){return this.cachedHttp.getFreshValue(e,t,n)},e.prototype.getValue=function(e){return this.storage.getValue(e)},e.prototype.getValues=function(e){return this.storage.getValues(e)},e.prototype.setValue=function(e,t){this.storageGateStrategy.shouldSet(e,t)&&this.storage.setValue(e,t)},e.prototype.removeKey=function(e){return this.storage.removeKey(e)},e}();n.ClipperData=r},{"../http/clipperCachedHttp":83,"./clipperStorageGateStrategy":106}],106:[function(e,t,n){"use strict";var o=e("./clipperStorageKeys"),i=function(){function e(e){this.keysThatRequireUserInfo=[o.ClipperStorageKeys.cachedNotebooks,o.ClipperStorageKeys.currentSelectedSection],this.storage=e}return e.prototype.shouldSet=function(e,t){if(t&&this.keysThatRequireUserInfo.indexOf(e)>-1){var n=this.storage.getValue(o.ClipperStorageKeys.userInformation);return!!n}return!0},e}();n.ClipperStorageGateStrategy=i},{"./clipperStorageKeys":107}],107:[function(e,t,n){"use strict";var o;!function(e){e.clipperId="clipperId",e.cachedNotebooks="notebooks",e.currentSelectedSection="curSection",e.displayLanguageOverride="displayLocaleOverride",e.doNotPromptRatings="doNotPromptRatings",e.flightingInfo="flightingInfo",e.lastBadRatingDate="lastBadRatingDate",e.lastBadRatingVersion="lastBadRatingVersion",e.lastClippedDate="lastClippedDate",e.lastSeenVersion="lastSeenVersion",e.lastInvokedDate="lastInvokedDate",e.lastSeenTooltipTimeBase="lastSeenTooltipTime",e.lastClippedTooltipTimeBase="lastClippedTooltipTime",e.locale="locale",e.locStrings="locStrings",e.numSuccessfulClips="numSuccessfulClips",e.numTimesTooltipHasBeenSeenBase="numTimesTooltipHasBeenSeen",e.userInformation="userInformation"}(o=n.ClipperStorageKeys||(n.ClipperStorageKeys={}))},{}],108:[function(e,t,n){"use strict";var o=function(){function e(){}return e.prototype.getValue=function(e){var t;return window.localStorage&&(t=window.localStorage.getItem(e),t||this.removeKey(e)),t},e.prototype.getValues=function(e){var t={};if(window.localStorage&&e)for(var n=0;n<e.length;n++){var o=window.localStorage.getItem(e[n]);o?t[e[n]]=o:this.removeKey(e[n])}return t},e.prototype.setValue=function(e,t){window.localStorage&&(t?window.localStorage.setItem(e,t):window.localStorage.removeItem(e))},e.prototype.removeKey=function(e){return window.localStorage&&window.localStorage.removeItem(e),!0},e}();n.LocalStorage=o},{}],109:[function(e,t,n){"use strict";var o=e("../constants"),i=function(){function e(e){this.storageCache={},this.extensionCommunicator=e}return e.prototype.getCachedValue=function(e){return this.storageCache[e]},e.prototype.getValue=function(e,t,n){var i=this;this.extensionCommunicator.callRemoteFunction(o.Constants.FunctionKeys.getStorageValue,{param:e,callback:function(o){n&&(i.storageCache[e]=o),t(o)}})},e.prototype.getValues=function(e,t,n){var i=this;this.extensionCommunicator.callRemoteFunction(o.Constants.FunctionKeys.getMultipleStorageValues,{param:e,callback:function(e){if(n)for(var o in e)e.hasOwnProperty(o)&&(i.storageCache[o]=e[o]);t(e)}})},e.prototype.setValue=function(e,t,n){e in this.storageCache&&(this.storageCache[e]=t),this.extensionCommunicator.callRemoteFunction(o.Constants.FunctionKeys.setStorageValue,{param:{key:e,value:t},callback:function(e){n&&n(e)}})},e}();n.RemoteStorage=i},{"../constants":59}],110:[function(e,t,n){"use strict";!function(e){e[e.Msa=0]="Msa",e[e.OrgId=1]="OrgId"}(n.AuthType||(n.AuthType={}));n.AuthType;!function(e){e[e.InitialRetrieval=0]="InitialRetrieval",e[e.SignInAttempt=1]="SignInAttempt",e[e.SignInCancel=2]="SignInCancel",e[e.SignOutAction=3]="SignOutAction",e[e.TokenRefreshForPendingClip=4]="TokenRefreshForPendingClip"}(n.UpdateReason||(n.UpdateReason={}));n.UpdateReason},{}],111:[function(e,t,n){"use strict";var o,i=e("./clientType"),r=e("./constants"),a=e("./settings"),s=e("./clipperUI/tooltipType");!function(e){function t(e){var t=1e3,n=700,o=screen.width?(screen.width-t)/2:0,i=screen.height?(screen.height-n)/2:0,r="height="+n+",width="+t+",top="+i+",left="+o+",scrollbars=yes,resizable=yes,location=no,menubar=no,status=yes,titlebar=no,toolbar=no";return window.open(e,"_blank",r)}function n(e,t){if(e&&t){var n=t.replace(/[\[\]]/g,"\\$&"),o=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)","i"),i=o.exec(e);if(i)return i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):""}}function o(t,n,o,i){if(void 0===i&&(i=!1),!t||!n||!o)return t;i&&(n=e.toCamelCase(n));var r=t.match(/^([^#]*)(#.*)?$/),a=r[1],s=r[2]?r[2]:"",l=a.indexOf("?");if(l===-1)return a+"?"+n+"="+o+s;if(l===a.length-1)return a+n+"="+o+s;for(var p=a.substring(l+1).split("&"),c=0;c<p.length;c++){var u=p[c].split("=");if(u[0]===n)return p[c]=u[0]+"="+o,a.substring(0,l+1)+p.join("&")+s;
}return a+"&"+n+"="+o+s}function l(t,n,o,i){var a=e.addUrlQueryValue(t,r.Constants.Urls.QueryParams.authType,i);return a=e.addUrlQueryValue(a,r.Constants.Urls.QueryParams.clipperId,n),a=e.addUrlQueryValue(a,r.Constants.Urls.QueryParams.userSessionId,o)}function p(e,t,n){return l(r.Constants.Urls.Authentication.signInUrl,e,t,n)}function c(e,t,n){return l(r.Constants.Urls.Authentication.signOutUrl,e,t,n)}function u(t,n,o){var a=e.addUrlQueryValue(r.Constants.Urls.clipperFeedbackUrl,"LogCategory",o);return a=e.addUrlQueryValue(a,"originalUrl",t.pageInfo.rawUrl),a=e.addUrlQueryValue(a,"clipperId",t.clientInfo.clipperId),a=e.addUrlQueryValue(a,"usid",n),a=e.addUrlQueryValue(a,"type",i.ClientType[t.clientInfo.clipperType]),a=e.addUrlQueryValue(a,"version",t.clientInfo.clipperVersion)}function g(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"===e?t:3&t|8;return n.toString(16)})}function d(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.host+"/"}function m(e){var t=document.createElement("a");t.href=e;var n=t.pathname;return this.ensureLeadingForwardSlash(n)}function h(e,t){for(var n=0;n<t.length;++n){var o=t[n],i=s.TooltipType[o],r=a.Settings.getSetting(i+"Domains"),l=new RegExp(r.join("|"),"i");if(l.test(e))return o}}function f(e){return e=this.isNullOrUndefined(e)?"/":e,e.length>0&&"/"===e.charAt(0)?e:"/"+e}function S(e,t){if(!e)return t;var n=/\/(?=[^\/]+\.\w{3,4}$).+/g.exec(e);return n&&n[0]?n[0].slice(1):t}function C(e){return null===e||void 0===e}function y(e){return"number"==typeof e&&!isNaN(e)}function v(e){return("images/"+e).toLowerCase()}function b(e){return e.charAt(0).toUpperCase()+e.slice(1)}function w(e){if(!e)return!1;var t=["AugmentationDefault_WhitelistedDomains","ProductDomains","RecipeDomains"],n=[];t.forEach(function(e){n=n.concat(a.Settings.getSetting(e))});for(var o=0,i=n;o<i.length;o++){var r=i[o];if(new RegExp(r).test(e))return!0}return!1}function I(e){var t=document.createElement("iframe");t.hidden=!0,t.style.display="none",t.src=e,document.body.appendChild(t)}function P(e,t){var n={};if(e)for(var o in e)e.hasOwnProperty(o)&&(n[o]=e[o]);if(t)for(var o in t)t.hasOwnProperty(o)&&(n[o]=t[o]);return n}function T(t,n){e.isNullOrUndefined(n)&&(n=document);for(var o=document.cookie.split(";").map(function(e){return e.split("=")}),i=0,r=o;i<r.length;i++){var a=r[i];if(a[0].trim()===t)return a[1].trim()}}e.openPopupWindow=t,e.getQueryValue=n,e.addUrlQueryValue=o,e.generateSignInUrl=p,e.generateSignOutUrl=c,e.generateFeedbackUrl=u,e.generateGuid=g,e.getHostname=d,e.getPathname=m,e.checkIfUrlMatchesAContentType=h,e.ensureLeadingForwardSlash=f,e.getFileNameFromUrl=S,e.isNullOrUndefined=C,e.isNumeric=y,e.getImageResourceUrl=v,e.toCamelCase=b,e.onWhitelistedDomain=w,e.appendHiddenIframeToDocument=I,e.createUpdatedObject=P,e.readCookie=T}(o=n.Utils||(n.Utils={}))},{"./clientType":1,"./clipperUI/tooltipType":53,"./constants":59,"./settings":104}],112:[function(e,t,n){"use strict";var o;!function(e){e.schemaVersionSupported="1"}(o=n.ChangeLog||(n.ChangeLog={}))},{}],113:[function(e,t,n){"use strict";var o,i=e("./version");!function(e){function t(e,t){if(!e||0===e.length)return[];if(!t)return e;for(var n=0;n<e.length;n++){var o=new i.Version(e[n].version);if(t.isGreaterThanOrEqualTo(o))return e.slice(0,n)}return e}function n(e,t,n){if(!e||0===e.length)return[];for(var o=[],r=0;r<e.length;r++){var a=new i.Version(e[r].version);if(t&&a.isLesserThanOrEqualTo(t))break;a.isLesserThanOrEqualTo(n)&&o.push(e[r])}return o}function o(e,t){if(!e||!t)return[];for(var n=[],o=0;o<e.length;o++){var i=e[o],r=i.changes.filter(function(e){return e.supportedBrowsers.indexOf(t)!==-1});r.length>0&&n.push({version:i.version,date:i.date,changes:r})}return n}e.getUpdatesSinceVersion=t,e.getUpdatesBetweenVersions=n,e.filterUpdatesThatDontApplyToBrowser=o}(o=n.ChangeLogHelper||(n.ChangeLogHelper={}))},{"./version":114}],114:[function(e,t,n){"use strict";var o=function(){function e(e){if(!e||!/^\d+\.\d+\.\d+$/.test(e))throw new Error("version must match 'int.int.int' pattern, but was: "+e);var t=e.split(".");this.major=parseInt(t[0],10),this.minor=parseInt(t[1],10),this.patch=parseInt(t[2],10),this.stringRepresentation=this.major+"."+this.minor+"."+this.patch}return e.prototype.isEqualTo=function(e,t){return this.major===e.major&&this.minor===e.minor&&(t||this.patch===e.patch)},e.prototype.isGreaterThan=function(e,t){return this.major!==e.major?this.major>e.major:this.minor!==e.minor?this.minor>e.minor:!t&&this.patch>e.patch},e.prototype.isGreaterThanOrEqualTo=function(e,t){return this.isEqualTo(e,t)||this.isGreaterThan(e,t)},e.prototype.isLesserThan=function(e,t){return this.major!==e.major?this.major<e.major:this.minor!==e.minor?this.minor<e.minor:!t&&this.patch<e.patch},e.prototype.isLesserThanOrEqualTo=function(e,t){return this.isEqualTo(e,t)||this.isLesserThan(e,t)},e.prototype.toString=function(){return this.stringRepresentation},e}();n.Version=o},{}],115:[function(e,t,n){t.exports={DummyObjectForTestingPurposes:{Description:"Do not remove under any circumstances!",Value:"Testing."},AugmentationDefault_WhitelistedDomains:{Description:"The set of domains on which we are changing the default clip mode to Augmentation.",Value:["onenote","wikipedia","nytimes","lifehacker","msn","theguardian","forbes","bbc","huffingtonpost","businessinsider","washingtonpost","medium","buzzfeed","bbc","theverge","techcrunch","amazon","allrecipes","foodnetwork","seriouseats","epicurious","support.office.com","blogs.office.com","blogs.technet.com","youtube\\.com\\/watch(\\?v=(\\w+)|.*\\&v=(\\w+))","youtube\\.com\\/embed\\/(\\w+)","vimeo\\.com.*?\\/(\\d+)($|\\?|\\#|\\/$)","vimeo\\.com.*?\\/(\\d+)\\/\\w+:\\w+(\\/|$)","khanacademy\\.org(.*)/v/(.*)","\\/(\\d{2}|\\d{4})\\/\\d{1,2}\\/","\\/(\\d{2}|\\d{4})-\\d{1,2}-\\d{1,2}\\/"]},PdfDomains:{Description:"PDF regexes",Value:["^.*(.pdf)$"]},RecipeDomains:{Description:"The set of domains where we want to show a Recipe tooltip",Value:["^(http(s)?)://(12tomatoes\\.com/)()([^/]*-[^/]*)/$","^(http(s)?)://(abc\\.go\\.com/shows/the-chew/recipes/)([^/]*-[^/]*)$","^(http(s)?)://(([^ ]{1,18})?)(allrecipes\\.com)()/(recipe/.*)$","^(http(s)?)://((\\.{1,18}\\.)?)(allrecipes\\.)(com)/(recipe/[^/]+(/)?(/detail\\.aspx\\??)?)$","^(http(s)?)://()(allrecipes\\.com)()/([r|R]ecipe/[^/]+/Detail\\.aspx)$","^(http(s)?)://()(allrecipes\\.com)()/(recipe/.*)$","^(http(s)?)://(cookieandkate\\.com)()/(\\d{4})/(.+)$","^(http(s)?)://(cooking\\.)(nytimes\\.com)()/(recipes/(.*))$","^(http(s)?)://()(cookpad\\.com)()/(recipe/[0-9]+$)$","^(http(s)?)://()(damndelicious\\.net)()/\\d+/\\d+/\\d+/.+/$","^(http(s)?)://(food52\\.com)()/recipes/[0-9]+-.+$","^(http(s)?)://(minimalistbaker.com)/([^/]*-[^/]*)/$","^(http(s)?)://(paleoleap.com)/([^/]*-[^/]*)/$","^(http(s)?)://(pinchofyum.com)/([^/]*-[^/]*)$","^(http(s)?)://(recipe\\.rakuten\\.co\\.jp)()/recipe/[0-9]+/$","^(http(s)?)://()(thepioneerwoman\\.com)()/(cooking/.+/)$","^(http(s)?)://((www\\.)?)(allrecipes\\.com)()/([r|R]ecipe/[^/]+/(Detail\\.aspx)?)$","^(http(s)?)://((www\\.)?)(allrecipes\\.com)()/([R|r]ecipe/.*)$","^(http(s)?)://(www\\.)(bbc\\.co\\.uk/food/recipes/[^/]*_\\d+)$","^(http(s)?)://(www\\.)(bbcgoodfood\\.com)()/(recipes/[0-9]+/(.*))$","^(http(s)?)://(www\\.)(bbcgoodfood\\.com)/recipes/([^/]*-[^/]*)$","^(http(s)?)://(www\\.)(bettycrocker\\.com)()/(recipes/[^\\/]+/[0-9a-f-]{36}/?)$","^(http(s)?)://(www\\.)(bonappetit\\.com)()/(recipe/(.*))$","^(http(s)?)://(www\\.budgetbytes\\.com)/\\d{4}/\\d{2}/(.*)/","^(http(s)?)://((www\\.)?)(chowhound\\.com)()/(recipes/.*)$","^(http(s)?)://(www\\.cookingclassy\\.com)/\\d{4}/\\d{2}/(.*)/","^(http(s)?)://(www\\.delish\\.com)/cooking/recipe-ideas/recipes/a\\d+/[^/]*-[^/]*/","^(http(s)?)://(www\\.)(eatingwell\\.com)()/(recipe/\\d+/.+/)$","^(http(s)?)://(www\\.)(epicurious\\.com)()/(recipes/food/views/.*)$","^(http(s)?)://(www\\.)(food\\.com)()/(recipe/.*)$","^(http(s)?)://(www\\.)(foodandwine\\.com)()/(recipes\\/.+)$","^(http(s)?)://(www\\.)(foodnetwork)(\\.ca)/(recipe/(.*))$","^(http(s)?)://(www\\.)(foodnetwork\\.com)()/(recipe-collections/.*)$","^(http(s)?)://(www\\.)(foodnetwork\\.com)()/(recipes.*)$","^(http(s)?)://(www\\.)(foodnetwork\\.com)()/(recipes/.*)$","^(http(s)?)://(www\\.)(marthastewart\\.com)()/(([0-9]+|recipe)/.*)$","^(http(s)?)://(www\\.)(marthastewart\\.com)()/([0-9]+/[^/]+)$","^(http(s)?)://(www\\.)(myrecipes\\.com)()/(recipe/.*)$","^(http(s)?)://(www\\.)(myrecipes\\.com)()/(recipe/.*-[0-9]*/)$","^(http(s)?)://(www\\.)(myrecipes\\.com)()/(recipe/.*)$","^(http(s)?)://(www\\.)(myrecipes\\.com)()/(recipe/[^/]+.*)$","^(http(s)?)://(www\\.)(realsimple\\.com)()/(food-recipes/browse-all-recipes/[^\\/]+/index\\.html)$","^(http(s)?)://((www)?\\.)(seriouseats\\.com)()/([Rr]ecipes\\/.*\\.(html|HTML)(.*)?)$","^(http(s)?)://(www\\.)(simplyrecipes\\.com)()/(recipes/[^/]*/)$","^(http(s)?)://((www\\.)?)(simplyrecipes\\.com)()/(recipes/[^/]*/)$","^(http(s)?)://((www\\.)?)(simplyrecipes\\.com)()/(recipes/.*)$","^(http(s)?)://(www\\.)(tasteofhome\\.com)()/([R|r]ecipes/[^/]+$)$","^(http(s)?)://(www\\.)(tasteofhome\\.com)()/(recipes/[^/]*/?)$","^(http(s)?)://(www\\.)(tasteofhome\\.com)()/(recipes/[^\\/]+/?)$","^(http(s)?)://(www\\.)(yummly\\.com)()/(recipe/[^/]+)$","^(http(s)?)://((www\\.)?)(yummly\\.com)()/(recipe/.*)$","^(http(s)?)://(.*)(yummly\\.com)()/(recipe/.+)$"]},ProductDomains:{Description:"The set of domains where we want to show a Product tooltip",Value:["^(http(s)?)://store\\.steampowered.com/app/\\d+/.*$","^(http(s)?)://(www\\.)(amazon\\.com)()/(gp/product/[^/]+/.*)$","^(http(s)?)://(www\\.)(amazon\\.com)()/(dp/[^/]+.*)$","^(http(s)?)://(www\\.)(amazon\\.com)()/([^/]+/dp/[^/]+)$","^(http(s)?)://(www\\.)(amazon\\.in)()/((.+/)?(dp|gp/product)\\/\\w{10,13}([^\\w].*)?)$","^(http(s)?)://(www\\.)(amazon\\.)([a-zA-Z\\.]+)/([^/]+/dp/.*)$","^(http(s)?)://(www\\.)(bedbathandbeyond\\.com)(/store/product/)([^/]*-[^/]*/)(\\d+.*)","^(http(s)?)://(www\\.)(ebay\\.com)()/(itm/[^/]+/.*)$","^(http(s)?)://(www\\.)(etsy\\.com)()/(listing)/(\\d+/.*)$","^(http(s)?)://(www\\.)(homedepot\\.com)()/(p/[^/]+/.*)$","^(http(s)?)://(www\\.)(newegg\\.com)()/(Product/Product\\.aspx\\?Item=.+)$","^(http(s)?)://(www\\.)(overstock\\.com)()/(.+/.+/[0-9]+/product\\.html.*)$","^(http(s)?)://(www\\.)(staples\\.com)()/(.*/product_[^/]+)$","^(http(s)?)://(www\\.)(target\\.com)()/(p/.+)$","^(http(s)?)://(www\\.)(walmart\\.com)()/(ip/.*)$"]},App_Id:{Description:"For identifying the Web Clipper during interaction with external services",Value:"OneNote Web Clipper"},Misc_Data_Endpoint_Id:{Description:"The id of the data endpoint used for miscellaneous logging",Value:"production"},Aria_Token:{Description:"For sending log events to the Aria production tenant 'OneNote Web Clipper (production)'",Value:"c7f3f24bc5f746d7b9d8f8e422fdd8a5-1cb58166-2598-485f-897c-1d3c8e62d30e-7560"},LogCategory_RatingsPrompt:{Description:"OFeedback log category for the ratings prompt feature",Value:"OneNoteClipperRatingsPrompt"},Bookmarklet_RatingsEnabled:{Description:"If true, ratings prompt will be enabled for the bookmarklet",Value:"false"},ChromeExtension_RatingsEnabled:{Description:"If true, ratings prompt will be enabled for the Chrome extension",Value:"true"},EdgeExtension_RatingsEnabled:{Description:"If true, ratings prompt will be enabled for the Edge extension",Value:"false"},FirefoxExtension_RatingsEnabled:{Description:"If true, ratings prompt will be enabled for the Firefox extension",Value:"false"},SafariExtension_RatingsEnabled:{Description:"If true, ratings prompt will be enabled for the Safari extension",Value:"false"},ChromeExtension_RatingUrl:{Description:"URL for the Web Clipper in the Chrome Web Store; used to direct users to leave ratings and reviews",Value:"https://chrome.google.com/webstore/detail/onenote-web-clipper/gojbdfnpnhogfdgjbigejoaolejmgdhk/reviews"},EdgeExtension_RatingUrl:{Description:"URL for the Web Clipper in the Windows Store; used to direct users to leave ratings and reviews",Value:"https://www.microsoft.com/en-us/store/p/onenote-web-clipper/9nblggh4r01n#ratings-reviews"},FirefoxExtension_RatingUrl:{Description:"URL for the Web Clipper in Firefox Add-ons; used to direct users to leave ratings and reviews",Value:""}}},{}],116:[function(e,t,n){t.exports={"WebClipper.Action.BackToHome":"Back","WebClipper.Action.Cancel":"Cancel","WebClipper.Action.Clip":"Clip","WebClipper.Action.Feedback":"Feedback?","WebClipper.Action.RefreshPage":"Refresh Page","WebClipper.Action.Signin":"Sign In","WebClipper.Action.SigninMsa":"Sign in with a Microsoft account","WebClipper.Action.SigninOrgId":"Sign in with a work or school account","WebClipper.Action.SignOut":"Sign Out","WebClipper.Action.TryAgain":"Try Again","WebClipper.Action.ViewInOneNote":"View in OneNote","WebClipper.BetaTag":"beta","WebClipper.ClipType.Article.Button":"Article","WebClipper.ClipType.Article.ProgressLabel":"Clipping Article","WebClipper.ClipType.Bookmark.Button":"Bookmark","WebClipper.ClipType.Bookmark.Button.Tooltip":"Clip just the title, thumbnail, synopsis, and link.","WebClipper.ClipType.Bookmark.ProgressLabel":"Clipping Bookmark","WebClipper.ClipType.Button.Tooltip":"Clip just the {0} in an easy-to-read format.","WebClipper.ClipType.Image.Button":"Image","WebClipper.ClipType.ImageSnippet.Button":"Image Snippet","WebClipper.ClipType.MultipleRegions.Button.Tooltip":"Take screenshots of parts of the page you'll select.","WebClipper.ClipType.Pdf.Button":"PDF File","WebClipper.ClipType.Pdf.ProgressLabel":"Clipping PDF File","WebClipper.ClipType.Pdf.Button.Tooltip":"Take a screenshot of the whole PDF file and save a copy of the attachment.","WebClipper.ClipType.Product.Button":"Product","WebClipper.ClipType.Product.ProgressLabel":"Clipping Product","WebClipper.ClipType.Recipe.Button":"Recipe","WebClipper.ClipType.Recipe.ProgressLabel":"Clipping Recipe","WebClipper.ClipType.Region.Button":"Region","WebClipper.ClipType.Region.Button.Tooltip":"Take a screenshot of the part of the page you'll select.","WebClipper.ClipType.Region.ProgressLabel":"Clipping Region","WebClipper.ClipType.ScreenShot.Button":"Full Page","WebClipper.ClipType.ScreenShot.Button.Tooltip":"Take a screenshot of the whole page, just like you see it.","WebClipper.ClipType.ScreenShot.ProgressLabel":"Clipping Page","WebClipper.ClipType.Selection.Button":"Selection","WebClipper.ClipType.Selection.Button.Tooltip":"Clip the selection you made on the web page.","WebClipper.ClipType.Selection.ProgressLabel":"Clipping Selection","WebClipper.Error.NoOpError":"Sorry, we can't clip this page right now","WebClipper.Error.CannotClipPage":"Sorry, this type of page can't be clipped.","WebClipper.Error.CorruptedSection":"Your clip can't be saved here because the section is corrupt.","WebClipper.Error.GenericError":"Something went wrong. Please try clipping the page again.","WebClipper.Error.NotProvisioned":"Your clip can't be saved because your OneDrive for Business account isn't set up.","WebClipper.Error.PasswordProtected":"Your clip can't be saved here because the section is password protected.","WebClipper.Error.QuotaExceeded":"Your clip can't be saved because your OneDrive account has reached its size limit.","WebClipper.Error.ResourceDoesNotExist":"Your clip can't be saved here because the location no longer exists. Please try clipping to another location.","WebClipper.Error.SectionTooLarge":"Your clip can't be saved here because the section has reached its size limit.","WebClipper.Error.UserAccountSuspended":"Your clip can't be saved because your Microsoft account has been suspended.","WebClipper.Error.UserAccountSuspendedResetText":"Reset Your Account","WebClipper.Error.GenericExpiredTokenRefreshError":"Your login session has ended and we were unable to clip the page. Please sign in again.","WebClipper.Error.SignInUnsuccessful":"We couldn't sign you in. Please try again.","WebClipper.Error.OrphanedWebClipperDetected":"Something went wrong. Please refresh this page, and try to clip again.","WebClipper.Extension.RefreshTab":"Please refresh this page, and try to clip again.","WebClipper.FromCitation":"Clipped from: {0}","WebClipper.Label.Annotation":"Note","WebClipper.Label.AnnotationPlaceholder":"Add a note...","WebClipper.Label.ClipImageToOneNote":"Clip Image to OneNote","WebClipper.Label.ClipLocation":"Location","WebClipper.Label.ClipSelectionToOneNote":"Clip Selection to OneNote","WebClipper.Label.ClipSuccessful":"Clip Successful!","WebClipper.Label.DragAndRelease":"Drag and release to capture a screenshot","WebClipper.Label.OneNoteClipper":"OneNote Clipper","WebClipper.Label.OneNoteWebClipper":"OneNote Web Clipper","WebClipper.Label.OpenChangeLogFromTooltip":"Check out what's new","WebClipper.Label.ProceedToWebClipper":"Proceed to the Web Clipper","WebClipper.Label.ProceedToWebClipperFun":"Try it out!","WebClipper.Label.SignInDescription":"Save anything on the web to OneNote in one click","WebClipper.Label.UnsupportedBrowser":"Sorry, your browser version is unsupported.","WebClipper.Label.WebClipper":"Web Clipper","WebClipper.Label.WebClipperWasUpdated":"OneNote Web Clipper has been updated","WebClipper.Label.WebClipperWasUpdatedFun":"OneNote Web Clipper is now better than ever!","WebClipper.Label.PdfTooltip":"Clip this PDF to OneNote, and read it later","WebClipper.Label.ProductTooltip":"Clip and save product details like this to OneNote","WebClipper.Label.RecipeTooltip":"Save clutter-free recipes right to OneNote","WebClipper.Label.VideoTooltip":"Clip this video and watch it anytime in OneNote","WebClipper.Label.WhatsNew":"What's New","WebClipper.Label.Ratings.Message.End":"Thanks for your feedback!","WebClipper.Label.Ratings.Message.Feedback":"Help us improve","WebClipper.Label.Ratings.Message.Init":"Enjoying the Web Clipper?","WebClipper.Label.Ratings.Message.Rate":"Glad you like it!","WebClipper.Label.Ratings.Button.Feedback":"Provide feedback","WebClipper.Label.Ratings.Button.Init.Positive":"Yes, it's great!","WebClipper.Label.Ratings.Button.Init.Negative":"Not really...","WebClipper.Label.Ratings.Button.NoThanks":"No thanks","WebClipper.Label.Ratings.Button.Rate":"Rate us 5 stars","WebClipper.Preview.AugmentationModeGenericError":"Something went wrong creating the preview. Try again, or choose a different clipping mode.","WebClipper.Preview.BookmarkModeGenericError":"Something went wrong creating the bookmark. Try again, or choose a different clipping mode.","WebClipper.Preview.FullPageModeGenericError":"A preview isn't available, but you can still clip your page.","WebClipper.Preview.LoadingMessage":"Loading preview...","WebClipper.Preview.NoContentFound":"No article found. Try another clipping mode.","WebClipper.Preview.UnableToClipLocalFile":"Local files can only be clipped using Region mode.","WebClipper.Preview.Header.AddAnotherRegionButtonLabel":"Add another region","WebClipper.Preview.Header.SansSerifButtonLabel":"Sans-serif","WebClipper.Preview.Header.SerifButtonLabel":"Serif","WebClipper.Preview.Spinner.ClipAnyTimeInFullPage":"In a hurry? You can clip any time in Full Page mode!","WebClipper.SectionPicker.DefaultLocation":"Default location","WebClipper.SectionPicker.LoadingNotebooks":"Loading notebooks...","WebClipper.SectionPicker.NoNotebooksFound":"You don't have any notebooks yet, so we'll create your default notebook when you clip this page.","WebClipper.SectionPicker.NotebookLoadFailureMessage":"OneNote couldn't load your notebooks. Please try again later.","WebClipper.SectionPicker.NotebookLoadUnretryableFailureMessage":"OneNote couldn't load your notebooks.","WebClipper.FontFamily.Regular":"Segoe UI Regular,Segoe UI,Segoe,Segoe WP,Helvetica Neue,Roboto,Helvetica,Arial,Tahoma,Verdana,sans-serif","WebClipper.FontFamily.Bold":"Segoe UI Bold,Segoe UI,Segoe,Segoe WP,Helvetica Neue,Roboto,Helvetica,Arial,Tahoma,Verdana,sans-serif","WebClipper.FontFamily.Light":"Segoe UI Light,Segoe WP Light,Segoe UI,Segoe,Segoe WP,Helvetica Neue,Roboto,Helvetica,Arial,Tahoma,Verdana,sans-serif","WebClipper.FontFamily.Preview.SerifDefault":"Georgia","WebClipper.FontFamily.Preview.SansSerifDefault":"Verdana","WebClipper.FontFamily.Semibold":"Segoe UI Semibold,Segoe UI,Segoe,Segoe WP,Helvetica Neue,Roboto,Helvetica,Arial,Tahoma,Verdana,sans-serif","WebClipper.FontFamily.Semilight":"Segoe UI Semilight,Segoe UI Light,Segoe WP Light,Segoe UI,Segoe,Segoe WP,Helvetica Neue,Roboto,Helvetica,Arial,Tahoma,Verdana,sans-serif","WebClipper.FontSize.Preview.SerifDefault":"16px","WebClipper.FontSize.Preview.SansSerifDefault":"16px"}},{}],117:[function(e,t,n){function o(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(e){if(u===setTimeout)return setTimeout(e,0);if((u===o||!u)&&setTimeout)return u=setTimeout,setTimeout(e,0);try{return u(e,0)}catch(t){try{return u.call(null,e,0)}catch(t){return u.call(this,e,0)}}}function a(e){if(g===clearTimeout)return clearTimeout(e);if((g===i||!g)&&clearTimeout)return g=clearTimeout,clearTimeout(e);try{return g(e)}catch(t){try{return g.call(null,e)}catch(t){return g.call(this,e)}}}function s(){f&&m&&(f=!1,m.length?h=m.concat(h):S=-1,h.length&&l())}function l(){if(!f){var e=r(s);f=!0;for(var t=h.length;t;){for(m=h,h=[];++S<t;)m&&m[S].run();S=-1,t=h.length}m=null,f=!1,a(e)}}function p(e,t){this.fun=e,this.array=t}function c(){}var u,g,d=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:o}catch(e){u=o}try{g="function"==typeof clearTimeout?clearTimeout:i}catch(e){g=i}}();var m,h=[],f=!1,S=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new p(e,t)),1!==h.length||f||r(l)},p.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}],118:[function(e,t,n){(function(o,i){!function(e,o){"object"==typeof n&&"undefined"!=typeof t?t.exports=o():"function"==typeof define&&define.amd?define(o):e.ES6Promise=o()}(this,function(){"use strict";function t(e){return"function"==typeof e||"object"==typeof e&&null!==e}function n(e){return"function"==typeof e}function r(e){J=e}function a(e){Q=e}function s(){return function(){return o.nextTick(g)}}function l(){return"undefined"!=typeof $?function(){$(g)}:u()}function p(){var e=0,t=new Z(g),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function c(){var e=new MessageChannel;return e.port1.onmessage=g,function(){return e.port2.postMessage(0)}}function u(){var e=setTimeout;return function(){return e(g,1)}}function g(){for(var e=0;e<q;e+=2){var t=ne[e],n=ne[e+1];t(n),ne[e]=void 0,ne[e+1]=void 0}q=0}function d(){try{var t=e,n=t("vertx");return $=n.runOnLoop||n.runOnContext,l()}catch(e){return u()}}function m(e,t){var n=arguments,o=this,i=new this.constructor(f);void 0===i[ie]&&x(i);var r=o._state;return r?!function(){var e=n[r-1];Q(function(){return k(r,i,e,o._result)})}():F(o,i,e,t),i}function h(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(f);return P(n,e),n}function f(){}function S(){return new TypeError("You cannot resolve a promise with itself")}function C(){return new TypeError("A promises callback cannot return that same promise.")}function y(e){try{return e.then}catch(e){return le.error=e,le}}function v(e,t,n,o){try{e.call(t,n,o)}catch(e){return e}}function b(e,t,n){Q(function(e){var o=!1,i=v(n,t,function(n){o||(o=!0,t!==n?P(e,n):E(e,n))},function(t){o||(o=!0,U(e,t))},"Settle: "+(e._label||" unknown promise"));!o&&i&&(o=!0,U(e,i))},e)}function w(e,t){t._state===ae?E(e,t._result):t._state===se?U(e,t._result):F(t,void 0,function(t){return P(e,t)},function(t){return U(e,t)})}function I(e,t,o){t.constructor===e.constructor&&o===m&&t.constructor.resolve===h?w(e,t):o===le?U(e,le.error):void 0===o?E(e,t):n(o)?b(e,t,o):E(e,t)}function P(e,n){e===n?U(e,S()):t(n)?I(e,n,y(n)):E(e,n)}function T(e){e._onerror&&e._onerror(e._result),N(e)}function E(e,t){e._state===re&&(e._result=t,e._state=ae,0!==e._subscribers.length&&Q(N,e))}function U(e,t){e._state===re&&(e._state=se,e._result=t,Q(T,e))}function F(e,t,n,o){var i=e._subscribers,r=i.length;e._onerror=null,i[r]=t,i[r+ae]=n,i[r+se]=o,0===r&&e._state&&Q(N,e)}function N(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var o=void 0,i=void 0,r=e._result,a=0;a<t.length;a+=3)o=t[a],i=t[a+n],o?k(n,o,i,r):i(r);e._subscribers.length=0}}function A(){this.error=null}function L(e,t){try{return e(t)}catch(e){return pe.error=e,pe}}function k(e,t,o,i){var r=n(o),a=void 0,s=void 0,l=void 0,p=void 0;if(r){if(a=L(o,i),a===pe?(p=!0,s=a.error,a=null):l=!0,t===a)return void U(t,C())}else a=i,l=!0;t._state!==re||(r&&l?P(t,a):p?U(t,s):e===ae?E(t,a):e===se&&U(t,a))}function R(e,t){try{t(function(t){P(e,t)},function(t){U(e,t)})}catch(t){U(e,t)}}function O(){return ce++}function x(e){e[ie]=ce++,e._state=void 0,e._result=void 0,e._subscribers=[]}function B(e,t){this._instanceConstructor=e,this.promise=new e(f),this.promise[ie]||x(this.promise),G(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?E(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&E(this.promise,this._result))):U(this.promise,z())}function z(){return new Error("Array Methods must be provided an Array")}function H(e){return new B(this,e).promise}function D(e){var t=this;return new t(G(e)?function(n,o){for(var i=e.length,r=0;r<i;r++)t.resolve(e[r]).then(n,o)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function M(e){var t=this,n=new t(f);return U(n,e),n}function V(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function W(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function _(e){this[ie]=O(),this._result=this._state=void 0,this._subscribers=[],f!==e&&("function"!=typeof e&&V(),this instanceof _?R(this,e):W())}function K(){var e=void 0;if("undefined"!=typeof i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var n=null;try{n=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===n&&!t.cast)return}e.Promise=_}var j=void 0;j=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var G=j,q=0,$=void 0,J=void 0,Q=function(e,t){ne[q]=e,ne[q+1]=t,q+=2,2===q&&(J?J(g):oe())},Y="undefined"!=typeof window?window:void 0,X=Y||{},Z=X.MutationObserver||X.WebKitMutationObserver,ee="undefined"==typeof self&&"undefined"!=typeof o&&"[object process]"==={}.toString.call(o),te="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ne=new Array(1e3),oe=void 0;oe=ee?s():Z?p():te?c():void 0===Y&&"function"==typeof e?d():u();var ie=Math.random().toString(36).substring(16),re=void 0,ae=1,se=2,le=new A,pe=new A,ce=0;return B.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===re&&n<e;n++)this._eachEntry(t[n],n)},B.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,o=n.resolve;if(o===h){var i=y(e);if(i===m&&e._state!==re)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(n===_){var r=new n(f);I(r,e,i),this._willSettleAt(r,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(o(e),t)},B.prototype._settledAt=function(e,t,n){var o=this.promise;o._state===re&&(this._remaining--,e===se?U(o,n):this._result[t]=n),0===this._remaining&&E(o,this._result)},B.prototype._willSettleAt=function(e,t){var n=this;F(e,void 0,function(e){return n._settledAt(ae,t,e)},function(e){return n._settledAt(se,t,e)})},_.all=H,_.race=D,_.resolve=h,_.reject=M,_._setScheduler=r,_._setAsap=a,_._asap=Q,_.prototype={constructor:_,then:m,catch:function(e){return this.then(null,e)}},_.polyfill=K,_.Promise=_,_})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:117}]},{},[10]);